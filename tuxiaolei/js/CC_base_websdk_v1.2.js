!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).adapter=e()}}(function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return i(n||e)},u,u.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";var r={};r.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},r.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},r.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),"candidate:"+t.join(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.numChannels=3===t.length?parseInt(t[2],10):1,n},r.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){r.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.getDtlsParameters=function(e,t){var n=r.splitLines(e),i=(n=n.concat(r.splitLines(t))).filter(function(e){return 0===e.indexOf("a=fingerprint:")})[0].substr(14);return{role:"auto",fingerprints:[{algorithm:i.split(" ")[0],value:i.split(" ")[1]}]}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},r.getIceParameters=function(e,t){var n=r.splitLines(e);return{usernameFragment:(n=n.concat(r.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var o=n[i],a=r.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=r.parseRtpMap(a),c=r.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=c.length?r.parseFmtp(c[0]):{},s.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(r.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))}),t},r.writeRtpDescription=function(e,t){var n="";return n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)}),n+="a=rtcp-mux\r\n"},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,d=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{payloadType:e.payloadType,ssrc:t}};n.push(r),o&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:t,mechanism:a?"red+ulpfec":"red"},n.push(r))}}),0===n.length&&c&&n.push({ssrc:c});var u=r.matchPrefix(e,"b=");return u.length&&(0===u[0].indexOf("b=TIAS:")?u=parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")&&(u=parseInt(u[0].substr(5),10)),n.forEach(function(e){e.maxBitrate=u})),n},r.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n"},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},t.exports=r},{}],2:[function(e,t,n){"use strict";!function(){var n=e("./utils").log,r=e("./utils").browserDetails;t.exports.browserDetails=r,t.exports.extractVersion=e("./utils").extractVersion,t.exports.disableLog=e("./utils").disableLog;var i=e("./chrome/chrome_shim")||null,o=e("./edge/edge_shim")||null,a=e("./firefox/firefox_shim")||null,s=e("./safari/safari_shim")||null;switch(r.browser){case"opera":case"chrome":if(!i||!i.shimPeerConnection)return void n("Chrome shim is not included in this adapter release.");n("adapter.js shimming chrome."),t.exports.browserShim=i,i.shimGetUserMedia(),i.shimMediaStream(),i.shimSourceObject(),i.shimPeerConnection(),i.shimOnTrack();break;case"firefox":if(!a||!a.shimPeerConnection)return void n("Firefox shim is not included in this adapter release.");n("adapter.js shimming firefox."),t.exports.browserShim=a,a.shimGetUserMedia(),a.shimSourceObject(),a.shimPeerConnection(),a.shimOnTrack();break;case"edge":if(!o||!o.shimPeerConnection)return void n("MS edge shim is not included in this adapter release.");n("adapter.js shimming edge."),t.exports.browserShim=o,o.shimGetUserMedia(),o.shimPeerConnection();break;case"safari":if(!s)return void n("Safari shim is not included in this adapter release.");n("adapter.js shimming safari."),t.exports.browserShim=s,s.shimGetUserMedia();break;default:n("Unsupported browser!")}}()},{"./chrome/chrome_shim":3,"./edge/edge_shim":5,"./firefox/firefox_shim":7,"./safari/safari_shim":9,"./utils":10}],3:[function(e,t,n){"use strict";var r=e("../utils.js").log,i=e("../utils.js").browserDetails,o={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){var t=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.addEventListener("addtrack",function(n){var r=new Event("track");r.track=n.track,r.receiver={track:n.track},r.streams=[e.stream],t.dispatchEvent(r)}),e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var t=this;this._srcObject=e,this.src&&URL.revokeObjectURL(this.src),e?(this.src=URL.createObjectURL(e),e.addEventListener("addtrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)}),e.addEventListener("removetrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)})):this.src=""}}))},shimPeerConnection:function(){window.RTCPeerConnection=function(e,t){r("PeerConnection"),e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy);var n=new webkitRTCPeerConnection(e,t),i=n.getStats.bind(n);return n.getStats=function(e,t,n){var r=this,o=arguments;if(arguments.length>0&&"function"==typeof e)return i(e,t);var a=function(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},s=function(e,t){var n=new Map(Object.keys(e).map(function(t){return[t,e[t]]}));return t=t||e,Object.keys(t).forEach(function(e){n[e]=t[e]}),n};if(arguments.length>=2){return i.apply(this,[function(e){o[1](s(a(e)))},arguments[0]])}return new Promise(function(t,n){1===o.length&&"object"==typeof e?i.apply(r,[function(e){t(s(a(e)))},n]):i.apply(r,[function(e){t(s(a(e),e.result()))},n])}).then(t,n)},n},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}}),i.version<51&&(["createOffer","createAnswer"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var n=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,i){t.apply(e,[r,i,n])})}return t.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=arguments,n=this,r=new Promise(function(r,i){t.apply(n,[e[0],r,i])});return e.length<2?r:r.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}));var e=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===arguments[0]?Promise.resolve():e.apply(this,arguments)},["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}})},attachMediaStream:function(e,t){r("DEPRECATED, attachMediaStream will soon be removed."),i.version>=43?e.srcObject=t:void 0!==e.src?e.src=URL.createObjectURL(t):r("Error attaching stream to element.")},reattachMediaStream:function(e,t){r("DEPRECATED, reattachMediaStream will soon be removed."),i.version>=43?e.srcObject=t.srcObject:e.src=t.src}};t.exports={shimMediaStream:o.shimMediaStream,shimOnTrack:o.shimOnTrack,shimSourceObject:o.shimSourceObject,shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:e("./getusermedia"),attachMediaStream:o.attachMediaStream,reattachMediaStream:o.reattachMediaStream}},{"../utils.js":10,"./getusermedia":4}],4:[function(e,t,n){"use strict";var r=e("../utils.js").log,i=e("../utils.js").browserDetails;t.exports=function(){var e=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var a={};if("number"==typeof r.ideal){i.version;a[o("min",n)]=r.ideal,t.optional.push(a),(a={})[o("max",n)]=r.ideal,t.optional.push(a)}else a[o("",n)]=r.ideal,t.optional.push(a)}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",n)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,n)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},t=function(t,n){if((t=JSON.parse(JSON.stringify(t)))&&t.audio&&(t.audio=e(t.audio)),t&&"object"==typeof t.video){var i=t.video.facingMode;if((i=i&&("object"==typeof i?i:{ideal:i}))&&("user"===i.exact||"environment"===i.exact||"user"===i.ideal||"environment"===i.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode)&&(delete t.video.facingMode,"environment"===i.exact||"environment"===i.ideal))return navigator.mediaDevices.enumerateDevices().then(function(o){var a=(o=o.filter(function(e){return"videoinput"===e.kind})).find(function(e){return-1!==e.label.toLowerCase().indexOf("back")})||o.length&&o[o.length-1];return a&&(t.video.deviceId=i.exact?{exact:a.deviceId}:{ideal:a.deviceId}),t.video=e(t.video),r("chrome: "+JSON.stringify(t)),n(t)});t.video=e(t.video)}return r("chrome: "+JSON.stringify(t)),n(t)},n=function(e){return{name:{PermissionDeniedError:"NotAllowedError",ConstraintNotSatisfiedError:"OverconstrainedError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};navigator.getUserMedia=function(e,r,i){t(e,function(e){navigator.webkitGetUserMedia(e,r,function(e){i(n(e))})})};var o=function(e){return new Promise(function(t,n){navigator.getUserMedia(e,t,n)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:o,enumerateDevices:function(){return new Promise(function(e){var t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(n){e(n.map(function(e){return{label:e.label,kind:t[e.kind],deviceId:e.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var a=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return t(e,function(e){return a(e).catch(function(e){return Promise.reject(n(e))})})}}else navigator.mediaDevices.getUserMedia=function(e){return o(e)};void 0===navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){r("Dummy mediaDevices.addEventListener called.")}),void 0===navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){r("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":10}],5:[function(e,t,n){"use strict";var r=e("sdp"),i=e("../utils").log,o={shimPeerConnection:function(){window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(e){return e}),window.RTCSessionDescription||(window.RTCSessionDescription=function(e){return e})),window.RTCPeerConnection=function(e){var t=this,n=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){t[e]=n[e].bind(n)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return t.localStreams},this.getRemoteStreams=function(){return t.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},e&&e.iceTransportPolicy)switch(e.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=e.iceTransportPolicy;break;case"none":throw new TypeError('iceTransportPolicy "none" not supported')}this.usingBundle=e&&"max-bundle"===e.bundlePolicy,e&&e.iceServers&&(this.iceOptions.iceServers=e.iceServers.filter(function(e){return!(!e||!e.urls)&&(e.urls=e.urls.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")})[0],!!e.urls)})),this.transceivers=[],this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var e=this,t=r.splitSections(e.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(n){if(!n.candidate||0===Object.keys(n.candidate).length)for(var r=1;r<t.length;r++)-1===t[r].indexOf("\r\na=end-of-candidates\r\n")&&(t[r]+="a=end-of-candidates\r\n");else-1===n.candidate.candidate.indexOf("typ endOfCandidates")&&(t[n.candidate.sdpMLineIndex+1]+="a="+n.candidate.candidate+"\r\n");e.localDescription.sdp=t.join(""),e.dispatchEvent(n),null!==e.onicecandidate&&e.onicecandidate(n),n.candidate||"complete"===e.iceGatheringState||e.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state})&&(e.iceGatheringState="complete")}),this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype.addStream=function(e){this.localStreams.push(e.clone()),this._maybeFireNegotiationNeeded()},window.RTCPeerConnection.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},window.RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},window.RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},window.RTCPeerConnection.prototype._getCommonCapabilities=function(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]};return e.codecs.forEach(function(e){for(var r=0;r<t.codecs.length;r++){var i=t.codecs[r];if(e.name.toLowerCase()===i.name.toLowerCase()&&e.clockRate===i.clockRate&&e.numChannels===i.numChannels){n.codecs.push(i);break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n},window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(e,t){var n=this,i=new RTCIceGatherer(n.iceOptions),o=new RTCIceTransport(i);i.onlocalcandidate=function(a){var s=new Event("icecandidate");s.candidate={sdpMid:e,sdpMLineIndex:t};var c=a.candidate,d=!c||0===Object.keys(c).length;d?(void 0===i.state&&(i.state="completed"),s.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates"):(c.component="RTCP"===o.component?2:1,s.candidate.candidate=r.writeCandidate(c));var u=r.splitSections(n.localDescription.sdp);-1===s.candidate.candidate.indexOf("typ endOfCandidates")?u[s.candidate.sdpMLineIndex+1]+="a="+s.candidate.candidate+"\r\n":u[s.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n",n.localDescription.sdp=u.join("");var p=n.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});switch(n.iceGatheringState){case"new":n._localIceCandidatesBuffer.push(s),d&&p&&n._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":n._emitBufferedCandidates(),n.dispatchEvent(s),null!==n.onicecandidate&&n.onicecandidate(s),p&&(n.dispatchEvent(new Event("icecandidate")),null!==n.onicecandidate&&n.onicecandidate(new Event("icecandidate")),n.iceGatheringState="complete")}},o.onicestatechange=function(){n._updateConnectionState()};var a=new RTCDtlsTransport(o);return a.ondtlsstatechange=function(){n._updateConnectionState()},a.onerror=function(){a.state="failed",n._updateConnectionState()},{iceGatherer:i,iceTransport:o,dtlsTransport:a}},window.RTCPeerConnection.prototype._transceive=function(e,t,n){var i=this._getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:r.localCName},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),n&&e.rtpReceiver&&(i.encodings=e.recvEncodingParameters,i.rtcp={cname:e.cname},e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},window.RTCPeerConnection.prototype.setLocalDescription=function(e){var t,n,i=this;if("offer"===e.type)this._pendingOffer&&(t=r.splitSections(e.sdp),n=t.shift(),t.forEach(function(e,t){var n=r.parseRtpParameters(e);i._pendingOffer[t].localCapabilities=n}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===e.type){t=r.splitSections(i.remoteDescription.sdp),n=t.shift();var o=r.matchPrefix(n,"a=ice-lite").length>0;t.forEach(function(e,t){var a=i.transceivers[t],s=a.iceGatherer,c=a.iceTransport,d=a.dtlsTransport,u=a.localCapabilities,p=a.remoteCapabilities;if(!("0"===e.split("\n",1)[0].split(" ",2)[1])){var l=r.getIceParameters(e,n);if(o){var f=r.matchPrefix(e,"a=candidate:").map(function(e){return r.parseCandidate(e)}).filter(function(e){return"1"===e.component});f.length&&c.setRemoteCandidates(f)}var h=r.getDtlsParameters(e,n);o&&(h.role="server"),i.usingBundle&&0!==t||(c.start(s,l,o?"controlling":"controlled"),d.start(h));var m=i._getCommonCapabilities(u,p);i._transceive(a,m.codecs.length>0,!1)}})}switch(this.localDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var a=arguments.length>1&&"function"==typeof arguments[1];if(a){var s=arguments[1];window.setTimeout(function(){s(),"new"===i.iceGatheringState&&(i.iceGatheringState="gathering"),i._emitBufferedCandidates()},0)}var c=Promise.resolve();return c.then(function(){a||("new"===i.iceGatheringState&&(i.iceGatheringState="gathering"),window.setTimeout(i._emitBufferedCandidates.bind(i),500))}),c},window.RTCPeerConnection.prototype.setRemoteDescription=function(e){var t=this,n=new MediaStream,i=[],o=r.splitSections(e.sdp),a=o.shift(),s=r.matchPrefix(a,"a=ice-lite").length>0;switch(this.usingBundle=r.matchPrefix(a,"a=group:BUNDLE ").length>0,o.forEach(function(o,c){var d,u,p,l,f,h,m,g,v,y,b,S,C=r.splitLines(o)[0].substr(2).split(" "),w=C[0],E="0"===C[1],k=r.getDirection(o,a),A=r.parseRtpParameters(o);E||(b=r.getIceParameters(o,a),(S=r.getDtlsParameters(o,a)).role="client"),g=r.parseRtpEncodingParameters(o);var T=r.matchPrefix(o,"a=mid:");T=T.length?T[0].substr(6):r.generateIdentifier();var R,x=r.matchPrefix(o,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];x&&(R=x.value);var P=r.matchPrefix(o,"a=end-of-candidates").length>0,L=r.matchPrefix(o,"a=candidate:").map(function(e){return r.parseCandidate(e)}).filter(function(e){return"1"===e.component});if("offer"!==e.type||E)"answer"!==e.type||E||(u=(d=t.transceivers[c]).iceGatherer,p=d.iceTransport,l=d.dtlsTransport,f=d.rtpSender,h=d.rtpReceiver,m=d.sendEncodingParameters,v=d.localCapabilities,t.transceivers[c].recvEncodingParameters=g,t.transceivers[c].remoteCapabilities=A,t.transceivers[c].cname=R,(s||P)&&L.length&&p.setRemoteCandidates(L),t.usingBundle&&0!==c||(p.start(u,b,"controlling"),l.start(S)),t._transceive(d,"sendrecv"===k||"recvonly"===k,"sendrecv"===k||"sendonly"===k),!h||"sendrecv"!==k&&"sendonly"!==k?delete d.rtpReceiver:(y=h.track,i.push([y,h]),n.addTrack(y)));else{var O=t.usingBundle&&c>0?{iceGatherer:t.transceivers[0].iceGatherer,iceTransport:t.transceivers[0].iceTransport,dtlsTransport:t.transceivers[0].dtlsTransport}:t._createIceAndDtlsTransports(T,c);if(P&&O.iceTransport.setRemoteCandidates(L),v=RTCRtpReceiver.getCapabilities(w),m=[{ssrc:1001*(2*c+2)}],h=new RTCRtpReceiver(O.dtlsTransport,w),y=h.track,i.push([y,h]),n.addTrack(y),t.localStreams.length>0&&t.localStreams[0].getTracks().length>=c){var I=t.localStreams[0].getTracks()[c];f=new RTCRtpSender(I,O.dtlsTransport)}t.transceivers[c]={iceGatherer:O.iceGatherer,iceTransport:O.iceTransport,dtlsTransport:O.dtlsTransport,localCapabilities:v,remoteCapabilities:A,rtpSender:f,rtpReceiver:h,kind:w,mid:T,cname:R,sendEncodingParameters:m,recvEncodingParameters:g},t._transceive(t.transceivers[c],!1,"sendrecv"===k||"sendonly"===k)}}),this.remoteDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}return n.getTracks().length&&(t.remoteStreams.push(n),window.setTimeout(function(){var e=new Event("addstream");e.stream=n,t.dispatchEvent(e),null!==t.onaddstream&&window.setTimeout(function(){t.onaddstream(e)},0),i.forEach(function(r){var i=r[0],o=r[1],a=new Event("track");a.track=i,a.receiver=o,a.streams=[n],t.dispatchEvent(e),null!==t.ontrack&&window.setTimeout(function(){t.ontrack(a)},0)})},0)),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},window.RTCPeerConnection.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t),null!==this.onsignalingstatechange&&this.onsignalingstatechange(t)},window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var e=new Event("negotiationneeded");this.dispatchEvent(e),null!==this.onnegotiationneeded&&this.onnegotiationneeded(e)},window.RTCPeerConnection.prototype._updateConnectionState=function(){var e,t=this,n={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(e){n[e.iceTransport.state]++,n[e.dtlsTransport.state]++}),n.connected+=n.completed,e="new",n.failed>0?e="failed":n.connecting>0||n.checking>0?e="connecting":n.disconnected>0?e="disconnected":n.new>0?e="new":(n.connected>0||n.completed>0)&&(e="connected"),e!==t.iceConnectionState){t.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this.dispatchEvent(r),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(r)}},window.RTCPeerConnection.prototype.createOffer=function(){var e=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var t;1===arguments.length&&"function"!=typeof arguments[0]?t=arguments[0]:3===arguments.length&&(t=arguments[2]);var n=[],i=0,o=0;if(this.localStreams.length&&(i=this.localStreams[0].getAudioTracks().length,o=this.localStreams[0].getVideoTracks().length),t){if(t.mandatory||t.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==t.offerToReceiveAudio&&(i=t.offerToReceiveAudio),void 0!==t.offerToReceiveVideo&&(o=t.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(e){n.push({kind:e.kind,track:e,wantReceive:"audio"===e.kind?i>0:o>0}),"audio"===e.kind?i--:"video"===e.kind&&o--});i>0||o>0;)i>0&&(n.push({kind:"audio",wantReceive:!0}),i--),o>0&&(n.push({kind:"video",wantReceive:!0}),o--);var a=r.writeSessionBoilerplate(),s=[];n.forEach(function(t,n){var i,o,a=t.track,c=t.kind,d=r.generateIdentifier(),u=e.usingBundle&&n>0?{iceGatherer:s[0].iceGatherer,iceTransport:s[0].iceTransport,dtlsTransport:s[0].dtlsTransport}:e._createIceAndDtlsTransports(d,n),p=RTCRtpSender.getCapabilities(c),l=[{ssrc:1001*(2*n+1)}];a&&(i=new RTCRtpSender(a,u.dtlsTransport)),t.wantReceive&&(o=new RTCRtpReceiver(u.dtlsTransport,c)),s[n]={iceGatherer:u.iceGatherer,iceTransport:u.iceTransport,dtlsTransport:u.dtlsTransport,localCapabilities:p,remoteCapabilities:null,rtpSender:i,rtpReceiver:o,kind:c,mid:d,sendEncodingParameters:l,recvEncodingParameters:null}}),this.usingBundle&&(a+="a=group:BUNDLE "+s.map(function(e){return e.mid}).join(" ")+"\r\n"),n.forEach(function(t,n){var i=s[n];a+=r.writeMediaSection(i,i.localCapabilities,"offer",e.localStreams[0])}),this._pendingOffer=s;var c=new RTCSessionDescription({type:"offer",sdp:a});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,c),Promise.resolve(c)},window.RTCPeerConnection.prototype.createAnswer=function(){var e=this,t=r.writeSessionBoilerplate();this.usingBundle&&(t+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(n){var i=e._getCommonCapabilities(n.localCapabilities,n.remoteCapabilities);t+=r.writeMediaSection(n,i,"answer",e.localStreams[0])});var n=new RTCSessionDescription({type:"answer",sdp:t});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,n),Promise.resolve(n)},window.RTCPeerConnection.prototype.addIceCandidate=function(e){if(null===e)this.transceivers.forEach(function(e){e.iceTransport.addRemoteCandidate({})});else{var t=e.sdpMLineIndex;if(e.sdpMid)for(var n=0;n<this.transceivers.length;n++)if(this.transceivers[n].mid===e.sdpMid){t=n;break}var i=this.transceivers[t];if(i){var o=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if("tcp"===o.protocol&&0===o.port)return;if("1"!==o.component)return;"endOfCandidates"===o.type&&(o={}),i.iceTransport.addRemoteCandidate(o);var a=r.splitSections(this.remoteDescription.sdp);a[t+1]+=(o.type?e.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=a.join("")}}return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){t[n]&&e.push(t[n].getStats())})});var t=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(n){var r=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){r.set(t,e[t]),r[t]=e[t]})}),t&&window.setTimeout(t,0,r),n(r)})})}},attachMediaStream:function(e,t){i("DEPRECATED, attachMediaStream will soon be removed."),e.srcObject=t},reattachMediaStream:function(e,t){i("DEPRECATED, reattachMediaStream will soon be removed."),e.srcObject=t.srcObject}};t.exports={shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:e("./getusermedia"),attachMediaStream:o.attachMediaStream,reattachMediaStream:o.reattachMediaStream}},{"../utils":10,"./getusermedia":6,sdp:1}],6:[function(e,t,n){"use strict";t.exports=function(){var e=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},t=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(n){return t(n).catch(function(t){return Promise.reject(e(t))})}}},{}],7:[function(e,t,n){"use strict";var r=e("../utils").log,i=e("../utils").browserDetails,o={shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(){if("object"==typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(e,t){if(i.version<38&&e&&e.iceServers){for(var n=[],r=0;r<e.iceServers.length;r++){var o=e.iceServers[r];if(o.hasOwnProperty("urls"))for(var a=0;a<o.urls.length;a++){var s={url:o.urls[a]};0===o.urls[a].indexOf("turn")&&(s.username=o.username,s.credential=o.credential),n.push(s)}else n.push(e.iceServers[r])}e.iceServers=n}return new mozRTCPeerConnection(e,t)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var e=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===arguments[0]?Promise.resolve():e.apply(this,arguments)};var t=function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t},n=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(e,r,i){return n.apply(this,[e||null]).then(function(e){return t(e)}).then(r,i)}}},attachMediaStream:function(e,t){r("DEPRECATED, attachMediaStream will soon be removed."),e.srcObject=t},reattachMediaStream:function(e,t){r("DEPRECATED, reattachMediaStream will soon be removed."),e.srcObject=t.srcObject}};t.exports={shimOnTrack:o.shimOnTrack,shimSourceObject:o.shimSourceObject,shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:e("./getusermedia"),attachMediaStream:o.attachMediaStream,reattachMediaStream:o.reattachMediaStream}},{"../utils":10,"./getusermedia":8}],8:[function(e,t,n){"use strict";var r=e("../utils").log,i=e("../utils").browserDetails;t.exports=function(){var e=function(e){return{name:{SecurityError:"NotAllowedError",PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},t=function(t,n,o){var a=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||t.push(n),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[n]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof r.ideal?i[n]={min:r.ideal,max:r.ideal}:i[n]=r.ideal,e.advanced.push(i),delete r.ideal,Object.keys(r).length||delete e[n]}}}),t.length&&(e.require=t),e};return t=JSON.parse(JSON.stringify(t)),i.version<38&&(r("spec: "+JSON.stringify(t)),t.audio&&(t.audio=a(t.audio)),t.video&&(t.video=a(t.video)),r("ff37: "+JSON.stringify(t))),navigator.mozGetUserMedia(t,n,function(t){o(e(t))})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:function(e){return new Promise(function(n,r){t(e,n,r)})},addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},i.version<41){var n=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return n().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(i.version<49){var o=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(t){return o(t).catch(function(t){return Promise.reject(e(t))})}}navigator.getUserMedia=function(e,n,r){if(i.version<44)return t(e,n,r);console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"),navigator.mediaDevices.getUserMedia(e).then(n,r)}}},{"../utils":10}],9:[function(e,t,n){"use strict";var r={shimGetUserMedia:function(){navigator.getUserMedia=navigator.webkitGetUserMedia}};t.exports={shimGetUserMedia:r.shimGetUserMedia}},{}],10:[function(e,t,n){"use strict";var r=!0,i={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(r=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},log:function(){if("object"==typeof window){if(r)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},extractVersion:function(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)},detectBrowser:function(){var e={};if(e.browser=null,e.version=null,e.minVersion=null,"undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;if(navigator.mozGetUserMedia)e.browser="firefox",e.version=this.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),e.minVersion=31;else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)e.browser="chrome",e.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),e.minVersion=38;else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return e.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",e;e.browser="safari",e.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/([0-9]+)\./,1),e.minVersion=602}else{if(!navigator.mediaDevices||!navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))return e.browser="Not a supported browser.",e;e.browser="edge",e.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),e.minVersion=10547}return e.version<e.minVersion&&i.log("Browser: "+e.browser+" Version: "+e.version+" < minimum supported version: "+e.minVersion+"\n some things might not work!"),e}};t.exports={log:i.log,disableLog:i.disableLog,browserDetails:i.detectBrowser(),extractVersion:i.extractVersion}},{}]},{},[2])(2)}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).io=e()}}(function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return i(n||e)},u,u.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){t.exports=e("./lib/")},{"./lib/":2}],2:[function(e,t,n){t.exports=e("./socket"),t.exports.parser=e("engine.io-parser")},{"./socket":3,"engine.io-parser":19}],3:[function(e,t,n){(function(n){function r(e,t){if(!(this instanceof r))return new r(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=u(e),t.hostname=e.host,t.secure="https"==e.protocol||"wss"==e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=u(t.host).host),this.secure=null!=t.secure?t.secure:n.location&&"https:"==location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||(n.location?location.hostname:"localhost"),this.port=t.port||(n.location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=l.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized?null:t.rejectUnauthorized;var i="object"==typeof n&&n;i.global===i&&t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),this.open()}function i(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}var o=e("./transports"),a=e("component-emitter"),s=e("debug")("engine.io-client:socket"),c=e("indexof"),d=e("engine.io-parser"),u=e("parseuri"),p=e("parsejson"),l=e("parseqs");t.exports=r,r.priorWebsocketSuccess=!1,a(r.prototype),r.protocol=d.protocol,r.Socket=r,r.Transport=e("./transport"),r.transports=e("./transports"),r.parser=e("engine.io-parser"),r.prototype.createTransport=function(e){s('creating transport "%s"',e);var t=i(this.query);return t.EIO=d.protocol,t.transport=e,this.id&&(t.sid=this.id),new o[e]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:t,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders})},r.prototype.open=function(){var e;if(this.rememberUpgrade&&r.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},r.prototype.setTransport=function(e){s("setting transport %s",e.name);var t=this;this.transport&&(s("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},r.prototype.probe=function(e){function t(){if(l.onlyBinaryUpgrades){var t=!this.supportsBinary&&l.transport.supportsBinary;p=p||t}p||(s('probe transport "%s" opened',e),u.send([{type:"ping",data:"probe"}]),u.once("packet",function(t){if(!p)if("pong"==t.type&&"probe"==t.data){if(s('probe transport "%s" pong',e),l.upgrading=!0,l.emit("upgrading",u),!u)return;r.priorWebsocketSuccess="websocket"==u.name,s('pausing current transport "%s"',l.transport.name),l.transport.pause(function(){p||"closed"!=l.readyState&&(s("changing transport and sending upgrade packet"),d(),l.setTransport(u),u.send([{type:"upgrade"}]),l.emit("upgrade",u),u=null,l.upgrading=!1,l.flush())})}else{s('probe transport "%s" failed',e);var n=new Error("probe error");n.transport=u.name,l.emit("upgradeError",n)}}))}function n(){p||(p=!0,d(),u.close(),u=null)}function i(t){var r=new Error("probe error: "+t);r.transport=u.name,n(),s('probe transport "%s" failed because of error: %s',e,t),l.emit("upgradeError",r)}function o(){i("transport closed")}function a(){i("socket closed")}function c(e){u&&e.name!=u.name&&(s('"%s" works - aborting "%s"',e.name,u.name),n())}function d(){u.removeListener("open",t),u.removeListener("error",i),u.removeListener("close",o),l.removeListener("close",a),l.removeListener("upgrading",c)}s('probing transport "%s"',e);var u=this.createTransport(e,{probe:1}),p=!1,l=this;r.priorWebsocketSuccess=!1,u.once("open",t),u.once("error",i),u.once("close",o),this.once("close",a),this.once("upgrading",c),u.open()},r.prototype.onOpen=function(){if(s("socket open"),this.readyState="open",r.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){s("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},r.prototype.onPacket=function(e){if("opening"==this.readyState||"open"==this.readyState)switch(s('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(p(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else s('packet received with socket readyState "%s"',this.readyState)},r.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},r.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!=t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},r.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){s("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},r.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},r.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},r.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(s("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},r.prototype.write=r.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},r.prototype.sendPacket=function(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!=this.readyState&&"closed"!=this.readyState){(n=n||{}).compress=!1!==n.compress;var i={type:e,data:t,options:n};this.emit("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}},r.prototype.close=function(){function e(){r.onClose("forced close"),s("socket closing - telling transport to close"),r.transport.close()}function t(){r.removeListener("upgrade",t),r.removeListener("upgradeError",t),e()}function n(){r.once("upgrade",t),r.once("upgradeError",t)}if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var r=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():e()}):this.upgrading?n():e()}return this},r.prototype.onError=function(e){s("socket error %j",e),r.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},r.prototype.onClose=function(e,t){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){s('socket close with reason: "%s"',e);var n=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),n.writeBuffer=[],n.prevBufferLen=0}},r.prototype.filterUpgrades=function(e){for(var t=[],n=0,r=e.length;n<r;n++)~c(this.transports,e[n])&&t.push(e[n]);return t}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./transport":4,"./transports":5,"component-emitter":15,debug:17,"engine.io-parser":19,indexof:23,parsejson:26,parseqs:27,parseuri:28}],4:[function(e,t,n){function r(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders}var i=e("engine.io-parser"),o=e("component-emitter");t.exports=r,o(r.prototype),r.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},r.prototype.open=function(){return"closed"!=this.readyState&&""!=this.readyState||(this.readyState="opening",this.doOpen()),this},r.prototype.close=function(){return"opening"!=this.readyState&&"open"!=this.readyState||(this.doClose(),this.onClose()),this},r.prototype.send=function(e){if("open"!=this.readyState)throw new Error("Transport not open");this.write(e)},r.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},r.prototype.onData=function(e){var t=i.decodePacket(e,this.socket.binaryType);this.onPacket(t)},r.prototype.onPacket=function(e){this.emit("packet",e)},r.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":15,"engine.io-parser":19}],5:[function(e,t,n){(function(t){var r=e("xmlhttprequest-ssl"),i=e("./polling-xhr"),o=e("./polling-jsonp"),a=e("./websocket");n.polling=function(e){var n=!1,a=!1,s=!1!==e.jsonp;if(t.location){var c="https:"==location.protocol,d=location.port;d||(d=c?443:80),n=e.hostname!=location.hostname||d!=e.port,a=e.secure!=c}if(e.xdomain=n,e.xscheme=a,"open"in new r(e)&&!e.forceJSONP)return new i(e);if(!s)throw new Error("JSONP disabled");return new o(e)},n.websocket=a}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./polling-jsonp":6,"./polling-xhr":7,"./websocket":9,"xmlhttprequest-ssl":10}],6:[function(e,t,n){(function(n){function r(){}function i(e){o.call(this,e),this.query=this.query||{},s||(n.___eio||(n.___eio=[]),s=n.___eio),this.index=s.length;var t=this;s.push(function(e){t.onData(e)}),this.query.j=this.index,n.document&&n.addEventListener&&n.addEventListener("beforeunload",function(){t.script&&(t.script.onerror=r)},!1)}var o=e("./polling"),a=e("component-inherit");t.exports=i;var s,c=/\n/g,d=/\\n/g;a(i,o),i.prototype.supportsBinary=!1,i.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),o.prototype.doClose.call(this)},i.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},i.prototype.doWrite=function(e,t){function n(){r(),t()}function r(){if(i.iframe)try{i.form.removeChild(i.iframe)}catch(e){i.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+i.iframeId+'">';o=document.createElement(e)}catch(e){(o=document.createElement("iframe")).name=i.iframeId,o.src="javascript:0"}o.id=i.iframeId,i.form.appendChild(o),i.iframe=o}var i=this;if(!this.form){var o,a=document.createElement("form"),s=document.createElement("textarea"),u=this.iframeId="eio_iframe_"+this.index;a.className="socketio",a.style.position="absolute",a.style.top="-1000px",a.style.left="-1000px",a.target=u,a.method="POST",a.setAttribute("accept-charset","utf-8"),s.name="d",a.appendChild(s),document.body.appendChild(a),this.form=a,this.area=s}this.form.action=this.uri(),r(),e=e.replace(d,"\\\n"),this.area.value=e.replace(c,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==i.iframe.readyState&&n()}:this.iframe.onload=n}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./polling":8,"component-inherit":16}],7:[function(e,t,n){(function(n){function r(){}function i(e){if(c.call(this,e),n.location){var t="https:"==location.protocol,r=location.port;r||(r=t?443:80),this.xd=e.hostname!=n.location.hostname||r!=e.port,this.xs=e.secure!=t}else this.extraHeaders=e.extraHeaders}function o(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!=e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function a(){for(var e in o.requests)o.requests.hasOwnProperty(e)&&o.requests[e].abort()}var s=e("xmlhttprequest-ssl"),c=e("./polling"),d=e("component-emitter"),u=e("component-inherit"),p=e("debug")("engine.io-client:polling-xhr");t.exports=i,t.exports.Request=o,u(i,c),i.prototype.supportsBinary=!0,i.prototype.request=function(e){return e=e||{},e.uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.extraHeaders=this.extraHeaders,new o(e)},i.prototype.doWrite=function(e,t){var n="string"!=typeof e&&void 0!==e,r=this.request({method:"POST",data:e,isBinary:n}),i=this;r.on("success",t),r.on("error",function(e){i.onError("xhr post error",e)}),this.sendXhr=r},i.prototype.doPoll=function(){p("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},d(o.prototype),o.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new s(e),r=this;try{p("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders){t.setDisableHeaderCheck(!0);for(var i in this.extraHeaders)this.extraHeaders.hasOwnProperty(i)&&t.setRequestHeader(i,this.extraHeaders[i])}}catch(e){}if(this.supportsBinary&&(t.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}"withCredentials"in t&&(t.withCredentials=!0),this.hasXDR()?(t.onload=function(){r.onLoad()},t.onerror=function(){r.onError(t.responseText)}):t.onreadystatechange=function(){4==t.readyState&&(200==t.status||1223==t.status?r.onLoad():setTimeout(function(){r.onError(t.status)},0))},p("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout(function(){r.onError(e)},0)}n.document&&(this.index=o.requestsCount++,o.requests[this.index]=this)},o.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},o.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},o.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},o.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=r:this.xhr.onreadystatechange=r,e)try{this.xhr.abort()}catch(e){}n.document&&delete o.requests[this.index],this.xhr=null}},o.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(e){}if("application/octet-stream"===t)e=this.xhr.response;else if(this.supportsBinary)try{e=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(t){for(var n=new Uint8Array(this.xhr.response),r=[],i=0,o=n.length;i<o;i++)r.push(n[i]);e=String.fromCharCode.apply(null,r)}else e=this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},o.prototype.hasXDR=function(){return void 0!==n.XDomainRequest&&!this.xs&&this.enablesXDR},o.prototype.abort=function(){this.cleanup()},n.document&&(o.requestsCount=0,o.requests={},n.attachEvent?n.attachEvent("onunload",a):n.addEventListener&&n.addEventListener("beforeunload",a,!1))}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./polling":8,"component-emitter":15,"component-inherit":16,debug:17,"xmlhttprequest-ssl":10}],8:[function(e,t,n){function r(e){var t=e&&e.forceBase64;u&&!t||(this.supportsBinary=!1),i.call(this,e)}var i=e("../transport"),o=e("parseqs"),a=e("engine.io-parser"),s=e("component-inherit"),c=e("yeast"),d=e("debug")("engine.io-client:polling");t.exports=r;var u=null!=new(e("xmlhttprequest-ssl"))({xdomain:!1}).responseType;s(r,i),r.prototype.name="polling",r.prototype.doOpen=function(){this.poll()},r.prototype.pause=function(e){function t(){d("paused"),n.readyState="paused",e()}var n=this;if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(d("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){d("pre-pause polling complete"),--r||t()})),this.writable||(d("we are currently writing - waiting to pause"),r++,this.once("drain",function(){d("pre-pause writing complete"),--r||t()}))}else t()},r.prototype.poll=function(){d("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},r.prototype.onData=function(e){var t=this;d("polling got data %s",e);a.decodePayload(e,this.socket.binaryType,function(e,n,r){if("opening"==t.readyState&&t.onOpen(),"close"==e.type)return t.onClose(),!1;t.onPacket(e)}),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():d('ignoring poll - transport state "%s"',this.readyState))},r.prototype.doClose=function(){function e(){d("writing close packet"),t.write([{type:"close"}])}var t=this;"open"==this.readyState?(d("transport open - closing"),e()):(d("transport not open - deferring close"),this.once("open",e))},r.prototype.write=function(e){n=this;this.writable=!1;var t=function(){n.writable=!0,n.emit("drain")},n=this;a.encodePayload(e,this.supportsBinary,function(e){n.doWrite(e,t)})},r.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||e.sid||(e.b64=1),e=o.encode(e),this.port&&("https"==t&&443!=this.port||"http"==t&&80!=this.port)&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e}},{"../transport":4,"component-inherit":16,debug:17,"engine.io-parser":19,parseqs:27,"xmlhttprequest-ssl":10,yeast:30}],9:[function(e,t,n){(function(n){function r(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,i.call(this,e)}var i=e("../transport"),o=e("engine.io-parser"),a=e("parseqs"),s=e("component-inherit"),c=e("yeast"),d=e("debug")("engine.io-client:websocket"),u=n.WebSocket||n.MozWebSocket,p=u;if(!p&&"undefined"==typeof window)try{p=e("ws")}catch(e){}t.exports=r,s(r,i),r.prototype.name="websocket",r.prototype.supportsBinary=!0,r.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t={agent:this.agent,perMessageDeflate:this.perMessageDeflate};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(t.headers=this.extraHeaders),this.ws=u?new p(e):new p(e,void 0,t),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="buffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},r.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(r.prototype.onData=function(e){var t=this;setTimeout(function(){i.prototype.onData.call(t,e)},0)}),r.prototype.write=function(e){function t(){r.emit("flush"),setTimeout(function(){r.writable=!0,r.emit("drain")},0)}var r=this;this.writable=!1;for(var i=e.length,a=0,s=i;a<s;a++)!function(e){o.encodePacket(e,r.supportsBinary,function(o){if(!u){var a={};e.options&&(a.compress=e.options.compress),r.perMessageDeflate&&("string"==typeof o?n.Buffer.byteLength(o):o.length)<r.perMessageDeflate.threshold&&(a.compress=!1)}try{u?r.ws.send(o):r.ws.send(o,a)}catch(e){d("websocket closed before onclose event")}--i||t()})}(e[a])},r.prototype.onClose=function(){i.prototype.onClose.call(this)},r.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},r.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"==t&&443!=this.port||"ws"==t&&80!=this.port)&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||(e.b64=1),(e=a.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},r.prototype.check=function(){return!(!p||"__initialize"in p&&this.name===r.prototype.name)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"../transport":4,"component-inherit":16,debug:17,"engine.io-parser":19,parseqs:27,ws:void 0,yeast:30}],10:[function(e,t,n){var r=e("has-cors");t.exports=function(e){var t=e.xdomain,n=e.xscheme,i=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||r))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!n&&i)return new XDomainRequest}catch(e){}if(!t)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}},{"has-cors":22}],11:[function(e,t,n){function r(){}t.exports=function(e,t,n){function i(e,r){if(i.count<=0)throw new Error("after called too many times");--i.count,e?(o=!0,t(e),t=n):0!==i.count||o||t(null,r)}var o=!1;return n=n||r,i.count=e,0===e?t():i}},{}],12:[function(e,t,n){t.exports=function(e,t,n){var r=e.byteLength;if(t=t||0,n=n||r,e.slice)return e.slice(t,n);if(t<0&&(t+=r),n<0&&(n+=r),n>r&&(n=r),t>=r||t>=n||0===r)return new ArrayBuffer(0);for(var i=new Uint8Array(e),o=new Uint8Array(n-t),a=t,s=0;a<n;a++,s++)o[s]=i[a];return o.buffer}},{}],13:[function(e,t,n){!function(e){"use strict";n.encode=function(t){var n,r=new Uint8Array(t),i=r.length,o="";for(n=0;n<i;n+=3)o+=e[r[n]>>2],o+=e[(3&r[n])<<4|r[n+1]>>4],o+=e[(15&r[n+1])<<2|r[n+2]>>6],o+=e[63&r[n+2]];return i%3==2?o=o.substring(0,o.length-1)+"=":i%3==1&&(o=o.substring(0,o.length-2)+"=="),o},n.decode=function(t){var n,r,i,o,a,s=.75*t.length,c=t.length,d=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);var u=new ArrayBuffer(s),p=new Uint8Array(u);for(n=0;n<c;n+=4)r=e.indexOf(t[n]),i=e.indexOf(t[n+1]),o=e.indexOf(t[n+2]),a=e.indexOf(t[n+3]),p[d++]=r<<2|i>>4,p[d++]=(15&i)<<4|o>>2,p[d++]=(3&o)<<6|63&a;return u}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],14:[function(e,t,n){(function(e){function n(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.buffer instanceof ArrayBuffer){var r=n.buffer;if(n.byteLength!==r.byteLength){var i=new Uint8Array(n.byteLength);i.set(new Uint8Array(r,n.byteOffset,n.byteLength)),r=i.buffer}e[t]=r}}}function r(e,t){t=t||{};var r=new o;n(e);for(var i=0;i<e.length;i++)r.append(e[i]);return t.type?r.getBlob(t.type):r.getBlob()}function i(e,t){return n(e),new Blob(e,t||{})}var o=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder,a=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),s=a&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),c=o&&o.prototype.append&&o.prototype.getBlob;t.exports=a?s?e.Blob:i:c?r:void 0}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],15:[function(e,t,n){function r(e){if(e)return i(e)}function i(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}t.exports=r,r.prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},r.prototype.once=function(e,t){function n(){r.off(e,n),t.apply(this,arguments)}var r=this;return this._callbacks=this._callbacks||{},n.fn=t,this.on(e,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks[e];if(!n)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var r,i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks[e];if(n)for(var r=0,i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,t);return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],16:[function(e,t,n){t.exports=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],17:[function(e,t,n){function r(){var e;try{e=n.storage.debug}catch(e){}return e}(n=t.exports=e("./debug")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},n.formatArgs=function(){var e=arguments,t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+n.humanize(this.diff),!t)return e;var r="color: "+this.color,i=0,o=0;return(e=[e[0],r,"color: inherit"].concat(Array.prototype.slice.call(e,1)))[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))}),e.splice(o,0,r),e},n.save=function(e){try{null==e?n.storage.removeItem("debug"):n.storage.debug=e}catch(e){}},n.load=r,n.useColors=function(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31},n.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),n.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],n.formatters.j=function(e){return JSON.stringify(e)},n.enable(r())},{"./debug":18}],18:[function(e,t,n){function r(){return n.colors[o++%n.colors.length]}(n=t.exports=function(e){function t(){}function o(){var e=o,t=+new Date,a=t-(i||t);e.diff=a,e.prev=i,e.curr=t,i=t,null==e.useColors&&(e.useColors=n.useColors()),null==e.color&&e.useColors&&(e.color=r());var s=Array.prototype.slice.call(arguments);s[0]=n.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var c=0;s[0]=s[0].replace(/%([a-z%])/g,function(t,r){if("%%"===t)return t;c++;var i=n.formatters[r];if("function"==typeof i){var o=s[c];t=i.call(e,o),s.splice(c,1),c--}return t}),"function"==typeof n.formatArgs&&(s=n.formatArgs.apply(e,s)),(o.log||n.log||console.log.bind(console)).apply(e,s)}t.enabled=!1,o.enabled=!0;var a=n.enabled(e)?o:t;return a.namespace=e,a}).coerce=function(e){return e instanceof Error?e.stack||e.message:e},n.disable=function(){n.enable("")},n.enable=function(e){n.save(e);for(var t=(e||"").split(/[\s,]+/),r=t.length,i=0;i<r;i++)t[i]&&("-"===(e=t[i].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")))},n.enabled=function(e){var t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=e("ms"),n.names=[],n.skips=[],n.formatters={};var i,o=0},{ms:25}],19:[function(e,t,n){(function(t){function r(e,t){return t("b"+n.packets[e.type]+e.data.data)}function i(e,t,r){if(!t)return n.encodeBase64Packet(e,r);var i=e.data,o=new Uint8Array(i),a=new Uint8Array(1+i.byteLength);a[0]=v[e.type];for(var s=0;s<o.length;s++)a[s+1]=o[s];return r(a.buffer)}function o(e,t,r){if(!t)return n.encodeBase64Packet(e,r);var i=new FileReader;return i.onload=function(){e.data=i.result,n.encodePacket(e,t,!0,r)},i.readAsArrayBuffer(e.data)}function a(e,t,r){if(!t)return n.encodeBase64Packet(e,r);if(g)return o(e,t,r);var i=new Uint8Array(1);return i[0]=v[e.type],r(new S([i.buffer,e.data]))}function s(e,t,n){for(var r=new Array(e.length),i=l(e.length,n),o=0;o<e.length;o++)!function(e,n,i){t(n,function(t,n){r[e]=n,i(t,r)})}(o,e[o],i)}var c=e("./keys"),d=e("has-binary"),u=e("arraybuffer.slice"),p=e("base64-arraybuffer"),l=e("after"),f=e("utf8"),h=navigator.userAgent.match(/Android/i),m=/PhantomJS/i.test(navigator.userAgent),g=h||m;n.protocol=3;var v=n.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},y=c(v),b={type:"error",data:"parser error"},S=e("blob");n.encodePacket=function(e,n,o,s){"function"==typeof n&&(s=n,n=!1),"function"==typeof o&&(s=o,o=null);var c=void 0===e.data?void 0:e.data.buffer||e.data;if(t.ArrayBuffer&&c instanceof ArrayBuffer)return i(e,n,s);if(S&&c instanceof t.Blob)return a(e,n,s);if(c&&c.base64)return r(e,s);var d=v[e.type];return void 0!==e.data&&(d+=o?f.encode(String(e.data)):String(e.data)),s(""+d)},n.encodeBase64Packet=function(e,r){var i="b"+n.packets[e.type];if(S&&e.data instanceof t.Blob){var o=new FileReader;return o.onload=function(){var e=o.result.split(",")[1];r(i+e)},o.readAsDataURL(e.data)}var a;try{a=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var s=new Uint8Array(e.data),c=new Array(s.length),d=0;d<s.length;d++)c[d]=s[d];a=String.fromCharCode.apply(null,c)}return i+=t.btoa(a),r(i)},n.decodePacket=function(e,t,r){if("string"==typeof e||void 0===e){if("b"==e.charAt(0))return n.decodeBase64Packet(e.substr(1),t);if(r)try{e=f.decode(e)}catch(e){return b}i=e.charAt(0);return Number(i)==i&&y[i]?e.length>1?{type:y[i],data:e.substring(1)}:{type:y[i]}:b}var i=new Uint8Array(e)[0],o=u(e,1);return S&&"blob"===t&&(o=new S([o])),{type:y[i],data:o}},n.decodeBase64Packet=function(e,n){var r=y[e.charAt(0)];if(!t.ArrayBuffer)return{type:r,data:{base64:!0,data:e.substr(1)}};var i=p.decode(e.substr(1));return"blob"===n&&S&&(i=new S([i])),{type:r,data:i}},n.encodePayload=function(e,t,r){function i(e){return e.length+":"+e}"function"==typeof t&&(r=t,t=null);var o=d(e);return t&&o?S&&!g?n.encodePayloadAsBlob(e,r):n.encodePayloadAsArrayBuffer(e,r):e.length?void s(e,function(e,r){n.encodePacket(e,!!o&&t,!0,function(e){r(null,i(e))})},function(e,t){return r(t.join(""))}):r("0:")},n.decodePayload=function(e,t,r){if("string"!=typeof e)return n.decodePayloadAsBinary(e,t,r);"function"==typeof t&&(r=t,t=null);var i;if(""==e)return r(b,0,1);for(var o,a,s="",c=0,d=e.length;c<d;c++){var u=e.charAt(c);if(":"!=u)s+=u;else{if(""==s||s!=(o=Number(s)))return r(b,0,1);if(a=e.substr(c+1,o),s!=a.length)return r(b,0,1);if(a.length){if(i=n.decodePacket(a,t,!0),b.type==i.type&&b.data==i.data)return r(b,0,1);if(!1===r(i,c+o,d))return}c+=o,s=""}}return""!=s?r(b,0,1):void 0},n.encodePayloadAsArrayBuffer=function(e,t){if(!e.length)return t(new ArrayBuffer(0));s(e,function(e,t){n.encodePacket(e,!0,!0,function(e){return t(null,e)})},function(e,n){var r=n.reduce(function(e,t){var n;return n="string"==typeof t?t.length:t.byteLength,e+n.toString().length+n+2},0),i=new Uint8Array(r),o=0;return n.forEach(function(e){var t="string"==typeof e,n=e;if(t){for(var r=new Uint8Array(e.length),a=0;a<e.length;a++)r[a]=e.charCodeAt(a);n=r.buffer}i[o++]=t?0:1;for(var s=n.byteLength.toString(),a=0;a<s.length;a++)i[o++]=parseInt(s[a]);i[o++]=255;for(var r=new Uint8Array(n),a=0;a<r.length;a++)i[o++]=r[a]}),t(i.buffer)})},n.encodePayloadAsBlob=function(e,t){s(e,function(e,t){n.encodePacket(e,!0,!0,function(e){var n=new Uint8Array(1);if(n[0]=1,"string"==typeof e){for(var r=new Uint8Array(e.length),i=0;i<e.length;i++)r[i]=e.charCodeAt(i);e=r.buffer,n[0]=0}for(var o=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),a=new Uint8Array(o.length+1),i=0;i<o.length;i++)a[i]=parseInt(o[i]);if(a[o.length]=255,S){var s=new S([n.buffer,a.buffer,e]);t(null,s)}})},function(e,n){return t(new S(n))})},n.decodePayloadAsBinary=function(e,t,r){"function"==typeof t&&(r=t,t=null);for(var i=e,o=[],a=!1;i.byteLength>0;){for(var s=new Uint8Array(i),c=0===s[0],d="",p=1;255!=s[p];p++){if(d.length>310){a=!0;break}d+=s[p]}if(a)return r(b,0,1);i=u(i,2+d.length),d=parseInt(d);var l=u(i,0,d);if(c)try{l=String.fromCharCode.apply(null,new Uint8Array(l))}catch(e){var f=new Uint8Array(l);l="";for(p=0;p<f.length;p++)l+=String.fromCharCode(f[p])}o.push(l),i=u(i,d)}var h=o.length;o.forEach(function(e,i){r(n.decodePacket(e,t,!0),i,h)})}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./keys":20,after:11,"arraybuffer.slice":12,"base64-arraybuffer":13,blob:14,"has-binary":21,utf8:29}],20:[function(e,t,n){t.exports=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var r in e)n.call(e,r)&&t.push(r);return t}},{}],21:[function(e,t,n){(function(n){var r=e("isarray");t.exports=function(e){function t(e){if(!e)return!1;if(n.Buffer&&n.Buffer.isBuffer(e)||n.ArrayBuffer&&e instanceof ArrayBuffer||n.Blob&&e instanceof Blob||n.File&&e instanceof File)return!0;if(r(e)){for(var i=0;i<e.length;i++)if(t(e[i]))return!0}else if(e&&"object"==typeof e){e.toJSON&&(e=e.toJSON());for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)&&t(e[o]))return!0}return!1}return t(e)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{isarray:24}],22:[function(e,t,n){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}},{}],23:[function(e,t,n){var r=[].indexOf;t.exports=function(e,t){if(r)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}},{}],24:[function(e,t,n){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],25:[function(e,t,n){function r(e){if(!((e=""+e).length>1e4)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*p;case"days":case"day":case"d":return n*u;case"hours":case"hour":case"hrs":case"hr":case"h":return n*d;case"minutes":case"minute":case"mins":case"min":case"m":return n*c;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n}}}}function i(e){return e>=u?Math.round(e/u)+"d":e>=d?Math.round(e/d)+"h":e>=c?Math.round(e/c)+"m":e>=s?Math.round(e/s)+"s":e+"ms"}function o(e){return a(e,u,"day")||a(e,d,"hour")||a(e,c,"minute")||a(e,s,"second")||e+" ms"}function a(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var s=1e3,c=60*s,d=60*c,u=24*d,p=365.25*u;t.exports=function(e,t){return t=t||{},"string"==typeof e?r(e):t.long?o(e):i(e)}},{}],26:[function(e,t,n){(function(e){var n=/^[\],:{}\s]*$/,r=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,i=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,o=/(?:^|:|,)(?:\s*\[)+/g,a=/^\s+/,s=/\s+$/;t.exports=function(t){return"string"==typeof t&&t?(t=t.replace(a,"").replace(s,""),e.JSON&&JSON.parse?JSON.parse(t):n.test(t.replace(r,"@").replace(i,"]").replace(o,""))?new Function("return "+t)():void 0):null}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],27:[function(e,t,n){n.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},n.decode=function(e){for(var t={},n=e.split("&"),r=0,i=n.length;r<i;r++){var o=n[r].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}},{}],28:[function(e,t,n){var r=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(e){var t=e,n=e.indexOf("["),o=e.indexOf("]");-1!=n&&-1!=o&&(e=e.substring(0,n)+e.substring(n,o).replace(/:/g,";")+e.substring(o,e.length));for(var a=r.exec(e||""),s={},c=14;c--;)s[i[c]]=a[c]||"";return-1!=n&&-1!=o&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s}},{}],29:[function(e,t,n){(function(e){!function(r){function i(e){for(var t,n,r=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function o(e){for(var t,n=e.length,r=-1,i="";++r<n;)(t=e[r])>65535&&(i+=v((t-=65536)>>>10&1023|55296),t=56320|1023&t),i+=v(t);return i}function a(e){if(e>=55296&&e<=57343)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}function s(e,t){return v(e>>t&63|128)}function c(e){if(0==(4294967168&e))return v(e);var t="";return 0==(4294965248&e)?t=v(e>>6&31|192):0==(4294901760&e)?(a(e),t=v(e>>12&15|224),t+=s(e,6)):0==(4292870144&e)&&(t=v(e>>18&7|240),t+=s(e,12),t+=s(e,6)),t+=v(63&e|128)}function d(){if(g>=m)throw Error("Invalid byte index");var e=255&h[g];if(g++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function u(){var e,t,n,r,i;if(g>m)throw Error("Invalid byte index");if(g==m)return!1;if(e=255&h[g],g++,0==(128&e))return e;if(192==(224&e)){if((i=(31&e)<<6|(t=d()))>=128)return i;throw Error("Invalid continuation byte")}if(224==(240&e)){if(t=d(),n=d(),(i=(15&e)<<12|t<<6|n)>=2048)return a(i),i;throw Error("Invalid continuation byte")}if(240==(248&e)&&(t=d(),n=d(),r=d(),(i=(15&e)<<18|t<<12|n<<6|r)>=65536&&i<=1114111))return i;throw Error("Invalid UTF-8 detected")}var p="object"==typeof n&&n,l="object"==typeof t&&t&&t.exports==p&&t,f="object"==typeof e&&e;f.global!==f&&f.window!==f||(r=f);var h,m,g,v=String.fromCharCode,y={version:"2.0.0",encode:function(e){for(var t=i(e),n=t.length,r=-1,o="";++r<n;)o+=c(t[r]);return o},decode:function(e){h=i(e),m=h.length,g=0;for(var t,n=[];!1!==(t=u());)n.push(t);return o(n)}};if(p&&!p.nodeType)if(l)l.exports=y;else{var b={}.hasOwnProperty;for(var S in y)b.call(y,S)&&(p[S]=y[S])}else r.utf8=y}(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],30:[function(e,t,n){"use strict";function r(e){var t="";do{t=a[e%s]+t,e=Math.floor(e/s)}while(e>0);return t}function i(){var e=r(+new Date);return e!==o?(d=0,o=e):e+"."+r(d++)}for(var o,a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),s=64,c={},d=0,u=0;u<s;u++)c[a[u]]=u;i.encode=r,i.decode=function(e){var t=0;for(u=0;u<e.length;u++)t=t*s+c[e.charAt(u)];return t},t.exports=i},{}],31:[function(e,t,n){function r(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,r=i(e),o=r.source,d=r.id,u=r.path,p=c[d]&&u in c[d].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||p?(s("ignoring socket cache for %s",o),n=a(o,t)):(c[d]||(s("new io instance for %s",o),c[d]=a(o,t)),n=c[d]),n.socket(r.path)}var i=e("./url"),o=e("socket.io-parser"),a=e("./manager"),s=e("debug")("socket.io-client");t.exports=n=r;var c=n.managers={};n.protocol=o.protocol,n.connect=r,n.Manager=e("./manager"),n.Socket=e("./socket")},{"./manager":32,"./socket":34,"./url":35,debug:39,"socket.io-parser":47}],32:[function(e,t,n){function r(e,t){if(!(this instanceof r))return new r(e,t);e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new l({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[],this.encoder=new s.Encoder,this.decoder=new s.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}var i=e("engine.io-client"),o=e("./socket"),a=e("component-emitter"),s=e("socket.io-parser"),c=e("./on"),d=e("component-bind"),u=e("debug")("socket.io-client:manager"),p=e("indexof"),l=e("backo2"),f=Object.prototype.hasOwnProperty;t.exports=r,r.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var e in this.nsps)f.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},r.prototype.updateSocketIds=function(){for(var e in this.nsps)f.call(this.nsps,e)&&(this.nsps[e].id=this.engine.id)},a(r.prototype),r.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},r.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},r.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},r.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},r.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},r.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},r.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},r.prototype.open=r.prototype.connect=function(e){if(u("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;u("opening %s",this.uri),this.engine=i(this.uri,this.opts);var t=this.engine,n=this;this.readyState="opening",this.skipReconnect=!1;var r=c(t,"open",function(){n.onopen(),e&&e()}),o=c(t,"error",function(t){if(u("connect_error"),n.cleanup(),n.readyState="closed",n.emitAll("connect_error",t),e){var r=new Error("Connection error");r.data=t,e(r)}else n.maybeReconnectOnOpen()});if(!1!==this._timeout){var a=this._timeout;u("connect attempt will timeout after %d",a);var s=setTimeout(function(){u("connect attempt timed out after %d",a),r.destroy(),t.close(),t.emit("error","timeout"),n.emitAll("connect_timeout",a)},a);this.subs.push({destroy:function(){clearTimeout(s)}})}return this.subs.push(r),this.subs.push(o),this},r.prototype.onopen=function(){u("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(c(e,"data",d(this,"ondata"))),this.subs.push(c(e,"ping",d(this,"onping"))),this.subs.push(c(e,"pong",d(this,"onpong"))),this.subs.push(c(e,"error",d(this,"onerror"))),this.subs.push(c(e,"close",d(this,"onclose"))),this.subs.push(c(this.decoder,"decoded",d(this,"ondecoded")))},r.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},r.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},r.prototype.ondata=function(e){this.decoder.add(e)},r.prototype.ondecoded=function(e){this.emit("packet",e)},r.prototype.onerror=function(e){u("error",e),this.emitAll("error",e)},r.prototype.socket=function(e){function t(){~p(r.connecting,n)||r.connecting.push(n)}var n=this.nsps[e];if(!n){n=new o(this,e),this.nsps[e]=n;var r=this;n.on("connecting",t),n.on("connect",function(){n.id=r.engine.id}),this.autoConnect&&t()}return n},r.prototype.destroy=function(e){var t=p(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},r.prototype.packet=function(e){u("writing packet %j",e);var t=this;t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(n){for(var r=0;r<n.length;r++)t.engine.write(n[r],e.options);t.encoding=!1,t.processPacketQueue()}))},r.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},r.prototype.cleanup=function(){u("cleanup");for(var e;e=this.subs.shift();)e.destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},r.prototype.close=r.prototype.disconnect=function(){u("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"==this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},r.prototype.onclose=function(e){u("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},r.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)u("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();u("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout(function(){e.skipReconnect||(u("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(u("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(u("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(n)}})}},r.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},{"./on":33,"./socket":34,backo2:36,"component-bind":37,"component-emitter":38,debug:39,"engine.io-client":1,indexof:42,"socket.io-parser":47}],33:[function(e,t,n){t.exports=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}},{}],34:[function(e,t,n){function r(e,t){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.io.autoConnect&&this.open()}var i=e("socket.io-parser"),o=e("component-emitter"),a=e("to-array"),s=e("./on"),c=e("component-bind"),d=e("debug")("socket.io-client:socket"),u=e("has-binary");t.exports=r;var p={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},l=o.prototype.emit;o(r.prototype),r.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[s(e,"open",c(this,"onopen")),s(e,"packet",c(this,"onpacket")),s(e,"close",c(this,"onclose"))]}},r.prototype.open=r.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"==this.io.readyState&&this.onopen(),this.emit("connecting"),this)},r.prototype.send=function(){var e=a(arguments);return e.unshift("message"),this.emit.apply(this,e),this},r.prototype.emit=function(e){if(p.hasOwnProperty(e))return l.apply(this,arguments),this;var t=a(arguments),n=i.EVENT;u(t)&&(n=i.BINARY_EVENT);var r={type:n,data:t};return r.options={},r.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(d("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),r.id=this.ids++),this.connected?this.packet(r):this.sendBuffer.push(r),delete this.flags,this},r.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},r.prototype.onopen=function(){d("transport is open - connecting"),"/"!=this.nsp&&this.packet({type:i.CONNECT})},r.prototype.onclose=function(e){d("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},r.prototype.onpacket=function(e){if(e.nsp==this.nsp)switch(e.type){case i.CONNECT:this.onconnect();break;case i.EVENT:case i.BINARY_EVENT:this.onevent(e);break;case i.ACK:case i.BINARY_ACK:this.onack(e);break;case i.DISCONNECT:this.ondisconnect();break;case i.ERROR:this.emit("error",e.data)}},r.prototype.onevent=function(e){var t=e.data||[];d("emitting event %j",t),null!=e.id&&(d("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?l.apply(this,t):this.receiveBuffer.push(t)},r.prototype.ack=function(e){var t=this,n=!1;return function(){if(!n){n=!0;var r=a(arguments);d("sending ack %j",r);var o=u(r)?i.BINARY_ACK:i.ACK;t.packet({type:o,id:e,data:r})}}},r.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(d("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):d("bad ack %s",e.id)},r.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},r.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)l.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},r.prototype.ondisconnect=function(){d("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},r.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},r.prototype.close=r.prototype.disconnect=function(){return this.connected&&(d("performing disconnect (%s)",this.nsp),this.packet({type:i.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},r.prototype.compress=function(e){return this.flags=this.flags||{},this.flags.compress=e,this}},{"./on":33,"component-bind":37,"component-emitter":38,debug:39,"has-binary":41,"socket.io-parser":47,"to-array":51}],35:[function(e,t,n){(function(n){var r=e("parseuri"),i=e("debug")("socket.io-client:url");t.exports=function(e,t){var o=e,t=t||n.location;null==e&&(e=t.protocol+"//"+t.host),"string"==typeof e&&("/"==e.charAt(0)&&(e="/"==e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(i("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),i("parse %s",e),o=r(e)),o.port||(/^(http|ws)$/.test(o.protocol)?o.port="80":/^(http|ws)s$/.test(o.protocol)&&(o.port="443")),o.path=o.path||"/";var a=-1!==o.host.indexOf(":")?"["+o.host+"]":o.host;return o.id=o.protocol+"://"+a+":"+o.port,o.href=o.protocol+"://"+a+(t&&t.port==o.port?"":":"+o.port),o}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{debug:39,parseuri:45}],36:[function(e,t,n){function r(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}t.exports=r,r.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},r.prototype.reset=function(){this.attempts=0},r.prototype.setMin=function(e){this.ms=e},r.prototype.setMax=function(e){this.max=e},r.prototype.setJitter=function(e){this.jitter=e}},{}],37:[function(e,t,n){var r=[].slice;t.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=r.call(arguments,2);return function(){return t.apply(e,n.concat(r.call(arguments)))}}},{}],38:[function(e,t,n){function r(e){if(e)return i(e)}function i(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}t.exports=r,r.prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},r.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r,i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var r=0,i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,t);return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],39:[function(e,t,n){arguments[4][17][0].apply(n,arguments)},{"./debug":40,dup:17}],40:[function(e,t,n){arguments[4][18][0].apply(n,arguments)},{dup:18,ms:44}],41:[function(e,t,n){(function(n){var r=e("isarray");t.exports=function(e){function t(e){if(!e)return!1;if(n.Buffer&&n.Buffer.isBuffer&&n.Buffer.isBuffer(e)||n.ArrayBuffer&&e instanceof ArrayBuffer||n.Blob&&e instanceof Blob||n.File&&e instanceof File)return!0;if(r(e)){for(var i=0;i<e.length;i++)if(t(e[i]))return!0}else if(e&&"object"==typeof e){e.toJSON&&"function"==typeof e.toJSON&&(e=e.toJSON());for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)&&t(e[o]))return!0}return!1}return t(e)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{isarray:43}],42:[function(e,t,n){arguments[4][23][0].apply(n,arguments)},{dup:23}],43:[function(e,t,n){arguments[4][24][0].apply(n,arguments)},{dup:24}],44:[function(e,t,n){arguments[4][25][0].apply(n,arguments)},{dup:25}],45:[function(e,t,n){arguments[4][28][0].apply(n,arguments)},{dup:28}],46:[function(e,t,n){(function(t){var r=e("isarray"),i=e("./is-buffer");n.deconstructPacket=function(e){function t(e){if(!e)return e;if(i(e)){var o={_placeholder:!0,num:n.length};return n.push(e),o}if(r(e)){for(var a=new Array(e.length),s=0;s<e.length;s++)a[s]=t(e[s]);return a}if("object"==typeof e&&!(e instanceof Date)){a={};for(var c in e)a[c]=t(e[c]);return a}return e}var n=[],o=e.data,a=e;return a.data=t(o),a.attachments=n.length,{packet:a,buffers:n}},n.reconstructPacket=function(e,t){function n(e){if(e&&e._placeholder)return t[e.num];if(r(e)){for(var i=0;i<e.length;i++)e[i]=n(e[i]);return e}if(e&&"object"==typeof e){for(var o in e)e[o]=n(e[o]);return e}return e}return e.data=n(e.data),e.attachments=void 0,e},n.removeBlobs=function(e,n){function o(e,c,d){if(!e)return e;if(t.Blob&&e instanceof Blob||t.File&&e instanceof File){a++;var u=new FileReader;u.onload=function(){d?d[c]=this.result:s=this.result,--a||n(s)},u.readAsArrayBuffer(e)}else if(r(e))for(var p=0;p<e.length;p++)o(e[p],p,e);else if(e&&"object"==typeof e&&!i(e))for(var l in e)o(e[l],l,e)}var a=0,s=e;o(s),a||n(s)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./is-buffer":48,isarray:43}],47:[function(e,t,n){function r(){}function i(e){var t="",r=!1;return t+=e.type,n.BINARY_EVENT!=e.type&&n.BINARY_ACK!=e.type||(t+=e.attachments,t+="-"),e.nsp&&"/"!=e.nsp&&(r=!0,t+=e.nsp),null!=e.id&&(r&&(t+=",",r=!1),t+=e.id),null!=e.data&&(r&&(t+=","),t+=p.stringify(e.data)),u("encoded %j as %s",e,t),t}function o(e,t){f.removeBlobs(e,function(e){var n=f.deconstructPacket(e),r=i(n.packet),o=n.buffers;o.unshift(r),t(o)})}function a(){this.reconstructor=null}function s(e){var t={},r=0;if(t.type=Number(e.charAt(0)),null==n.types[t.type])return d();if(n.BINARY_EVENT==t.type||n.BINARY_ACK==t.type){for(var i="";"-"!=e.charAt(++r)&&(i+=e.charAt(r),r!=e.length););if(i!=Number(i)||"-"!=e.charAt(r))throw new Error("Illegal attachments");t.attachments=Number(i)}if("/"==e.charAt(r+1))for(t.nsp="";++r&&","!=(a=e.charAt(r))&&(t.nsp+=a,r!=e.length););else t.nsp="/";var o=e.charAt(r+1);if(""!==o&&Number(o)==o){for(t.id="";++r;){var a=e.charAt(r);if(null==a||Number(a)!=a){--r;break}if(t.id+=e.charAt(r),r==e.length)break}t.id=Number(t.id)}if(e.charAt(++r))try{t.data=p.parse(e.substr(r))}catch(e){return d()}return u("decoded %s as %j",e,t),t}function c(e){this.reconPack=e,this.buffers=[]}function d(e){return{type:n.ERROR,data:"parser error"}}var u=e("debug")("socket.io-parser"),p=e("json3"),l=(e("isarray"),e("component-emitter")),f=e("./binary"),h=e("./is-buffer");n.protocol=4,n.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"],n.CONNECT=0,n.DISCONNECT=1,n.EVENT=2,n.ACK=3,n.ERROR=4,n.BINARY_EVENT=5,n.BINARY_ACK=6,n.Encoder=r,n.Decoder=a,r.prototype.encode=function(e,t){u("encoding packet %j",e),n.BINARY_EVENT==e.type||n.BINARY_ACK==e.type?o(e,t):t([i(e)])},l(a.prototype),a.prototype.add=function(e){var t;if("string"==typeof e)t=s(e),n.BINARY_EVENT==t.type||n.BINARY_ACK==t.type?(this.reconstructor=new c(t),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",t)):this.emit("decoded",t);else{if(!h(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",t))}},a.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},c.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length==this.reconPack.attachments){var t=f.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},c.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},{"./binary":46,"./is-buffer":48,"component-emitter":49,debug:39,isarray:43,json3:50}],48:[function(e,t,n){(function(e){t.exports=function(t){return e.Buffer&&e.Buffer.isBuffer(t)||e.ArrayBuffer&&t instanceof ArrayBuffer}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],49:[function(e,t,n){arguments[4][15][0].apply(n,arguments)},{dup:15}],50:[function(e,t,n){(function(e){(function(){function r(e,t){function n(e){if(n[e]!==g)return n[e];var r;if("bug-string-char-index"==e)r="a"!="a"[0];else if("json"==e)r=n("json-stringify")&&n("json-parse");else{var i,a='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var c=t.stringify,u="function"==typeof c&&b;if(u){(i=function(){return 1}).toJSON=i;try{u="0"===c(0)&&"0"===c(new o)&&'""'==c(new s)&&c(y)===g&&c(g)===g&&c()===g&&"1"===c(i)&&"[1]"==c([i])&&"[null]"==c([g])&&"null"==c(null)&&"[null,null,null]"==c([g,y,null])&&c({a:[i,!0,!1,null,"\0\b\n\f\r\t"]})==a&&"1"===c(null,i)&&"[\n 1,\n 2\n]"==c([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==c(new d(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==c(new d(864e13))&&'"-000001-01-01T00:00:00.000Z"'==c(new d(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==c(new d(-1))}catch(e){u=!1}}r=u}if("json-parse"==e){var p=t.parse;if("function"==typeof p)try{if(0===p("0")&&!p(!1)){var l=5==(i=p(a)).a.length&&1===i.a[0];if(l){try{l=!p('"\t"')}catch(e){}if(l)try{l=1!==p("01")}catch(e){}if(l)try{l=1!==p("1.")}catch(e){}}}}catch(e){l=!1}r=l}}return n[e]=!!r}e||(e=a.Object()),t||(t=a.Object());var o=e.Number||a.Number,s=e.String||a.String,c=e.Object||a.Object,d=e.Date||a.Date,u=e.SyntaxError||a.SyntaxError,p=e.TypeError||a.TypeError,l=e.Math||a.Math,f=e.JSON||a.JSON;"object"==typeof f&&f&&(t.stringify=f.stringify,t.parse=f.parse);var h,m,g,v=c.prototype,y=v.toString,b=new d(-0xc782b5b800cec);try{b=-109252==b.getUTCFullYear()&&0===b.getUTCMonth()&&1===b.getUTCDate()&&10==b.getUTCHours()&&37==b.getUTCMinutes()&&6==b.getUTCSeconds()&&708==b.getUTCMilliseconds()}catch(e){}if(!n("json")){var S=n("bug-string-char-index");if(!b)var C=l.floor,w=[0,31,59,90,120,151,181,212,243,273,304,334],E=function(e,t){return w[t]+365*(e-1970)+C((e-1969+(t=+(t>1)))/4)-C((e-1901+t)/100)+C((e-1601+t)/400)};if((h=v.hasOwnProperty)||(h=function(e){var t,n={};return(n.__proto__=null,n.__proto__={toString:1},n).toString!=y?h=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(t=n.constructor,h=function(e){var n=(this.constructor||t).prototype;return e in this&&!(e in n&&this[e]===n[e])}),n=null,h.call(this,e)}),m=function(e,t){var n,r,o,a=0;(n=function(){this.valueOf=0}).prototype.valueOf=0,r=new n;for(o in r)h.call(r,o)&&a++;return n=r=null,a?m=2==a?function(e,t){var n,r={},i="[object Function]"==y.call(e);for(n in e)i&&"prototype"==n||h.call(r,n)||!(r[n]=1)||!h.call(e,n)||t(n)}:function(e,t){var n,r,i="[object Function]"==y.call(e);for(n in e)i&&"prototype"==n||!h.call(e,n)||(r="constructor"===n)||t(n);(r||h.call(e,n="constructor"))&&t(n)}:(r=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],m=function(e,t){var n,o,a="[object Function]"==y.call(e),s=!a&&"function"!=typeof e.constructor&&i[typeof e.hasOwnProperty]&&e.hasOwnProperty||h;for(n in e)a&&"prototype"==n||!s.call(e,n)||t(n);for(o=r.length;n=r[--o];s.call(e,n)&&t(n));}),m(e,t)},!n("json-stringify")){var k={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},A=function(e,t){return("000000"+(t||0)).slice(-e)},T=function(e){for(var t='"',n=0,r=e.length,i=!S||r>10,o=i&&(S?e.split(""):e);n<r;n++){var a=e.charCodeAt(n);switch(a){case 8:case 9:case 10:case 12:case 13:case 34:case 92:t+=k[a];break;default:if(a<32){t+="\\u00"+A(2,a.toString(16));break}t+=i?o[n]:e.charAt(n)}}return t+'"'},R=function(e,t,n,r,i,o,a){var s,c,d,u,l,f,v,b,S,w,k,x,P,L,O,I;try{s=t[e]}catch(e){}if("object"==typeof s&&s)if("[object Date]"!=(c=y.call(s))||h.call(s,"toJSON"))"function"==typeof s.toJSON&&("[object Number]"!=c&&"[object String]"!=c&&"[object Array]"!=c||h.call(s,"toJSON"))&&(s=s.toJSON(e));else if(s>-1/0&&s<1/0){if(E){for(l=C(s/864e5),d=C(l/365.2425)+1970-1;E(d+1,0)<=l;d++);for(u=C((l-E(d,0))/30.42);E(d,u+1)<=l;u++);l=1+l-E(d,u),v=C((f=(s%864e5+864e5)%864e5)/36e5)%24,b=C(f/6e4)%60,S=C(f/1e3)%60,w=f%1e3}else d=s.getUTCFullYear(),u=s.getUTCMonth(),l=s.getUTCDate(),v=s.getUTCHours(),b=s.getUTCMinutes(),S=s.getUTCSeconds(),w=s.getUTCMilliseconds();s=(d<=0||d>=1e4?(d<0?"-":"+")+A(6,d<0?-d:d):A(4,d))+"-"+A(2,u+1)+"-"+A(2,l)+"T"+A(2,v)+":"+A(2,b)+":"+A(2,S)+"."+A(3,w)+"Z"}else s=null;if(n&&(s=n.call(t,e,s)),null===s)return"null";if("[object Boolean]"==(c=y.call(s)))return""+s;if("[object Number]"==c)return s>-1/0&&s<1/0?""+s:"null";if("[object String]"==c)return T(""+s);if("object"==typeof s){for(L=a.length;L--;)if(a[L]===s)throw p();if(a.push(s),k=[],O=o,o+=i,"[object Array]"==c){for(P=0,L=s.length;P<L;P++)x=R(P,s,n,r,i,o,a),k.push(x===g?"null":x);I=k.length?i?"[\n"+o+k.join(",\n"+o)+"\n"+O+"]":"["+k.join(",")+"]":"[]"}else m(r||s,function(e){var t=R(e,s,n,r,i,o,a);t!==g&&k.push(T(e)+":"+(i?" ":"")+t)}),I=k.length?i?"{\n"+o+k.join(",\n"+o)+"\n"+O+"}":"{"+k.join(",")+"}":"{}";return a.pop(),I}};t.stringify=function(e,t,n){var r,o,a,s;if(i[typeof t]&&t)if("[object Function]"==(s=y.call(t)))o=t;else if("[object Array]"==s){a={};for(var c,d=0,u=t.length;d<u;c=t[d++],("[object String]"==(s=y.call(c))||"[object Number]"==s)&&(a[c]=1));}if(n)if("[object Number]"==(s=y.call(n))){if((n-=n%1)>0)for(r="",n>10&&(n=10);r.length<n;r+=" ");}else"[object String]"==s&&(r=n.length<=10?n:n.slice(0,10));return R("",(c={},c[""]=e,c),o,a,r,"",[])}}if(!n("json-parse")){var x,P,L=s.fromCharCode,O={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},I=function(){throw x=P=null,u()},N=function(){for(var e,t,n,r,i,o=P,a=o.length;x<a;)switch(i=o.charCodeAt(x)){case 9:case 10:case 13:case 32:x++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=S?o.charAt(x):o[x],x++,e;case 34:for(e="@",x++;x<a;)if((i=o.charCodeAt(x))<32)I();else if(92==i)switch(i=o.charCodeAt(++x)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=O[i],x++;break;case 117:for(t=++x,n=x+4;x<n;x++)(i=o.charCodeAt(x))>=48&&i<=57||i>=97&&i<=102||i>=65&&i<=70||I();e+=L("0x"+o.slice(t,x));break;default:I()}else{if(34==i)break;for(i=o.charCodeAt(x),t=x;i>=32&&92!=i&&34!=i;)i=o.charCodeAt(++x);e+=o.slice(t,x)}if(34==o.charCodeAt(x))return x++,e;I();default:if(t=x,45==i&&(r=!0,i=o.charCodeAt(++x)),i>=48&&i<=57){for(48==i&&(i=o.charCodeAt(x+1))>=48&&i<=57&&I(),r=!1;x<a&&(i=o.charCodeAt(x))>=48&&i<=57;x++);if(46==o.charCodeAt(x)){for(n=++x;n<a&&(i=o.charCodeAt(n))>=48&&i<=57;n++);n==x&&I(),x=n}if(101==(i=o.charCodeAt(x))||69==i){for(43!=(i=o.charCodeAt(++x))&&45!=i||x++,n=x;n<a&&(i=o.charCodeAt(n))>=48&&i<=57;n++);n==x&&I(),x=n}return+o.slice(t,x)}if(r&&I(),"true"==o.slice(x,x+4))return x+=4,!0;if("false"==o.slice(x,x+5))return x+=5,!1;if("null"==o.slice(x,x+4))return x+=4,null;I()}return"$"},D=function(e){var t,n;if("$"==e&&I(),"string"==typeof e){if("@"==(S?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];"]"!=(e=N());n||(n=!0))n&&(","==e?"]"==(e=N())&&I():I()),","==e&&I(),t.push(D(e));return t}if("{"==e){for(t={};"}"!=(e=N());n||(n=!0))n&&(","==e?"}"==(e=N())&&I():I()),","!=e&&"string"==typeof e&&"@"==(S?e.charAt(0):e[0])&&":"==N()||I(),t[e.slice(1)]=D(N());return t}I()}return e},_=function(e,t,n){var r=M(e,t,n);r===g?delete e[t]:e[t]=r},M=function(e,t,n){var r,i=e[t];if("object"==typeof i&&i)if("[object Array]"==y.call(i))for(r=i.length;r--;)_(i,r,n);else m(i,function(e){_(i,e,n)});return n.call(e,t,i)};t.parse=function(e,t){var n,r;return x=0,P=""+e,n=D(N()),"$"!=N()&&I(),x=P=null,t&&"[object Function]"==y.call(t)?M((r={},r[""]=n,r),"",t):n}}}return t.runInContext=r,t}var i={function:!0,object:!0},o=i[typeof n]&&n&&!n.nodeType&&n,a=i[typeof window]&&window||this,s=o&&i[typeof t]&&t&&!t.nodeType&&"object"==typeof e&&e;if(!s||s.global!==s&&s.window!==s&&s.self!==s||(a=s),o)r(a,o);else{var c=a.JSON,d=a.JSON3,u=!1,p=r(a,a.JSON3={noConflict:function(){return u||(u=!0,a.JSON=c,a.JSON3=d,c=d=null),p}});a.JSON={parse:p.parse,stringify:p.stringify}}}).call(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],51:[function(e,t,n){t.exports=function(e,t){for(var n=[],r=(t=t||0)||0;r<e.length;r++)n[r-t]=e[r];return n}},{}]},{},[31])(31)}),function(e){function t(e){"use strict";this.type=e.type,this.attributes=e.attributes}function n(e){"use strict";var t=this,n=new SignalingChannel;this.onConnected=null,this.onDisconnected=null,this.onConnectFailed=null,this.onChatInvitation=null,this.onChatDenied=null,this.onChatStopped=null,this.onChatAccepted=null,this.onChatSignal=null,this.onStreamType=null,this.onAuthenticated=null,n.onMessage=function(e,n){var r=JSON.parse(e);switch(r.type){case"chat-invitation":t.onChatInvitation&&t.onChatInvitation(n,r.ua);break;case"chat-accepted":t.onChatAccepted&&t.onChatAccepted(n,r.ua);break;case"chat-denied":t.onChatDenied&&t.onChatDenied(n);break;case"chat-closed":t.onChatStopped&&t.onChatStopped(n);break;case"stream-type":t.onStreamType&&t.onStreamType(r.data,n);break;case"chat-signal":t.onChatSignal&&t.onChatSignal(r.data,n);break;case"chat-negotiation-needed":t.onNegotiationNeeded&&t.onNegotiationNeeded(n);break;case"chat-negotiation-accepted":t.onNegotiationAccepted&&t.onNegotiationAccepted(n);break;default:i.Logger.error("Received unkown message")}},n.onServerDisconnected=function(){t.onDisconnected&&t.onDisconnected()},this.sendChatInvitation=function(e,t,r,i){var o={type:"chat-closed"};n.sendMessage(JSON.stringify(o),e),o={type:"chat-invitation",ua:t},n.sendMessage(JSON.stringify(o),e,r,i)},this.sendChatAccepted=function(e,t,r,i){var o={type:"chat-accepted",ua:t};n.sendMessage(JSON.stringify(o),e,r,i)},this.sendChatDenied=function(e,t,r){var i={type:"chat-denied"};n.sendMessage(JSON.stringify(i),e,t,r)},this.sendChatStopped=function(e,t,r){var i={type:"chat-closed"};n.sendMessage(JSON.stringify(i),e,t,r)},this.sendStreamType=function(e,t,r,i){var o={type:"stream-type",data:t};n.sendMessage(JSON.stringify(o),e,r,i)},this.sendSignalMessage=function(e,t,r,i){var o={type:"chat-signal",data:t};n.sendMessage(JSON.stringify(o),e,r,i)},this.sendNegotiationNeeded=function(e,t,r){var i={type:"chat-negotiation-needed"};n.sendMessage(JSON.stringify(i),e,t,r)},this.sendNegotiationAccepted=function(e,t,r){var i={type:"chat-negotiation-accepted"};n.sendMessage(JSON.stringify(i),e,t,r)},this.finalize=function(){n.disconnect()},this.connect=function(e,r,i){n.connect(e,function(e){t.onConnected&&t.onConnected(),t.onAuthenticated&&t.onAuthenticated(e),r&&r(e)},i)}}var r=function(){"use strict";var e={};return Object.defineProperties(e,{version:{get:function(){return"3.4.0"}},name:{get:function(){return"Intel WebRTC SDK"}}}),e}(),i={},o={};r.EventDispatcher=function(e){"use strict";var t={};return e.dispatcher={},e.dispatcher.eventListeners={},t.addEventListener=function(t,n){void 0===e.dispatcher.eventListeners[t]&&(e.dispatcher.eventListeners[t]=[]),e.dispatcher.eventListeners[t].push(n)},t.on=t.addEventListener,t.removeEventListener=function(t,n){if(e.dispatcher.eventListeners[t]){var r=e.dispatcher.eventListeners[t].indexOf(n);-1!==r&&e.dispatcher.eventListeners[t].splice(r,1)}},t.clearEventListener=function(t){e.dispatcher.eventListeners[t]=[]},t.dispatchEvent=function(t){e.dispatcher.eventListeners[t.type]&&e.dispatcher.eventListeners[t.type].map(function(e){e(t)})},t},r.StreamEvent=function(e){"use strict";t.call(this,e),this.stream=e.stream,this.msg=e.msg},r.ClientEvent=function(e){"use strict";t.call(this,e),this.user=e.user},r.MessageEvent=function(e){"use strict";t.call(this,e),this.msg=e.msg},r.ChatEvent=function(e){"use strict";t.call(this,e),this.type=e.type,this.senderId=e.senderId,this.peerId=e.peerId},r.DataEvent=function(e){"use strict";t.call(this,e),this.type=e.type,this.senderId=e.senderId,this.data=e.data},r.RecorderEvent=function(e){"use strict";t.call(this,e),this.recorderId=e.id},r.StreamEvent.prototype=Object.create(t.prototype),r.StreamEvent.prototype.constructor=r.StreamEvent,r.ClientEvent.prototype=Object.create(t.prototype),r.ClientEvent.prototype.constructor=r.ClientEvent,r.MessageEvent.prototype=Object.create(t.prototype),r.MessageEvent.prototype.constructor=r.MessageEvent,r.ChatEvent.prototype=Object.create(t.prototype),r.ChatEvent.prototype.constructor=r.ChatEvent,r.DataEvent.prototype=Object.create(t.prototype),r.DataEvent.prototype.constructor=r.DataEvent,r.RecorderEvent.prototype=Object.create(t.prototype),r.RecorderEvent.prototype.constructor=r.RecorderEvent,r.Common=function(){function e(e,n,r){return t(e,0,-1,n,r)}function t(e,t,n,r,i){for(var o=-1!==n?n:e.length,a=t;a<o;++a)if(0===e[a].indexOf(r)&&(!i||-1!==e[a].toLowerCase().indexOf(i.toLowerCase())))return a;return null}function n(t,n){var i=e(t,"a=rtpmap",n);return i?r(t[i]):null}function r(e){var t=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+","i"),n=e.match(t);return n&&2===n.length?n[1]:null}function o(e,t){var n=e.split(" "),r=n.slice(0,3);r.push(t);for(var i=3;i<n.length;i++)n[i]!==t&&r.push(n[i]);return r.join(" ")}return{parseStats:function(e){"use strict";var t=0,n=[];return navigator.mozGetUserMedia?e.forEach(function(r,i){var o,a=!1;i.indexOf("outbound_rtp_audio_")>=0?(a=!0,o={type:"ssrc_audio_send",id:r.id,stats:{bytes_sent:r.bytesSent,codec_name:"",packets_sent:r.packetsSent,packets_lost:e.get("outbound_rtcp_audio_"+i.slice(19)).packetsLost,rtt_ms:e.get("outbound_rtcp_audio_"+i.slice(19)).mozRtt}}):i.indexOf("outbound_rtp_video_")>=0?(a=!0,o={type:"ssrc_video_send",id:r.id,stats:{bytes_sent:r.bytesSent,codec_name:"",packets_sent:r.packetsSent,packets_lost:e.get("outbound_rtcp_video_"+i.slice(19)).packetsLost,firs_rcvd:-1,plis_rcvd:-1,nacks_rcvd:-1,send_frame_width:-1,send_frame_height:-1,adapt_reason:-1,adapt_changes:-1,framerate_sent:r.framerateMean,rtt_ms:e.get("outbound_rtcp_video_"+i.slice(19)).mozRtt}}):i.indexOf("inbound_rtp_audio_")>=0?(a=!0,o={type:"ssrc_audio_recv",id:r.id,stats:{bytes_rcvd:r.bytesReceived,delay_estimated_ms:-1,packets_rcvd:r.packetsReceived,packets_lost:r.packetsLost,codec_name:""}}):i.indexOf("inbound_rtp_video_")>=0&&(a=!0,o={type:"ssrc_video_recv",id:r.id,stats:{bytes_rcvd:r.bytesReceived,packets_rcvd:r.packetsReceived,packets_lost:r.packetsLost,firs_sent:-1,nacks_sent:-1,plis_sent:-1,frame_width:-1,frame_height:-1,framerate_rcvd:r.framerateMean,framerate_output:-1,current_delay_ms:-1,codec_name:""}}),a&&(n[t]=o,t++)}):e.forEach(function(e){var r,i=!1;if("ssrc"===e.type)if(i=!0,e.bytesSent)if(e.googFrameHeightSent){var o;o=!0===e.googCpuLimitedResolution?1:!0===e.googBandwidthLimitedResolution?2:!0===e.googViewLimitedResolution?3:99,r={type:"ssrc_video_send",id:e.id,stats:{bytes_sent:e.bytesSent,codec_name:e.googCodecName,packets_sent:e.packetsSent,packets_lost:e.packetsLost,firs_rcvd:e.googFirsReceived,plis_rcvd:e.googPlisReceived,nacks_rcvd:e.googNacksReceived,send_frame_width:e.googFrameWidthSent,send_frame_height:e.googFrameHeightSent,adapt_reason:o,adapt_changes:e.googAdaptationChanges,framerate_sent:e.googFrameRateSent,rtt_ms:e.googRtt}}}else r={type:"ssrc_audio_send",id:e.id,stats:{bytes_sent:e.bytesSent,codec_name:e.googCodecName,packets_sent:e.packetsSent,packets_lost:e.packetsLost,rtt_ms:e.googRtt}};else r=e.googFrameHeightReceived?{type:"ssrc_video_recv",id:e.id,stats:{bytes_rcvd:e.bytesReceived,packets_rcvd:e.packetsReceived,packets_lost:e.packetsLost,firs_sent:e.googFirsSent,nacks_sent:e.googNacksSent,plis_sent:e.googPlisSent,frame_width:e.googFrameWidthReceived,frame_height:e.googFrameHeightReceived,framerate_rcvd:e.googFrameRateReceived,framerate_output:e.googFrameRateDecoded,current_delay_ms:e.googCurrentDelayMs,codec_name:e.googCodecName}}:{type:"ssrc_audio_recv",id:e.id,stats:{bytes_rcvd:e.bytesReceived,delay_estimated_ms:e.googCurrentDelayMs,packets_rcvd:e.packetsReceived,packets_lost:e.packetsLost,codec_name:e.googCodecName}};else"VideoBwe"===e.type&&(i=!0,r={type:"VideoBWE",id:"",stats:{available_send_bandwidth:e.googAvailableSendBandwidth,available_receive_bandwidth:e.googAvailableReceiveBandwidth,transmit_bitrate:e.googTransmitBitrate,retransmit_bitrate:e.googRetransmitBitrate}});i&&(n[t]=r,t++)}),n},parseAudioLevel:function(e){for(var t=0,n=0,r={},i=[],o=[],a=!1,s=e.result(),c=0;c<s.length;c++){var d=s[c];if("ssrc"===d.type)if(d.stat("bytesSent"))d.stat("googFrameHeightSent")||(a=!0,(u={}).ssrc=d.id,u.level=d.stat("audioInputLevel"),i[t]=u,t++);else if(d.stat("googFrameHeightReceived"));else{a=!0;var u={};u.ssrc=d.id,u.level=d.stat("audioOutputLevel"),o[n]=u,n++}}return a&&(t>0&&(r.audioInputLevels=i),n>0&&(r.audioOutputLevels=o)),r},setPreferredCodec:function(t,r,a){if(!r||!a)return i.Logger.warning("Media type or codec name is not provided."),t;var s=t.split("\r\n"),c=e(s,"m=",r);if(null===c)return t;var d=n(s,a);return d&&(s[c]=o(s[c],d)),t=s.join("\r\n")},setPreferredBitrate:function(n,r,o){var a=n.split("\r\n"),s=e(a,"m=",r);if(null===s)return i.Logger.debug("Failed to add bandwidth line to sdp, as no m-line found"),n;var c=t(a,s+1,-1,"m=");null===c&&(c=a.length);var d=t(a,s+1,c,"c=");if(null===d)return i.Logger.debug("Failed to add bandwidth line to sdp, as no c-line found"),n;var u=t(a,d+1,c,"b=AS");u&&a.splice(u,1);var p="b=AS:"+o;return a.splice(d+1,0,p),n=a.join("\r\n")},sysInfo:function(){var e=Object.create({});e.sdk={version:"3.4",type:"JavaScript"};var t=navigator.userAgent,n=/Firefox\/([0-9\.]+)/,r=/Edge\/([0-9\.]+)/,i=/Chrome\/([0-9\.]+)/.exec(t);i?e.runtime={name:"Chrome",version:i[1]}:(i=n.exec(t))?e.runtime={name:"FireFox",version:i[1]}:(i=r.exec(t))?e.runtime={name:"Edge",version:i[1]}:e.runtime={name:"Unknown",version:"Unknown"};var o=/Intel Mac OS X ([0-9_\.]+)/,a=/iPhone OS ([0-9_\.]+)/,s=/X11; Linux/,c=/Android( ([0-9\.]+))?/,d=/CrOS/;return(i=/Windows NT ([0-9\.]+)/.exec(t))?e.os={name:"Windows NT",version:i[1]}:(i=o.exec(t))?e.os={name:"Mac OS X",version:i[1].replace(/_/g,".")}:(i=a.exec(t))?e.os={name:"iPhone OS",version:i[1].replace(/_/g,".")}:(i=s.exec(t))?e.os={name:"Linux",version:"Unknown"}:(i=c.exec(t))?e.os={name:"Android",version:i[1]||"Unknown"}:(i=d.exec(t))?e.os={name:"Chrome OS",version:"Unknown"}:e.os={name:"Unknown",version:"Unknown"},e}}}(),attachMediaStream=function(){i.Logger.warning("Global attachMediaStream is deprecated, pleause include woogeen.sdk.ui.js and use Woogeen.UI.attachMediaStream instead."),adapter.browserShim.attachMediaStream.apply(this,arguments)},i.Base64=function(){"use strict";var e,t,n,r,i,o,a,s,c,d,u,p;for(e=-1,t=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n=[],o=0;o<t.length;o+=1)n[t[o]]=o;return a=function(e){r=e,i=0},s=function(){var t;return r?i>=r.length?e:(t=255&r.charCodeAt(i),i+=1,t):e},c=function(n){var r,i,o;for(a(n),r="",i=new Array(3),o=!1;!o&&(i[0]=s())!==e;)i[1]=s(),i[2]=s(),r+=t[i[0]>>2],i[1]!==e?(r+=t[i[0]<<4&48|i[1]>>4],i[2]!==e?(r+=t[i[1]<<2&60|i[2]>>6],r+=t[63&i[2]]):(r+=t[i[1]<<2&60],r+="=",o=!0)):(r+=t[i[0]<<4&48],r+="=",r+="=",o=!0);return r},d=function(){if(!r)return e;for(;;){if(i>=r.length)return e;var t=r.charAt(i);if(i+=1,n[t])return n[t];if("A"===t)return 0}},u=function(e){return 1===(e=e.toString(16)).length&&(e="0"+e),e="%"+e,unescape(e)},p=function(t){var n,r,i;for(a(t),n="",r=new Array(4),i=!1;!i&&(r[0]=d())!==e&&(r[1]=d())!==e;)r[2]=d(),r[3]=d(),n+=u(r[0]<<2&255|r[1]>>4),r[2]!==e?(n+=u(r[1]<<4&255|r[2]>>2),r[3]!==e?n+=u(r[2]<<6&255|r[3]):i=!0):i=!0;return n},{encodeBase64:c,decodeBase64:p}}(),i.Logger=function(){"use strict";var t=function(){},n={DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5};n.log=e.console.log.bind(e.console);var r=function(t){return"function"==typeof e.console[t]?e.console[t].bind(e.console):e.console.log.bind(e.console)},i=function(e){n.debug=e<=0?r("debug"):t,n.trace=e<=1?r("trace"):t,n.info=e<=2?r("info"):t,n.warning=e<=3?r("warn"):t,n.error=e<=4?r("error"):t};return i(0),n.setLogLevel=i,n}(),function(){"use strict";function t(e){this.mediaStream=e.mediaStream,e.attributes=e.attributes||{},this.url=function(){if("string"==typeof e.url&&""!==e.url)return e.url},this.hasVideo=function(){return!!e.video},this.hasAudio=function(){return!!e.audio},this.attributes=function(){return e.attributes},this.attr=function(t,n){return arguments.length>1&&(e.attributes[t]=n),e.attributes[t]},this.id=function(){return e.id||null},this.isScreen=function(){return!!e.video&&"screen"===e.video.device},this.bitRate={maxVideoBW:void 0,maxAudioBW:void 0},this.toJson=function(){return{id:this.id(),audio:!!this.hasAudio()&&e.audio,video:!!this.hasVideo()&&e.video,attributes:e.attributes}}}function n(e){t.call(this,e),this.hasAudio=function(){return this.mediaStream?!!this.mediaStream.getAudioTracks().length:!!e.hasAudio},this.hasVideo=function(){return this.mediaStream?!!this.mediaStream.getVideoTracks().length:!!e.hasVideo}}function o(e){t.call(this,e),this.isMixed=function(){return!1},this.from=e.from;var n={},r=this;Object.defineProperties(this,{on:{get:function(){return function(e,t){return n[e]=n[e]||[],n[e].push(t),r}}},emit:{get:function(){return function(e){if(n[e]){var t=[].slice.call(arguments,1);n[e].map(function(e){e.apply(r,t)})}return r}}},removeListener:{get:function(){return function(e,t){return void 0===t?n[e]=[]:n[e]&&n[e].map(function(r,i){r===t&&n[e].splice(i,1)}),r}}},clearListeners:{get:function(){return function(){return n={},r}}}})}function a(e){o.call(this,e),this.resolutions=function(){return e.video.resolutions instanceof Array?e.video.resolutions.map(function(e){return e}):[]},this.isMixed=function(){return!0},this.viewport=function(){return e.viewport}}function s(e){this.url=function(){if("string"==typeof e.url&&""!==e.url)return e.url},this.id=function(){return e.id||null},this.hasVideo=function(){return!!e.video},this.hasAudio=function(){return!!e.audio},this.toJson=function(){var t;return!0===e.video?t={device:"camera"}:!1===e.video?t=e.video:"object"==typeof e.video&&(t=e.video,t.device=e.video.device||"camera"),{id:this.id(),audio:e.audio,video:t,url:this.url()}}}function c(){return null!==e.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&e.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function d(){return e.navigator.appVersion.indexOf("Trident")>-1}function u(){return null!==e.navigator.userAgent.match("Firefox")}function p(){return u()||null!==e.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&e.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]>=34}function l(e,t){return{width:e,height:t}}function f(e,t){if("object"!=typeof(e=JSON.parse(JSON.stringify(e)))||null===e||void 0===e.url)if("function"==typeof g||d()){var n=arguments[3];void 0===n&&(n=2);var o={};if(null!==e&&"object"==typeof e){if(!e.audio&&!e.video)return void("function"==typeof t&&t({code:1107,msg:"At least one of audio and video must be requested."}));if(e.video){if("object"!=typeof e.video&&e.video&&(e.video=Object.create({})),"string"!=typeof e.video.device&&(e.video.device="camera"),"screen"===e.video.device&&!p()&&"function"==typeof t)return void t({code:1103,msg:"browser screen sharing not supported"});"object"==typeof e.video.resolution&&void 0!==e.video.resolution.width&&void 0!==e.video.resolution.height?o.video=JSON.parse(JSON.stringify(l(e.video.resolution.width,e.video.resolution.height))):o.video=JSON.parse(JSON.stringify(m[e.video.resolution]||m.unspecified)),"string"==typeof e.video.deviceId&&(o.video.deviceId=e.video.deviceId),d()||c()||(e.video.frameRate instanceof Array&&e.video.frameRate.length>=2?o.video.frameRate={min:e.video.frameRate[0],max:e.video.frameRate[1]}:"number"==typeof e.video.frameRate?o.video.frameRate=e.video.frameRate:i.Logger.warning("Invalid frame rate value, ignored."))}"object"==typeof e.audio?o.audio=e.audio:!0===e.audio&&(o.audio=!0)}else if("function"==typeof t)return void t({code:1107,msg:"USER_INPUT_INVALID"});var a=function(n){if("object"==typeof e.video&&"screen"===e.video.device||!(e.audio&&0===n.getAudioTracks().length||e.video&&0===n.getVideoTracks().length)){e.mediaStream=n,e.id=n.id;var i=new r.LocalStream(e);if(e.video&&"screen"===e.video.device){var a=n.getVideoTracks();a.length>0&&(a[0].onended=function(){i.close()})}if(o.video)switch(o.video.width){case 320:i.bitRate.maxVideoBW=512;break;case 640:i.bitRate.maxVideoBW=1024;break;case 1280:i.bitRate.maxVideoBW=2048}"function"==typeof t&&t(null,i)}else{for(var s=0;s<n.getTracks().length;s++)n.getTracks()[s].stop();t({code:1104,msg:"Not all device requests are satisfied."})}},s=function(r){var i={code:1100,msg:r.name||r};switch(i.msg){case"Starting video failed":case"TrackStartError":if(e.video={device:e.video.device,extensionId:e.video.extensionId},n>0)return void setTimeout(function(){f(e,t,n-1)},1);i.msg="MEDIA_OPTION_INVALID",i.code=1104;break;case"DevicesNotFoundError":i.msg="DEVICES_NOT_FOUND",i.code=1102;break;case"NotSupportedError":i.msg="NOT_SUPPORTED",i.code=1105;break;case"PermissionDeniedError":i.msg="PERMISSION_DENIED",i.code=1101;break;case"PERMISSION_DENIED":i.code=1101;break;case"ConstraintNotSatisfiedError":i.msg="CONSTRAINT_NOT_SATISFIED",i.code=1106;break;default:i.msg||(i.msg="UNDEFINED")}"function"==typeof t&&t(i)};if(e.video&&"screen"===e.video.device){if(u())return void 0!==o.video?o.video.mediaSource="window":o.video={mediaSource:"window"},void g.apply(navigator,[o,a,s]);var h=e.video.extensionId||"pndohhifhheefbpeljcmnhnkphepimhe",v=["screen","window","tab"];e.audio&&v.push("audio");try{chrome.runtime.sendMessage(h,{getStream:v},function(e){return void 0===e?void("function"==typeof t&&t({code:1103,msg:"screen sharing plugin inaccessible"})):(o.audio={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e.streamId}},o.video.mandatory=o.video.mandatory||{},o.video.mandatory.chromeMediaSource="desktop",o.video.mandatory.chromeMediaSourceId=e.streamId,o.video.height&&(o.video.mandatory.maxHeight=o.video.mandatory.minHeight=o.video.height,delete o.video.height),o.video.width&&(o.video.mandatory.maxWidth=o.video.mandatory.minWidth=o.video.width,delete o.video.width),o.video.frameRate&&("object"==typeof o.video.frameRate?(o.video.mandatory.minFrameRate=o.video.frameRate.min,o.video.mandatory.maxFrameRate=o.video.frameRate.max):"number"==typeof o.video.frameRate?(o.video.mandatory.minFrameRate=o.video.frameRate,o.video.mandatory.maxFrameRate=o.video.frameRate):i.Logger.warning("Invalid frame rate value for screen sharing."),delete o.video.frameRate),void g.apply(navigator,[o,a,s]))})}catch(e){"function"==typeof t&&t({code:1103,msg:"screen sharing plugin inaccessible",err:e})}}else d()?navigator.getUserMedia(o,a,s):g.apply(navigator,[o,a,s])}else"function"==typeof t&&t({code:1100,msg:"webrtc support not available"});else{var y="URL for LocalStream is deprecated, please use ExternalStream instead.";"function"==typeof console.warn?console.warn(y):i.Logger.warning(y);var b=new r.LocalStream(e);"function"==typeof t&&t(null,b)}}function h(e,t){if("object"==typeof e&&e.url)if(e.audio||e.video){var n=new r.ExternalStream(e);"function"==typeof t&&t(null,n)}else"function"==typeof t&&t({code:1107,msg:"External stream must have video or audio"});else"function"==typeof t&&t({code:1107,msg:"External stream must have url property"})}t.prototype.close=function(){"function"==typeof this.hide&&this.hide(),this.mediaStream&&this.mediaStream.getTracks().map(function(e){"function"==typeof e.stop&&e.stop()}),this.mediaStream=null,"function"==typeof this.unpublish&&this.unpublish(),this.channel&&"function"==typeof this.channel.close&&this.channel.close()},t.prototype.createObjectURL=function(){return this.mediaStream?(e.URL||webkitURL).createObjectURL(this.mediaStream):""},t.prototype.disableAudio=function(e){var t=this;if(t.hasAudio()&&t.mediaStream){if(void 0===e&&(e=0),-1===e)return t.mediaStream.getAudioTracks().map(function(e){return!!e.enabled&&(e.enabled=!1,!0)});var n=t.mediaStream.getAudioTracks();if(n&&n[e]&&n[e].enabled)return n[e].enabled=!1,!0}return!1},t.prototype.enableAudio=function(e){var t=this;if(t.hasAudio()&&t.mediaStream){if(void 0===e&&(e=0),-1===e)return t.mediaStream.getAudioTracks().map(function(e){return!0!==e.enabled&&(e.enabled=!0,!0)});var n=t.mediaStream.getAudioTracks();if(n&&n[e]&&!0!==n[e].enabled)return n[e].enabled=!0,!0}return!1},t.prototype.disableVideo=function(e){var t=this;if(t.hasVideo()&&t.mediaStream){if(void 0===e&&(e=0),-1===e)return t.mediaStream.getVideoTracks().map(function(e){return!!e.enabled&&(e.enabled=!1,!0)});var n=t.mediaStream.getVideoTracks();if(n&&n[e]&&n[e].enabled)return n[e].enabled=!1,!0}return!1},t.prototype.enableVideo=function(e){var t=this;if(t.hasVideo()&&t.mediaStream){if(void 0===e&&(e=0),-1===e)return t.mediaStream.getVideoTracks().map(function(e){return!0!==e.enabled&&(e.enabled=!0,!0)});var n=t.mediaStream.getVideoTracks();if(n&&n[e]&&!0!==n[e].enabled)return n[e].enabled=!0,!0}return!1},t.prototype.updateConfiguration=function(e,t){if(void 0!==e)return this.channel?void this.channel.updateSpec(e,t):"This stream has not been published, ignoring"},n.prototype=Object.create(t.prototype),o.prototype=Object.create(t.prototype),a.prototype=Object.create(o.prototype),s.prototype=Object.create({}),n.prototype.constructor=n,o.prototype.constructor=o,a.prototype.constructor=a,s.prototype.constructor=s;var m={true:{},unspecified:{},sif:l(320,240),vga:l(640,480),hd720p:l(1280,720),hd1080p:l(1920,1080)},g=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;n.create=function(){f.apply(this,arguments)},s.create=function(){h.apply(this,arguments)},r.Stream=t,r.LocalStream=n,r.RemoteStream=o,r.RemoteMixedStream=a,r.ExternalStream=s}(),function(){function t(){var e=arguments[0];if("function"==typeof e){var t=Array.prototype.slice.call(arguments,1);e.apply(null,t)}}function n(e){e.session_id=r.sessionId+=1;var t={};if(t.browser=l(),"mozilla"===t.browser)i.Logger.debug("Firefox Stack"),t=o.FirefoxStack(e);else if("bowser"===t.browser)i.Logger.debug("Bowser Stack"),t=o.BowserStack(e);else if("chrome-stable"===t.browser)i.Logger.debug("Stable!"),t=o.ChromeStableStack(e);else{if("edge"!==t.browser)throw i.Logger.debug("None!"),"WebRTC stack not available";i.Logger.debug("Edge Stack"),t=o.EdgeORTCStack(e)}return t.updateSpec||(t.updateSpec=function(e,t){i.Logger.error("Update Configuration not implemented in this browser"),t&&t("unimplemented")}),t}function a(e){if(!e.video)return new r.RemoteStream(e);switch(e.video.device){case"mcu":return new r.RemoteMixedStream(e);default:return new r.RemoteStream(e)}}function s(e,t,n){if(!e||!e.connected)return n("socket not ready");try{e.emit(t,function(e,t){return"success"===e?n(null,t):n(t||"response error")})}catch(e){n("socket emit error")}}function c(e,t,n,r){if(!e||!e.connected)return r("socket not ready");try{e.emit(t,n,function(e,t){return"success"===e?r(null,t):r(t||"response error")})}catch(e){r("socket emit error")}}function d(e,t,n,r,i){if(!e||!e.connected)return i("error","socket not ready");try{e.emit(t,n,r,function(e,t){i(e,t)})}catch(e){i("error","socket emit error")}}function u(e,n,r,i,o){c(e,"customMessage",{type:"control",payload:{action:n,streamId:r}},function(e,n){return e?t(o,e):void t(i,n)})}function p(e,n,i,o,a,s){if(!(i instanceof r.Stream||i instanceof r.ExternalStream))return t(s,"Invalid stream");if(!Array.isArray(o))return t(s,"Target streams is not a list");var d,u,p=[];for(d=0;d<o.length;d++){if(!((u=o[d])instanceof r.RemoteMixedStream))return t(s,"Invalid stream found in targetStreams.");p.push(u.id())}c(n,e,{streamId:i.id(),mixStreams:p},function(e){return e?t(s,e):void t(a,null)})}r.sessionId=103;var l=function(){var t="none";return null!==e.navigator.userAgent.match("Firefox")?t="mozilla":null!==e.navigator.userAgent.match("Bowser")?t="bowser":null!==e.navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?t="edge":null!==e.navigator.userAgent.match("Chrome")?e.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]>=26&&(t="chrome-stable"):null!==e.navigator.userAgent.match("Safari")?t="bowser":null!==e.navigator.userAgent.match("WebKit")&&(t="bowser"),t},f=function(e){this.internalDispatcher=r.EventDispatcher({}),this.spec=e||{},this.remoteStreams={},this.localStreams={},this.state=0};(f.prototype=r.EventDispatcher({})).setIceServers=function(){var e=this.spec;return e.userSetIceServers=[],Array.prototype.slice.call(arguments,0).map(function(t){t instanceof Array?t.map(function(t){"object"==typeof t&&null!==t?"string"==typeof t.urls&&""!==t.urls||t.urls instanceof Array?e.userSetIceServers.push(t):"string"==typeof t.url&&""!==t.url&&(t.urls=t.url,delete t.url,e.userSetIceServers.push(t)):"string"==typeof t&&""!==t&&e.userSetIceServers.push({urls:t})}):"object"==typeof t&&null!==t?"string"==typeof t.urls&&""!==t.urls||t.urls instanceof Array?e.userSetIceServers.push(t):"string"==typeof t.url&&""!==t.url&&(t.urls=t.url,delete t.url,e.userSetIceServers.push(t)):"string"==typeof t&&""!==t&&e.userSetIceServers.push({urls:t})}),e.userSetIceServers},f.prototype.getIceServers=function(){return this.spec.userSetIceServers},f.prototype.join=function(e,n,o){var s;try{s=JSON.parse(i.Base64.decodeBase64(e))}catch(e){return t(o,"invalid token")}var c=this,d=!0===s.secure,u=s.host;if("string"!=typeof u)return t(o,"invalid host");if(-1===u.indexOf("http")&&(u=d?"https://"+u:"http://"+u),0!==c.state)return t(o,"connection state invalid");c.state=1,void 0!==c.socket?c.socket.connect():(c.socket=io.connect(u,{reconnect:!1,secure:d,"force new connection":!0}),c.socket.on("add_stream",function(e){if(void 0===c.remoteStreams[e.id]){var t=a({video:e.video,audio:e.audio,id:e.id,from:e.from,attributes:e.attributes,viewport:e.view}),n=new r.StreamEvent({type:"stream-added",stream:t});c.remoteStreams[e.id]=t,c.dispatchEvent(n)}else i.Logger.warning("stream already added:",e.id)}),c.socket.on("update_stream",function(e){var t=c.remoteStreams[e.id];t&&t.emit(e.event,e.data)}),c.socket.on("remove_stream",function(e){var t=c.remoteStreams[e.id];if(t){t.close(),delete c.remoteStreams[e.id];var n=new r.StreamEvent({type:"stream-removed",stream:t});c.dispatchEvent(n)}}),c.socket.on("signaling_message_erizo",function(e){var t;(t=e.peerId?c.remoteStreams[e.peerId]:c.localStreams[e.streamId])&&t.channel&&t.channel.processSignalingMessage(e.mess)}),c.socket.on("add_recorder",function(e){var t=new r.RecorderEvent({type:"recorder-added",id:e.id});c.dispatchEvent(t)}),c.socket.on("reuse_recorder",function(e){var t=new r.RecorderEvent({type:"recorder-continued",id:e.id});c.dispatchEvent(t)}),c.socket.on("remove_recorder",function(e){var t=new r.RecorderEvent({type:"recorder-removed",id:e.id});c.dispatchEvent(t)}),c.socket.on("disconnect",function(){var e=!1;0!==c.state?(e=!0,i.Logger.info("Will trigger server-disconnect")):i.Logger.info("Will not trigger server-disconnect"),c.state=0,c.myId=null;var t,n;for(t in c.remoteStreams)c.remoteStreams.hasOwnProperty(t)&&((n=c.remoteStreams[t]).close(),delete c.remoteStreams[t]);for(t in c.localStreams)c.localStreams.hasOwnProperty(t)&&((n=c.localStreams[t]).channel&&"function"==typeof n.channel.close&&n.channel.close(),delete c.localStreams[t]);try{c.socket.disconnect()}catch(e){}if(e){var o=new r.ClientEvent({type:"server-disconnected"});c.dispatchEvent(o)}}),c.socket.on("user_join",function(e){var t=new r.ClientEvent({type:"user-joined",user:e.user});c.dispatchEvent(t)}),c.socket.on("user_leave",function(e){var t=new r.ClientEvent({type:"user-left",user:e.user});c.dispatchEvent(t)}),c.socket.on("custom_message",function(e){var t=new r.MessageEvent({type:"message-received",msg:e});c.dispatchEvent(t)}),c.socket.on("connect_failed",function(e){t(o,e||"connection_failed")}),c.socket.on("error",function(e){t(o,e||"connection_error")}),c.socket.on("connection_failed",function(e){if(i.Logger.error("MCU reports connection failed for stream: "+e.streamId),void 0!==c.localStreams[e.streamId]){var t=c.localStreams[e.streamId];c.unpublish(t),delete c.localStreams[e.streamId]}else c.unsubscribe(c.remoteStreams[e.streamId]);if(0!==c.state){var n=new r.StreamEvent({type:"stream-failed"});c.dispatchEvent(n)}}),c.socket.on("stream-publish",function(e){var t=c.localStreams[e.id];t&&(console.log("Stream published"),c.dispatchEvent(new r.StreamEvent({type:"stream-published",stream:t})))}));try{var p={token:e,userAgent:r.Common.sysInfo()};c.socket.emit("login",p,function(e,r){if("success"===e){c.myId=r.clientId,c.conferenceId=r.id,c.state=2;var i=[];c.conferenceId=r.id,void 0!==r.streams&&(i=r.streams.map(function(e){return e.viewport=e.view,c.remoteStreams[e.id]=a(e),c.remoteStreams[e.id]}));var s;if(void 0!==r.users)for(var d=0;d<r.users.length;d++)if(r.users[d].id===r.clientId){s=r.users[d];break}return t(n,{streams:i,users:r.users,self:s})}return t(o,r||"response error")})}catch(e){t(o,"socket emit error")}},f.prototype.publish=function(e,o,a,s){var p=this;if(e=e||{},"function"==typeof o?(s=a,a=o):"object"==typeof o&&null!==o||(o={}),!(e instanceof r.LocalStream||e instanceof r.ExternalStream)||("object"!=typeof e.mediaStream||null===e.mediaStream)&&void 0===e.url())return t(s,"invalid stream");if(o.videoCodec=o.videoCodec||"h264",void 0!==p.localStreams[e.id()])return t(s,"already published");var l=e.toJson();return!0===o.unmix&&(l.unmix=!0),void 0!==e.url()?(l.state="url",l.transport=o.transport,l.bufferSize=o.bufferSize,void d(p.socket,"publish",l,e.url(),function(n,r){return"success"!==n?t(s,"error"===n?r:n):(e.id=function(){return r},e.unpublish=function(t,n){p.unpublish(e,t,n)},p.localStreams[r]=e,void t(a,e))})):(l.state="erizo",void d(p.socket,"publish",l,void 0,function(r,l){if("error"===r)return t(s,l);if("timeout"===r)return t(s,r);e.id=function(){return l},p.localStreams[l]=e,e.channel=n({callback:function(e){console.log("Sending message",e),d(p.socket,"signaling_message",{streamId:l,msg:e},void 0,function(){})},video:e.hasVideo(),audio:e.hasAudio(),iceServers:p.getIceServers(),maxAudioBW:o.maxAudioBW,maxVideoBW:o.maxVideoBW,audioCodec:o.audioCodec,videoCodec:o.videoCodec});var f=function(){e.signalOnPlayAudio=function(e,t){u(p.socket,"audio-out-on",l,e,t)},e.signalOnPauseAudio=function(e,t){u(p.socket,"audio-out-off",l,e,t)},e.signalOnPlayVideo=function(e,t){u(p.socket,"video-out-on",l,e,t)},e.signalOnPauseVideo=function(e,t){u(p.socket,"video-out-off",l,e,t)},e.unpublish=function(t,n){p.unpublish(e,t,n)},t(a,e),s=function(){},f=function(){}},h=function(){c(p.socket,"unpublish",l,function(){},function(){}),e.channel.close(),e.channel=void 0,t(s,"peer connection failed"),f=function(){},h=function(){}};e.channel.oniceconnectionstatechange=function(e){switch(e){case"completed":case"connected":f();break;case"checking":case"closed":break;case"failed":h();break;default:i.Logger.warning("unknown ice connection state:",e)}},e.channel.addStream(e.mediaStream),e.channel.createOffer(!1)}))},f.prototype.unpublish=function(e,n,i){var o=this;return e instanceof r.LocalStream||e instanceof r.ExternalStream?void c(o.socket,"unpublish",e.id(),function(r){return e.channel&&"function"==typeof e.channel.close&&(e.channel.close(),e.channel=null),delete o.localStreams[e.id()],e.id=function(){return null},e.signalOnPlayAudio=void 0,e.signalOnPauseAudio=void 0,e.signalOnPlayVideo=void 0,e.signalOnPauseVideo=void 0,delete e.unpublish,r?t(i,r):void t(n,null)}):t(i,"invalid stream")},f.prototype.subscribe=function(e,o,a,s){var p=this,f=!1,h=!1;return"function"==typeof o?(s=a,a=o,o={}):"object"==typeof o&&null!==o||(o={}),e instanceof r.RemoteStream?!1===o.audio&&!1===o.video?t(s,"no audio or video to subscribe."):(o.videoCodec=o.videoCodec||"h264",e.isMixed()||"object"!=typeof o.video||!o.video.resolution&&!o.video.qualityLevel?("object"==typeof o.video&&o.video.qualityLevel&&(o.video.quality_level=o.video.qualityLevel,delete o.video.qualityLevel),void d(p.socket,"subscribe",{streamId:e.id(),audio:e.hasAudio()&&!1!==o.audio,video:e.hasVideo()&&o.video,browser:l()},void 0,function(r,l){if("error"===r||"timeout"===r)return t(s,l||r);e.channel=n({callback:function(t){d(p.socket,"signaling_message",{streamId:e.id(),msg:t,browser:e.channel.browser},void 0,function(){})},audio:e.hasAudio()&&!1!==o.audio,video:e.hasVideo()&&!1!==o.video,iceServers:p.getIceServers(),videoCodec:o.videoCodec}),e.channel.onaddstream=function(n){e.mediaStream=n.stream,h&&!1===f?(f=!0,t(a,e)):f=!0};var m=function(){e.signalOnPlayAudio=function(t,n){u(p.socket,"audio-in-on",e.id(),t,n)},e.signalOnPauseAudio=function(t,n){u(p.socket,"audio-in-off",e.id(),t,n)},e.signalOnPlayVideo=function(t,n){u(p.socket,"video-in-on",e.id(),t,n)},e.signalOnPauseVideo=function(t,n){u(p.socket,"video-in-off",e.id(),t,n)},f&&!1===h?(h=!0,t(a,e)):h=!0,s=function(){},m=function(){}},g=function(){c(p.socket,"unsubscribe",e.id(),function(){},function(){}),e.close(),e.signalOnPlayAudio=void 0,e.signalOnPauseAudio=void 0,e.signalOnPlayVideo=void 0,e.signalOnPauseVideo=void 0,t(s,"peer connection failed"),m=function(){},g=function(){}};e.channel.oniceconnectionstatechange=function(e){switch(e){case"completed":case"connected":m();break;case"checking":case"closed":break;case"failed":g();break;default:i.Logger.warning("unknown ice connection state:",e)}},e.channel.createOffer(!0)})):t(s,"Resolution and quality level settings are not available for non-mixed stream.")):t(s,"invalid stream")},f.prototype.unsubscribe=function(e,n,i){var o=this;return e instanceof r.RemoteStream?void c(o.socket,"unsubscribe",e.id(),function(r,o){return r?t(i,r):(e.close(),e.signalOnPlayAudio=void 0,e.signalOnPauseAudio=void 0,e.signalOnPlayVideo=void 0,e.signalOnPauseVideo=void 0,void t(n,o))}):t(i,"invalid stream")},f.prototype.onMessage=function(e){"function"==typeof e&&this.on("message-received",e)},r.ConferenceClient=function(){"use strict";var e=function(e){f.call(this,e),this.join=function(e,t,n){f.prototype.join.call(this,e,t,n)},this.leave=function(){s(this.socket,"logout",function(e){e&&i.Logger.warning("Server returns error for logout event")}),this.socket.disconnect()},this.send=function(e,n,r,i){if(void 0===e||null===e||"function"==typeof e)return t(i,"nothing to send");if(void 0===n)n="all";else if("string"==typeof n);else{if("function"!=typeof n)return t(i,"invalid receiver");i=r,r=n,n="all"}c(this.socket,"customMessage",{type:"data",data:e,receiver:n},function(e,n){return e?t(i,e):void t(r,n)})},this.mix=function(e,t,n,r){return p("mix",this.socket,e,t,n,r)},this.unmix=function(e,t,n,r){return p("unmix",this.socket,e,t,n,r)},this.shareScreen=function(e,n,o){i.Logger.warning("shareScreen is deprecated, please create a LocalStream and publish it to specific conference.");var a=this;"function"==typeof e&&(o=n,n=e,e={}),e=e||{},r.LocalStream.create({video:{device:"screen",extensionId:e.extensionId,resolution:e.resolution?e.resolution:{width:screen.width,height:screen.height},frameRate:e.frameRate},audio:!1},function(r,i){return r?t(o,r):void a.publish(i,{maxVideoBW:e.maxVideoBW,videoCodec:e.videoCodec},function(e){t(n,e)},function(e){t(o,e)})})},this.playAudio=function(e,t,n){return e instanceof r.Stream&&e.hasAudio()&&"function"==typeof e.signalOnPlayAudio?e.signalOnPlayAudio(t,n):void("function"==typeof n&&n("unable to call playAudio"))},this.pauseAudio=function(e,t,n){return e instanceof r.Stream&&e.hasAudio()&&"function"==typeof e.signalOnPauseAudio?e.signalOnPauseAudio(t,n):void("function"==typeof n&&n("unable to call pauseAudio"))},this.playVideo=function(e,t,n){return e instanceof r.Stream&&e.hasVideo()&&"function"==typeof e.signalOnPlayVideo?e.signalOnPlayVideo(t,n):void("function"==typeof n&&n("unable to call playVideo"))},this.pauseVideo=function(e,t,n){return e instanceof r.Stream&&e.hasVideo()&&"function"==typeof e.signalOnPauseVideo?e.signalOnPauseVideo(t,n):void("function"==typeof n&&n("unable to call pauseVideo"))},this.addExternalOutput=function(e,n,r,i){var o=this;"function"==typeof n?(i=r,r=n,n={}):"object"==typeof n&&null!==n||(n={}),n.url=e,n.video&&n.video.resolution&&(n.resolution=n.video.resolution),c(o.socket,"addExternalOutput",n,function(e){return e?t(i,e):void t(r)})},this.updateExternalOutput=function(e,n,r,i){var o=this;"function"==typeof n?(i=r,r=n,n={}):"object"==typeof n&&null!==n||(n={}),n.url=e,n.video&&n.video.resolution&&(n.resolution=n.video.resolution),c(o.socket,"updateExternalOutput",n,function(e){return e?t(i,e):void t(r)})},this.removeExternalOutput=function(e,n,r){var i=this;return"string"!=typeof e?void t(r,"URL should be string."):void c(i.socket,"removeExternalOutput",{url:e},function(e){return e?t(r,e):void t(n)})},this.startRecorder=function(e,n,r){var i=this;"function"==typeof e?(r=n,n=e,e={}):"object"==typeof e&&null!==e||(e={}),c(i.socket,"startRecorder",e,function(e,i){return e?t(r,e):void t(n,i)})},this.stopRecorder=function(e,n,r){var i=this;"function"==typeof e?(r=n,n=e,e={}):"object"==typeof e&&null!==e||(e={}),c(i.socket,"stopRecorder",e,function(e,i){return e?t(r,e):void t(n,i)})},this.getRegion=function(e,n,r){var i=this;if("object"!=typeof e||null===e||"string"!=typeof e.id||""===e.id)return t(r,"invalid options");var o={id:e.id,mixStreamId:e.mixedStreamId};c(i.socket,"getRegion",o,function(e,i){return e?t(r,e):void t(n,i)})},this.setRegion=function(e,n,r){var i=this;if("object"!=typeof e||null===e||"string"!=typeof e.id||""===e.id||"string"!=typeof e.region||""===e.region)return t(r,"invalid options");var o={id:e.id,region:e.region,mixStreamId:e.mixedStreamId};c(i.socket,"setRegion",o,function(e,i){return e?t(r,e):void t(n,i)})},this.setVideoBitrate=function(e,n,r){var i=this;"function"==typeof e?(r=n,n=e,e={}):"object"==typeof e&&null!==e||(e={}),c(i.socket,"setVideoBitrate",e,function(e,i){return e?t(r,e):void t(n,i)})},this.getConnectionStats=function(e,n,r){e&&e.channel&&"function"==typeof e.channel.getConnectionStats?e.channel.getConnectionStats(function(e){t(n,e)},function(e){t(r,e)}):t(r,"invalid stream.")},this.mute=function(e,n,i,o){e instanceof r.Stream||t(o,"Invalid stream"),void 0!==n&&"audio"!==n&&"video"!==n&&t(o,"Invalid track kind.");var a=n||"av";c(this.socket,"mute",{streamId:e.id(),track:a},function(e){return e?t(o,e):void t(i)})},this.unmute=function(e,n,i,o){e instanceof r.Stream||t(o,"Invalid stream"),void 0!==n&&"audio"!==n&&"video"!==n&&t(o,"Invalid track kind.");var a=n||"av";c(this.socket,"unmute",{streamId:e.id(),track:a},function(e){return e?t(o,e):void t(i)})}};return e.prototype=Object.create(f.prototype),e.prototype.constructor=e,e.create=function(t){return new e(t)},e}(),r.SipClient=function(){var e=function(e){f.call(this,e),this.sip=!0,this.join=function(e,t,n){e.host=this.spec.host,e.secure=this.spec.secure,e=i.Base64.encodeBase64(JSON.stringify(e)),f.prototype.join.call(this,e,t,n)},this.subscribe=function(e,t,n,i){var o=this;"function"==typeof t?(i=n,n=t,t={}):"object"==typeof t&&null!==t||(t={});f.prototype.subscribe.call(this,e,t,function(e){o.dispatchEvent(new r.StreamEvent({type:"stream-subscribed",stream:e})),n(e)},i)},this.acceptCall=function(e,n){var r={type:"acceptCall"};c(this.socket,"customMessage",r,function(r,i){return r?t(n,r):void t(e,i)})},this.rejectCall=function(e,n){var r={type:"rejectCall"};c(this.socket,"customMessage",r,function(r,i){return r?t(n,r):void t(e,i)})},this.hangupCall=function(e,n){var r={type:"hangupCall"};c(this.socket,"customMessage",r,function(r,i){return r?t(n,r):void t(e,i)})},this.makeCall=function(e,n,r){var i={type:"makeCall",payload:e};c(this.socket,"customMessage",i,function(e,i){return e?t(r,e):void t(n,i)})}};return e.prototype=Object.create(f.prototype),e.prototype.constructor=e,e.create=function(t){return new e(t)},e}()}(),o.ChromeStableStack=function(e){"use strict";var t={},n=RTCPeerConnection;t.pc_config={iceServers:[]},t.con={optional:[{DtlsSrtpKeyAgreement:!0}]},e.iceServers instanceof Array&&(t.pc_config.iceServers=e.iceServers),void 0===e.audio&&(e.audio=!0),void 0===e.video&&(e.video=!0),t.mediaConstraints={mandatory:{OfferToReceiveVideo:e.video,OfferToReceiveAudio:e.audio}};var o=function(e){console.log("Error in Stack ",e)};t.peerConnection=new n(t.pc_config,t.con);var a=function(t){var n,r;return e.video&&e.maxVideoBW&&(t=t.replace(/b=AS:.*\r\n/g,""),null==(n=t.match(/m=video.*\r\n/))&&(n=t.match(/m=video.*\n/)),n&&n.length>0&&(r=n[0]+"b=AS:"+e.maxVideoBW+"\r\n",t=t.replace(n[0],r))),e.audio&&e.maxAudioBW&&(null==(n=t.match(/m=audio.*\r\n/))&&(n=t.match(/m=audio.*\n/)),n&&n.length>0&&(r=n[0]+"b=AS:"+e.maxAudioBW+"\r\n",t=t.replace(n[0],r))),t},s=function(t){return e.audioCodec?r.Common.setPreferredCodec(t,"audio",e.audioCodec):t},c=function(t){return e.videoCodec?r.Common.setPreferredCodec(t,"video",e.videoCodec):t},d=function(e){var t=s(e);return t=c(t)};t.close=function(){t.state="closed","closed"!==t.peerConnection.signalingState&&t.peerConnection.close()},e.localCandidates=[],t.peerConnection.onicecandidate=function(t){if(t.candidate){t.candidate.candidate.match(/a=/)||(t.candidate.candidate="a="+t.candidate.candidate);var n={sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid,candidate:t.candidate.candidate};e.remoteDescriptionSet?e.callback({type:"candidate",candidate:n}):(e.localCandidates.push(n),i.Logger.info("Storing candidate: ",e.localCandidates.length,n))}else console.log("End of candidates.")},t.peerConnection.onaddstream=function(e){t.onaddstream&&t.onaddstream(e)},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)},t.peerConnection.oniceconnectionstatechange=function(e){t.oniceconnectionstatechange&&t.oniceconnectionstatechange(e.currentTarget.iceConnectionState)};var u,p,l=function(n){n.sdp=a(n.sdp),n.sdp=d(n.sdp.replace(/a=ice-options:google-ice\r\n/g,"")),e.callback({type:n.type,sdp:n.sdp}),u=n,t.peerConnection.setLocalDescription(n)},f=function(n){n.sdp=a(n.sdp),e.callback({type:n.type,sdp:n.sdp}),u=n,t.peerConnection.setLocalDescription(n)};return t.updateSpec=function(n,r){(n.maxVideoBW||n.maxAudioBW)&&(n.maxVideoBW&&(console.log("Maxvideo Requested",n.maxVideoBW),e.maxVideoBW=n.maxVideoBW),n.maxAudioBW&&(console.log("Maxaudio Requested",n.maxAudioBW),e.maxAudioBW=n.maxAudioBW),u.sdp=a(u.sdp),t.peerConnection.setLocalDescription(u,function(){p.sdp=a(p.sdp),t.peerConnection.setRemoteDescription(new RTCSessionDescription(p),function(){e.remoteDescriptionSet=!0,r&&r("success")})}))},t.createOffer=function(e){!0===e?t.peerConnection.createOffer(l,o,t.mediaConstraints):t.peerConnection.createOffer(l,o)},t.iceRestart=function(){var n={offerToReceiveAudio:e.audio,offerToReceiveVideo:e.video,iceRestart:!0};t.peerConnection.createOffer(l,o,n)},t.addStream=function(e){t.peerConnection.addStream(e)},e.remoteCandidates=[],e.remoteDescriptionSet=!1,t.processSignalingMessage=function(n){if("offer"===n.type)n.sdp=a(n.sdp),t.peerConnection.setRemoteDescription(new RTCSessionDescription(n),function(){t.peerConnection.createAnswer(f,function(e){i.Logger.error("Error: ",e)},t.mediaConstraints),e.remoteDescriptionSet=!0},function(e){i.Logger.error("Error setting Remote Description",e)});else if("answer"===n.type)console.log("Set remote and local description",n.sdp),n.sdp=a(n.sdp),p=n,t.peerConnection.setRemoteDescription(new RTCSessionDescription(n),function(){for(e.remoteDescriptionSet=!0,console.log("Candidates to be added: ",e.remoteCandidates.length,e.remoteCandidates);e.remoteCandidates.length>0;)t.peerConnection.addIceCandidate(e.remoteCandidates.shift());for(console.log("Local candidates to send:",e.localCandidates.length);e.localCandidates.length>0;)e.callback({type:"candidate",candidate:e.localCandidates.shift()})});else if("candidate"===n.type)try{var r;(r="object"==typeof n.candidate?n.candidate:JSON.parse(n.candidate)).candidate=r.candidate.replace(/a=/g,""),r.sdpMLineIndex=parseInt(r.sdpMLineIndex,10);var o=new RTCIceCandidate(r);e.remoteDescriptionSet?t.peerConnection.addIceCandidate(o):(e.remoteCandidates.push(o),console.log("Candidates stored: ",e.remoteCandidates.length,e.remoteCandidates))}catch(e){i.Logger.error("Error parsing candidate",n.candidate)}},t.getConnectionStats=function(e,n){t.peerConnection.getStats(null,function(t){e(r.Common.parseStats(t))},n)},t},o.FirefoxStack=function(e){"use strict";var t={},n=mozRTCPeerConnection,o=mozRTCSessionDescription,a=mozRTCIceCandidate;t.pc_config={iceServers:[]},e.iceServers instanceof Array&&(t.pc_config.iceServers=e.iceServers),void 0===e.audio&&(e.audio=!0),void 0===e.video&&(e.video=!0),t.mediaConstraints={offerToReceiveAudio:e.audio,offerToReceiveVideo:e.video,mozDontOfferDataChannel:!0};var s=function(e){i.Logger.error("Error in Stack ",e)},c=!1;t.peerConnection=new n(t.pc_config),e.localCandidates=[],t.peerConnection.onicecandidate=function(t){t.candidate?(c=!0,t.candidate.candidate.match(/a=/)||(t.candidate.candidate="a="+t.candidate.candidate),e.remoteDescriptionSet?e.callback({type:"candidate",candidate:t.candidate}):(e.localCandidates.push(t.candidate),console.log("Local Candidates stored: ",e.localCandidates.length,e.localCandidates))):console.log("End of candidates.")};var d=function(t){return e.audioCodec?r.Common.setPreferredCodec(t,"audio",e.audioCodec):t},u=function(t){return e.videoCodec?r.Common.setPreferredCodec(t,"video",e.videoCodec):t},p=function(e){var t=d(e);return t=u(t)};t.peerConnection.onaddstream=function(e){t.onaddstream&&t.onaddstream(e)},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)},t.peerConnection.oniceconnectionstatechange=function(e){t.oniceconnectionstatechange&&t.oniceconnectionstatechange(e.currentTarget.iceConnectionState)};var l,f=function(t){var n,r;return e.video&&e.maxVideoBW&&(null==(n=t.match(/m=video.*\r\n/))&&(n=t.match(/m=video.*\n/)),n&&n.length>0&&(r=n[0]+"b=AS:"+e.maxVideoBW+"\r\n",t=t.replace(n[0],r))),e.audio&&e.maxAudioBW&&(null==(n=t.match(/m=audio.*\r\n/))&&(n=t.match(/m=audio.*\n/)),n&&n.length>0&&(r=n[0]+"b=AS:"+e.maxAudioBW+"\r\n",t=t.replace(n[0],r))),t},h=function(t){t.sdp=f(t.sdp),t.sdp=p(t.sdp.replace(/a=ice-options:google-ice\r\n/g,"")),e.callback(t),l=t},m=function(n){n.sdp=f(n.sdp),n.sdp=n.sdp.replace(/a=ice-options:google-ice\r\n/g,""),e.callback(n),l=n,t.peerConnection.setLocalDescription(l)};return t.createOffer=function(e){!0===e?t.peerConnection.createOffer(h,s,t.mediaConstraints):t.peerConnection.createOffer(h,s)},t.addStream=function(e){t.peerConnection.addStream(e)},e.remoteCandidates=[],e.remoteDescriptionSet=!1,t.close=function(){t.state="closed","closed"!==t.peerConnection.signalingState&&t.peerConnection.close()},t.iceRestart=function(){var n={offerToReceiveAudio:e.audio,offerToReceiveVideo:e.video,iceRestart:!0};t.peerConnection.createOffer(h,s,n)},t.processSignalingMessage=function(n){if("offer"===n.type)n.sdp=f(n.sdp),t.peerConnection.setRemoteDescription(new o(n),function(){t.peerConnection.createAnswer(m,function(e){i.Logger.error("Error",e)},t.mediaConstraints),e.remoteDescriptionSet=!0},function(e){i.Logger.error("Error setting Remote Description",e)});else if("answer"===n.type)console.log("Set remote and local description",n.sdp),n.sdp=f(n.sdp),t.peerConnection.setLocalDescription(l,function(){t.peerConnection.setRemoteDescription(new o(n),function(){for(e.remoteDescriptionSet=!0,i.Logger.info("Remote Description successfully set");e.remoteCandidates.length>0&&c;)i.Logger.info("Setting stored remote candidates"),t.peerConnection.addIceCandidate(e.remoteCandidates.shift());for(;e.localCandidates.length>0;)i.Logger.info("Sending Candidate from list"),e.callback({type:"candidate",candidate:e.localCandidates.shift()})},function(e){i.Logger.error("Error Setting Remote Description",e)})},function(e){i.Logger.error("Failure setting Local Description",e)});else if("candidate"===n.type)try{var r;(r="object"==typeof n.candidate?n.candidate:JSON.parse(n.candidate)).candidate=r.candidate.replace(/ generation 0/g,""),r.candidate=r.candidate.replace(/ udp /g," UDP "),r.sdpMLineIndex=parseInt(r.sdpMLineIndex,10);var s=new a(r);if(e.remoteDescriptionSet&&c)for(t.peerConnection.addIceCandidate(s);e.remoteCandidates.length>0;)i.Logger.info("Setting stored remote candidates"),t.peerConnection.addIceCandidate(e.remoteCandidates.shift());else e.remoteCandidates.push(s)}catch(e){i.Logger.error("Error parsing candidate",n.candidate,e)}},t.getConnectionStats=function(e,n){t.peerConnection.getStats(null,function(t){e(r.Common.parseStats(t))},n)},t},o.EdgeORTCStack=function(t){"use strict";var n={};n.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},n.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},n.matchPrefix=function(e,t){return n.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},n.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1]}return n},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),"candidate:"+t.join(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.numChannels=3===t.length?parseInt(t[2],10):1,n},n.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)t=r[i].trim().split("="),n[t[0].trim()]=t[1];return n},n.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){r.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+" "+e.parameter+"\r\n"}),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},n.getDtlsParameters=function(e,t){var r=n.splitLines(e),i=(r=r.concat(n.splitLines(t))).filter(function(e){return 0===e.indexOf("a=fingerprint:")})[0].substr(14);return{role:"auto",fingerprints:[{algorithm:i.split(" ")[0],value:i.split(" ")[1]}]}},n.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},n.getIceParameters=function(e,t){var r=n.splitLines(e);return{usernameFragment:(r=r.concat(n.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:r.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=n.splitLines(e)[0].split(" "),i=3;i<r.length;i++){var o=r[i],a=n.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=n.parseRtpMap(a),c=n.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=c.length?n.parseFmtp(c[0]):{},s.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(n.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(n.parseExtmap(e))}),t},n.writeRtpDescription=function(e,t){var r="";return r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=n.writeRtpMap(e),r+=n.writeFmtp(e),r+=n.writeRtcpFb(e)}),r+="a=rtcp-mux\r\n"},n.parseRtpEncodingParameters=function(e){var t,r=[],i=n.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,d=n.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{payloadType:e.payloadType,ssrc:t}};r.push(n),o&&(n=JSON.parse(JSON.stringify(n)),n.fec={ssrc:t,mechanism:a?"red+ulpfec":"red"},r.push(n))}}),0===r.length&&c&&r.push({ssrc:c});var u=n.matchPrefix(e,"b=");return u.length&&(0===u[0].indexOf("b=TIAS:")?u=parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")&&(u=parseInt(u[0].substr(5),10)),r.forEach(function(e){e.maxBitrate=u})),r},n.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,r,i){var o=n.writeRtpDescription(e.kind,t);if(o+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",o+=e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n"},n.getDirection=function(e,t){for(var r=n.splitLines(e),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substr(2)}return t?n.getDirection(t):"sendrecv"},e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}));var r={};r.pc_config={iceServers:[]},t.iceServers instanceof Array&&(r.pc_config.iceServers=t.iceServers),void 0===t.audio&&(t.audio=!0),void 0===t.video&&(t.video=!0),e.RTCPeerConnection=function(e){var t=this,n=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){t[e]=n[e].bind(n)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return t.localStreams},this.getRemoteStreams=function(){return t.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},e&&e.iceTransportPolicy)switch(e.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=e.iceTransportPolicy;break;case"none":throw new TypeError('iceTransportPolicy "none" not supported')}if(this.usingBundle=e&&"max-bundle"===e.bundlePolicy,e&&e.iceServers){var r=JSON.parse(JSON.stringify(e.iceServers));this.iceOptions.iceServers=r.filter(function(e){if(e&&e.urls){var t=e.urls;return"string"==typeof t&&(t=[t]),!!(t=t.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")})[0])}return!1})}this.transceivers=[],this._localIceCandidatesBuffer=[]},e.RTCPeerConnection.prototype.addStream=function(e){this.localStreams.push(e.clone()),this._maybeFireNegotiationNeeded()},e.RTCPeerConnection.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},e.RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},e.RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},e.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var e=this,t=n.splitSections(e.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(n){if(!n.candidate||0===Object.keys(n.candidate).length)for(var r=1;r<t.length;r++)-1===t[r].indexOf("\r\na=end-of-candidates\r\n")&&(t[r]+="a=end-of-candidates\r\n");else-1===n.candidate.candidate.indexOf("typ endOfCandidates")&&(t[n.candidate.sdpMLineIndex+1]+="a="+n.candidate.candidate+"\r\n");e.localDescription.sdp=t.join(""),null!==e.dispatchEvent&&e.dispatchEvent(n),null!==e.onicecandidate&&e.onicecandidate(n),n.candidate||"complete"===e.iceGatheringState||e.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state})&&(e.iceGatheringState="complete")}),this._localIceCandidatesBuffer=[]},e.RTCPeerConnection.prototype._getCommonCapabilities=function(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]};return e.codecs.forEach(function(e){for(var r=0;r<t.codecs.length;r++){var i=t.codecs[r];if(e.name.toLowerCase()===i.name.toLowerCase()&&e.clockRate===i.clockRate&&e.numChannels===i.numChannels){n.codecs.push(i);break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n},e.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(t,r){var i=this,o=new e.RTCIceGatherer(i.iceOptions),a=new e.RTCIceTransport(o);o.onlocalcandidate=function(e){var s=new Event("icecandidate");s.candidate={sdpMid:t,sdpMLineIndex:r};var c=e.candidate,d=!c||0===Object.keys(c).length;d?(void 0===o.state&&(o.state="completed"),s.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates"):(c.component="RTCP"===a.component?2:1,s.candidate.candidate=n.writeCandidate(c));var u=n.splitSections(i.localDescription.sdp);-1===s.candidate.candidate.indexOf("typ endOfCandidates")?u[s.candidate.sdpMLineIndex+1]+="a="+s.candidate.candidate+"\r\n":u[s.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n",i.localDescription.sdp=u.join("");var p=i.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});switch(i.iceGatheringState){case"new":i._localIceCandidatesBuffer.push(s),d&&p&&i._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":i._emitBufferedCandidates(),null!==i.dispatchEvent&&i.dispatchEvent(s),null!==i.onicecandidate&&i.onicecandidate(s),p&&(null!==i.dispatchEvent&&i.dispatchEvent(new Event("icecandidate")),null!==i.onicecandidate&&i.onicecandidate(new Event("icecandidate")),i.iceGatheringState="complete")}},a.onicestatechange=function(){i._updateConnectionState()};var s=new e.RTCDtlsTransport(a);return s.ondtlsstatechange=function(){i._updateConnectionState()},s.onerror=function(){i._updateConnectionState()},{iceGatherer:o,iceTransport:a,dtlsTransport:s}},e.RTCPeerConnection.prototype._transceive=function(e,t,r){var i=this._getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:n.localCName},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),r&&e.rtpReceiver&&(i.encodings=e.recvEncodingParameters,i.rtcp={cname:e.cname},e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},e.RTCPeerConnection.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");null!==this.dispatchEvent&&this.dispatchEvent(t),null!==this.onsignalingstatechange&&this.onsignalingstatechange(t)},e.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var e=new Event("negotiationneeded");null!==this.dispatchEvent&&this.dispatchEvent(e),null!==this.onnegotiationneeded&&this.onnegotiationneeded(e)},e.RTCPeerConnection.prototype._updateConnectionState=function(){var e,t=this,n={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(e){n[e.iceTransport.state]++,n[e.dtlsTransport.state]++}),n.connected+=n.completed,e="new",n.failed>0?e="failed":n.connecting>0||n.checking>0?e="connecting":n.disconnected>0?e="disconnected":n.new>0?e="new":(n.connected>0||n.completed>0)&&(e="connected"),e!==t.iceConnectionState){t.iceConnectionState=e;var r=new Event("iceconnectionstatechange");null!==this.dispatchEvent&&this.dispatchEvent(r),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(e)}},e.RTCPeerConnection.prototype.setLocalDescription=function(t){var r,i,o=this;if("offer"===t.type)this._pendingOffer&&(r=n.splitSections(t.sdp),i=r.shift(),r.forEach(function(e,t){var r=n.parseRtpParameters(e);o._pendingOffer[t].localCapabilities=r}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===t.type){r=n.splitSections(o.remoteDescription.sdp),i=r.shift();var a=n.matchPrefix(i,"a=ice-lite").length>0;r.forEach(function(e,t){var r=o.transceivers[t],s=r.iceGatherer,c=r.iceTransport,d=r.dtlsTransport,u=r.localCapabilities,p=r.remoteCapabilities;if(!("0"===e.split("\n",1)[0].split(" ",2)[1])){var l=n.getIceParameters(e,i);if(a){var f=n.matchPrefix(e,"a=candidate:").map(function(e){return n.parseCandidate(e)}).filter(function(e){return"1"===e.component});f.length&&c.setRemoteCandidates(f)}var h=n.getDtlsParameters(e,i);a&&(h.role="server"),h.role="client",o.usingBundle&&0!==t||(c.start(s,l,a?"controlling":"controlled"),d.start(h));var m=o._getCommonCapabilities(u,p);o._transceive(r,m.codecs.length>0,!1)}})}switch(this.localDescription={type:t.type,sdp:t.sdp},t.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+t.type+'"')}var s=arguments.length>1&&"function"==typeof arguments[1];if(s){var c=arguments[1];e.setTimeout(function(){c(),"new"===o.iceGatheringState&&(o.iceGatheringState="gathering"),o._emitBufferedCandidates()},0)}var d=e.Promise.resolve();return d.then(function(){s||("new"===o.iceGatheringState&&(o.iceGatheringState="gathering"),e.setTimeout(o._emitBufferedCandidates.bind(o),500))}),d},e.RTCPeerConnection.prototype.setRemoteDescription=function(t){var r=this,i=new e.MediaStream,o=[],a=n.splitSections(t.sdp),s=a.shift(),c=n.matchPrefix(s,"a=ice-lite").length>0;switch(this.usingBundle=n.matchPrefix(s,"a=group:BUNDLE ").length>0,a.forEach(function(a,d){var u,p,l,f,h,m,g,v,y,b,S,C,w=n.splitLines(a)[0].substr(2).split(" "),E=w[0],k="0"===w[1],A=n.getDirection(a,s),T=n.parseRtpParameters(a);k||(S=n.getIceParameters(a,s),C=n.getDtlsParameters(a,s),C.role="client"),C.role="client",v=n.parseRtpEncodingParameters(a);var R=n.matchPrefix(a,"a=mid:");R=R.length?R[0].substr(6):n.generateIdentifier();var x,P=n.matchPrefix(a,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];P&&(x=P.value);var L=n.matchPrefix(a,"a=candidate:").map(function(e){return n.parseCandidate(e)}).filter(function(e){return"1"===e.component});if(L.push({}),"offer"!==t.type||k)"answer"!==t.type||k||(u=r.transceivers[d],p=u.iceGatherer,l=u.iceTransport,f=u.dtlsTransport,h=u.rtpSender,m=u.rtpReceiver,g=u.sendEncodingParameters,y=u.localCapabilities,r.transceivers[d].recvEncodingParameters=v,r.transceivers[d].remoteCapabilities=T,r.transceivers[d].cname=x,(c||!0)&&L.length&&l.setRemoteCandidates(L),r.usingBundle&&0!==d||(l.start(p,S,"controlling"),f.start(C)),r._transceive(u,"sendrecv"===A||"recvonly"===A,"sendrecv"===A||"sendonly"===A),!m||"sendrecv"!==A&&"sendonly"!==A?delete u.rtpReceiver:(b=m.track,o.push([b,m]),i.addTrack(b)));else{var O=r.usingBundle&&d>0?{iceGatherer:r.transceivers[0].iceGatherer,iceTransport:r.transceivers[0].iceTransport,dtlsTransport:r.transceivers[0].dtlsTransport}:r._createIceAndDtlsTransports(R,d);if(O.iceTransport.setRemoteCandidates(L),y=e.RTCRtpReceiver.getCapabilities(E),g=[{ssrc:1001*(2*d+2)}],m=new e.RTCRtpReceiver(O.dtlsTransport,E),b=m.track,o.push([b,m]),i.addTrack(b),r.localStreams.length>0&&r.localStreams[0].getTracks().length>=d){var I;"audio"===E?I=r.localStreams[0].getAudioTracks()[0]:"video"===E&&(I=r.localStreams[0].getVideoTracks()[0]),I&&(h=new e.RTCRtpSender(I,O.dtlsTransport))}r.transceivers[d]={iceGatherer:O.iceGatherer,iceTransport:O.iceTransport,dtlsTransport:O.dtlsTransport,localCapabilities:y,remoteCapabilities:T,rtpSender:h,rtpReceiver:m,kind:E,mid:R,cname:x,sendEncodingParameters:g,recvEncodingParameters:v},r._transceive(r.transceivers[d],!1,"sendrecv"===A||"sendonly"===A)}}),this.remoteDescription={type:t.type,sdp:t.sdp},t.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+t.type+'"')}return i.getTracks().length&&(r.remoteStreams.push(i),e.setTimeout(function(){var t=new Event("addstream");t.stream=i,null!==r.dispatchEvent&&r.dispatchEvent(t),null!==r.onaddstream&&e.setTimeout(function(){r.onaddstream(t)},0),o.forEach(function(n){var o=n[0],a=n[1],s=new Event("track");s.track=o,s.receiver=a,s.streams=[i],null!==r.dispatchEvent&&r.dispatchEvent(t),null!==r.ontrack&&e.setTimeout(function(){r.ontrack(s)},0)})},0)),arguments.length>1&&"function"==typeof arguments[1]&&e.setTimeout(arguments[1],0),e.Promise.resolve()},e.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},e.RTCPeerConnection.prototype.createOffer=function(){var t=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var r;1===arguments.length&&"function"!=typeof arguments[0]?r=arguments[0]:3===arguments.length&&(r=arguments[2]);var i=[],o=0,a=0;if(this.localStreams.length&&(o=this.localStreams[0].getAudioTracks().length,a=this.localStreams[0].getVideoTracks().length),r){if(r.mandatory||r.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==r.offerToReceiveAudio&&(o=r.offerToReceiveAudio),void 0!==r.offerToReceiveVideo&&(a=r.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(e){i.push({kind:e.kind,track:e,wantReceive:"audio"===e.kind?o>0:a>0}),"audio"===e.kind?o--:"video"===e.kind&&a--});o>0||a>0;)o>0&&(i.push({kind:"audio",wantReceive:!0}),o--),a>0&&(i.push({kind:"video",wantReceive:!0}),a--);var s=n.writeSessionBoilerplate(),c=[];i.forEach(function(r,i){var o,a,s=r.track,d=r.kind,u=n.generateIdentifier(),p=t.usingBundle&&i>0?{iceGatherer:c[0].iceGatherer,iceTransport:c[0].iceTransport,dtlsTransport:c[0].dtlsTransport}:t._createIceAndDtlsTransports(u,i),l=e.RTCRtpSender.getCapabilities(d),f=[{ssrc:1001*(2*i+1)}];s&&(o=new e.RTCRtpSender(s,p.dtlsTransport)),r.wantReceive&&(a=new e.RTCRtpReceiver(p.dtlsTransport,d)),c[i]={iceGatherer:p.iceGatherer,iceTransport:p.iceTransport,dtlsTransport:p.dtlsTransport,localCapabilities:l,remoteCapabilities:null,rtpSender:o,rtpReceiver:a,kind:d,mid:u,sendEncodingParameters:f,recvEncodingParameters:null}}),this.usingBundle&&(s+="a=group:BUNDLE "+c.map(function(e){return e.mid}).join(" ")+"\r\n"),i.forEach(function(e,r){var i=c[r];s+=n.writeMediaSection(i,i.localCapabilities,"offer",t.localStreams[0])}),this._pendingOffer=c;var d=new RTCSessionDescription({type:"offer",sdp:s});return arguments.length&&"function"==typeof arguments[0]&&e.setTimeout(arguments[0],0,d),e.Promise.resolve(d)},e.RTCPeerConnection.prototype.createAnswer=function(){var t=this,r=n.writeSessionBoilerplate();this.usingBundle&&(r+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(e){var i=t._getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);r+=n.writeMediaSection(e,i,"answer",t.localStreams[0])});var i=new RTCSessionDescription({type:"answer",sdp:r});return arguments.length&&"function"==typeof arguments[0]&&e.setTimeout(arguments[0],0,i),e.Promise.resolve(i)},e.RTCPeerConnection.prototype.addIceCandidate=function(t){if(null===t)this.transceivers.forEach(function(e){e.iceTransport.addRemoteCandidate({})});else{var r=t.sdpMLineIndex;if(t.sdpMid)for(var i=0;i<this.transceivers.length;i++)if(this.transceivers[i].mid===t.sdpMid){r=i;break}var o=this.transceivers[r];if(o){var a=Object.keys(t.candidate).length>0?n.parseCandidate(t.candidate):{};if("tcp"===a.protocol&&0===a.port)return;if("1"!==a.component)return;"endOfCandidates"===a.type&&(a={}),o.iceTransport.addRemoteCandidate(a);var s=n.splitSections(this.remoteDescription.sdp);s[r+1]+=(a.type?t.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=s.join("")}}return arguments.length>1&&"function"==typeof arguments[1]&&e.setTimeout(arguments[1],0),e.Promise.resolve()},r.mediaConstraints={offerToReceiveVideo:t.video,offerToReceiveAudio:t.audio};var o,a=function(e){i.Logger.error("Error in Edge Stack ",e)},s=function(e){if("H264"!==t.videoCodec&&"h264"!==t.videoCodec)return e;try{var n=e.match(/m=video.*\r\n/g)[0],r=n.replace(/\s120/,"").replace("\r\n","")+" 120\r\n";return e.replace(n,r)}catch(t){return e}},c=function(e){return s(e)},d=function(e){var n,r;return t.video&&t.maxVideoBW&&(null==(n=e.match(/m=video.*\r\n/))&&(n=e.match(/m=video.*\n/)),n&&n.length>0&&(r=n[0]+"b=AS:"+t.maxVideoBW+"\r\n",e=e.replace(n[0],r))),t.audio&&t.maxAudioBW&&(null==(n=e.match(/m=audio.*\r\n/))&&(n=e.match(/m=audio.*\n/)),n&&n.length>0&&(r=n[0]+"b=AS:"+t.maxAudioBW+"\r\n",e=e.replace(n[0],r))),e},u=function(e){e.sdp=d(e.sdp),e.sdp=c(e.sdp.replace(/a=ice-options:google-ice\r\n/g,"")),t.callback(e),o=e},p=function(e){e.sdp=d(e.sdp),e.sdp=e.sdp.replace(/a=ice-options:google-ice\r\n/g,""),t.callback(e),o=e,r.peerConnection.setLocalDescription(o)};return r.peerConnection=new e.RTCPeerConnection(r.pc_config),t.localCandidates=[],t.remoteCandidates=[],t.remoteDescriptionSet=!1,r.peerConnection.onicecandidate=function(e){if(e.candidate){e.candidate.candidate.match(/a=/)||(e.candidate.candidate="a="+e.candidate.candidate);var n={sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid,candidate:e.candidate.candidate};t.remoteDescriptionSet?t.callback({type:"candidate",candidate:n}):t.localCandidates.push(n)}else t.localCandidates.push({candidate:{}}),console.log("End of candidates.")},r.peerConnection.onaddstream=function(e){r.onaddstream&&r.onaddstream(e)},r.peerConnection.onremovestream=function(e){r.onremovestream&&r.onremovestream(e)},r.peerConnection.oniceconnectionstatechange=function(e){r.oniceconnectionstatechange&&r.oniceconnectionstatechange(e)},r.createOffer=function(e){!0===e?r.peerConnection.createOffer(u,a,r.mediaConstraints):r.peerConnection.createOffer(u,a)},r.addStream=function(e){r.peerConnection.addStream(e)},r.processSignalingMessage=function(e){if(i.Logger.debug("Process Signaling Message",e.type),"offer"===e.type)e.sdp=d(e.sdp),console.log("Set offer description \n",e.sdp),r.peerConnection.setRemoteDescription(new RTCSessionDescription(e),function(){r.peerConnection.createAnswer(p,function(e){i.Logger.error("Error",e)},r.mediaConstraints),t.remoteDescriptionSet=!0},function(e){i.Logger.error("Error setting Remote Description",e)});else if("answer"===e.type)console.log("Set remote description",e.sdp),e.sdp=d(e.sdp),r.peerConnection.setLocalDescription(o,function(){r.peerConnection.setRemoteDescription(new RTCSessionDescription(e),function(){for(t.remoteDescriptionSet=!0,i.Logger.info("Remote Description successfully set");t.remoteCandidates.length>0;)r.peerConnection.addIceCandidate(t.remoteCandidates.shift());for(;t.localCandidates.length>0;)t.callback({type:"candidate",candidate:t.localCandidates.shift()})},function(e){i.Logger.error("Failure Setting Remote Description",e)})},function(e){i.Logger.error("Failure Setting Local Description",e)});else if("candidate"===e.type)try{var n;(n="object"==typeof e.candidate?e.candidate:JSON.parse(e.candidate)).candidate=n.candidate.replace(/a=/g,""),n.sdpMLineIndex=parseInt(n.sdpMLineIndex,10);var a=new RTCIceCandidate(n);if(t.remoteDescriptionSet)for(r.peerConnection.addIceCandidate(a);t.remoteCandidates.length>0;)i.Logger.info("Setting stored remote candidates"),r.peerConnection.addIceCandidate(t.remoteCandidates.shift());else t.remoteCandidates.push(a)}catch(t){i.Logger.error("Error parsing candidate",e.candidate,t)}},r.close=function(){r.state="closed","closed"!==r.peerConnection.signalingState&&r.peerConnection.close()},r.getConnectionStats=function(e,t){t("getConnectionStats is not supported on Edge.")},r.iceRestart=function(){i.Logger.error("ICE restart on Edge is not supported yet.")},r},(r=r||{}).Error={STREAM_LOCAL_ACCESS_DENIED:{code:1101,message:"Cannot access to camera or micphone."},P2P_CONN_SERVER_UNKNOWN:{code:2100,message:"Server unknown error."},P2P_CONN_SERVER_UNAVAILABLE:{code:2101,message:"Server is unavaliable."},P2P_CONN_SERVER_BUSY:{code:2102,message:"Server is too busy."},P2P_CONN_SERVER_NOT_SUPPORTED:{code:2103,message:"Method has not been supported by server"},P2P_CONN_CLIENT_UNKNOWN:{code:2110,message:"Client unknown error."},P2P_CONN_CLIENT_NOT_INITIALIZED:{code:2111,message:"Connection is not initialized."},P2P_CONN_AUTH_UNKNOWN:{code:2120,message:"Authentication unknown error."},P2P_CONN_AUTH_FAILED:{code:2121,message:"Wrong username or token."},P2P_MESSAGING_TARGET_UNREACHABLE:{code:2201,message:"Remote user cannot be reached."},P2P_CHATROOM_ATTENDEE_EXCEED:{code:2301,message:"Exceed room's limitation"},P2P_CHATROOM_PEER_NOT_FOUND:{code:2302,message:"Peer not found. Only one client in the room."},P2P_CLIENT_UNKNOWN:{code:2400,message:"Unknown errors."},P2P_CLIENT_UNSUPPORTED_METHOD:{code:2401,message:"This method is unsupported in current browser."},P2P_CLIENT_ILLEGAL_ARGUMENT:{code:2402,message:"Illegal argument."},P2P_CLIENT_INVALID_STATE:{code:2403,message:"Invalid peer state."},getErrorByCode:function(e){return{1101:r.Error.STREAM_LOCAL_ACCESS_DENIED,2100:r.Error.P2P_CONN_SERVER_UNKNOWN,2101:r.Error.P2P_CONN_SERVER_UNAVAILABLE,2102:r.Error.P2P_CONN_SERVER_BUSY,2103:r.Error.P2P_CONN_SERVER_NOT_SUPPORTED,2110:r.Error.P2P_CONN_CLIENT_UNKNOWN,2111:r.Error.P2P_CONN_CLIENT_NOT_INITIALIZED,2120:r.Error.P2P_CONN_AUTH_UNKNOWN,2121:r.Error.P2P_CONN_AUTH_FAILED,2201:r.Error.P2P_MESSAGING_TARGET_UNREACHABLE,2301:r.Error.P2P_CHATROOM_ATTENDEE_EXCEED,2302:r.Error.P2P_CHATROOM_PEER_NOT_FOUND,2400:r.Error.P2P_CLIENT_UNKNOWN,2401:r.Error.P2P_CLIENT_UNSUPPORTED_METHOD,2402:r.Error.P2P_CLIENT_ILLEGAL_ARGUMENT,2403:r.Error.P2P_CLIENT_INVALID_STATE}[e]}},(r=r||{}).PeerClient=function(t){"use strict";var o,a,s=r.EventDispatcher({}),c={READY:1,MATCHED:2,OFFERED:3,PENDING:4,CONNECTING:5,CONNECTED:6,ERROR:9},d={READY:1,REQUESTED:2,ACCEPTED:3,NEGOTIATING:4},u={MESSAGE:"message",FILE:"file"},p={READY:1,CONNECTING:2,CONNECTED:3},l=p.READY,f=t,h=function(e){return"[object Array]"===Object.prototype.toString.call(e)},m=null,g={},v={},y=null,b=!1,S={},C={optional:[{DtlsSrtpKeyAgreement:"true"}]},w={offerToReceiveAudio:!0,offerToReceiveVideo:!0},E=null,k=r.Common.sysInfo(),A=!navigator.mozGetUserMedia,T=!!navigator.mozGetUserMedia;t&&(E={iceServers:t.iceServers});var R=function(e,t){return e.localeCompare(t)},x=function(e){return e},P=function(e,t){e.negotiationState=t},L=function(e,t){e.state!==c.CONNECTED&&e.state!==c.CONNECTING||(e.sendDataChannel&&e.sendDataChannel.close(),e.receiveDataChannel&&e.receiveDataChannel.close(),e.connection&&"closed"!==e.connection.iceConnectionState&&e.connection.close(),e.state!==c.READY&&(e.state=c.READY,s.dispatchEvent(new r.ChatEvent({type:"chat-stopped",peerId:e.id,senderId:t}))),re(e.connection))},O=function(e,t){t.sdk&&t.sdk&&"JavaScript"===t.sdk.type&&t.runtime&&"FireFox"===t.runtime.name?(e.remoteSideSupportsRemoveStream=!1,e.remoteSideSupportsPlanB=!1,e.remoteSideSupportsUnifiedPlan=!0,e.preferredVideoCodec="vp8"):(e.remoteSideSupportsRemoveStream=!0,e.remoteSideSupportsPlanB=!0,e.remoteSideSupportsUnifiedPlan=!1)},I=function(){b=!0,l=p.CONNECTED},N=function(){a&&a(),o=void 0,a=void 0},D=function(){b=!1,l=p.READY,s.dispatchEvent(new r.ClientEvent({type:"server-disconnected"}))},_=function(e,t){var n=g[e];n||(ce(e),n=g[e]),O(n,t),n.state===c.READY||n.state===c.PENDING?(g[e].state=c.PENDING,s.dispatchEvent(new r.ChatEvent({type:"chat-invited",senderId:e}))):n.state===c.OFFERED&&R(y,e)<0&&(n.state=c.PENDING,pe(e,function(){s.dispatchEvent(new r.ChatEvent({type:"chat-accepted",senderId:e}))}))},M=function(e){var t=g[e];t&&t.connection&&(t.sendDataChannel&&t.sendDataChannel.close(),t.receiveDataChannel&&t.receiveDataChannel.close(),t.connection.close()),delete g[e],s.dispatchEvent(new r.ChatEvent({type:"chat-denied",senderId:e}))},B=function(e,t){i.Logger.debug("Received chat accepted.");var n=g[e];n&&(n.state=c.MATCHED,O(n,t),ne(n),n.state=c.CONNECTING,oe(n.id),s.dispatchEvent(new r.ChatEvent({type:"chat-accepted",senderId:e})))},j=function(e){var t=g[e];t&&t.connection&&L(t,e),delete g[e]},U=function(e,t){var n=g[t];n&&n.state===c.CONNECTING&&(n.connection||ne(n)),Z(n,e)},V=function(e,t){v[e.streamId]=e.type,i.Logger.debug("remote stream ID:"+e.streamId+",type:"+v[e.streamId])},F=function(e){y=e,o&&o(e),o=void 0,a=void 0},G=function(){Ee()},z=function(e){i.Logger.debug("On negotiation needed."),e.isCaller&&"stable"===e.connection.signalingState&&e.negotiationState===d.READY?se(e):!e.isCaller&&m?m.sendNegotiationNeeded(e.id):e.isNegotiationNeeded=!0},W=function(e,t){t.candidate&&m&&m.sendSignalMessage(e.id,{type:"candidates",candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex})},q=function(e,t){if(e&&i.Logger.debug("On remote ice candidate from peer "+e.id),e&&(e.state===c.OFFERED||e.state===c.CONNECTING||e.state===c.CONNECTED)){var n=new RTCIceCandidate({candidate:t.message.candidate,sdpMid:t.message.sdpMid,sdpMLineIndex:t.message.sdpMLineIndex});e.connection?(i.Logger.debug("Add remote ice candidates."),e.connection.addIceCandidate(n,$,ee)):(i.Logger.debug("Cache remote ice candidates."),e.remoteIceCandidates||(e.remoteIceCandidates=[]),e.remoteIceCandidates.push(n))}},H=function(e,t){if(e)switch(e.state){case c.OFFERED:case c.MATCHED:e.state=c.CONNECTING,ne(e);case c.CONNECTING:case c.CONNECTED:i.Logger.debug("About to set remote description. Signaling state: "+e.connection.signalingState);var n=new RTCSessionDescription(t.message);n.sdp=Oe(n.sdp),e.connection.setRemoteDescription(n,function(){ve(e),fe(e)},function(e){i.Logger.debug("Set remote description failed. Message: "+JSON.stringify(e))});break;default:i.Logger.debug("Unexpected peer state: "+e.state)}else i.Logger.debug('"peer" cannot be null or undefined')},J=function(e,t){if(e&&(e.state===c.CONNECTING||e.state===c.CONNECTED)){i.Logger.debug("About to set remote description. Signaling state: "+e.connection.signalingState);var n=new RTCSessionDescription(t.message);n.sdp=Oe(n.sdp),e.connection.setRemoteDescription(new RTCSessionDescription(n),function(){i.Logger.debug("Set remote descripiton successfully."),fe(e),me(e)},function(e){i.Logger.debug("Set remote description failed. Message: "+e)})}},Q=function(e,t){var n=v[e.id];if(n){var i={};"screen"===n?i.video={device:"screen"}:(i.video=e.getVideoTracks().length>0&&{device:"camera"},i.audio=e.getAudioTracks().length>0);var o=new r.RemoteStream(i);return o.mediaStream=e,o.from=t.id,o.id=function(){return e.id},o}return null},K=function(e,t){i.Logger.debug("Remote stream added.");var n=Q(t.stream,e);if(n){var o=new r.StreamEvent({type:"stream-added",senderId:e.id,stream:n});s.dispatchEvent(o)}},Y=function(e,t){i.Logger.debug("Remote stream removed.");var n=Q(t.stream,e);if(n){var o=new r.StreamEvent({type:"stream-removed",stream:n});s.dispatchEvent(o)}},Z=function(e,t){i.Logger.debug("S->C: "+JSON.stringify(t)),"offer"===t.type?H(e,{message:t}):"answer"===t.type?J(e,{message:t}):"candidates"===t.type&&q(e,{message:t})},X=function(e,t){e&&(i.Logger.debug("Ice connection state changed. State: "+e.connection.iceConnectionState),"closed"!==e.connection.iceConnectionState&&"failed"!==e.connection.iceConnectionState||e.state!==c.CONNECTED||(L(e,e.id),m&&m.sendChatStopped(e.id),delete g[e.id]),"connected"!==e.connection.iceConnectionState&&"completed"!==e.connection.iceConnectionState||(e.lastDisconnect=new Date("2099/12/31").getTime(),e.state!==c.CONNECTED&&(e.state=c.CONNECTED,s.dispatchEvent(new r.ChatEvent({type:"chat-started",peerId:e.id})))),"checking"===e.connection.iceConnectionState&&(e.lastDisconnect=new Date("2099/12/31").getTime()),"disconnected"===e.connection.iceConnectionState&&(e.lastDisconnect=(new Date).getTime(),setTimeout(function(){(new Date).getTime()-e.lastDisconnect>=15e3&&(i.Logger.debug("Disconnect timeout."),L(e,e.id),e===g[e.id]&&delete g[e.id])},15e3)))},$=function(){i.Logger.debug("Add ice candidate success.")},ee=function(e){i.Logger.debug("Add ice candidate failed. Error: "+e)},te=function(e){i.Logger.debug("Signaling state changed: "+e.connection.signalingState),"closed"===e.connection.signalingState?(L(e,e.id),delete g[e.id]):"stable"===e.connection.signalingState&&(P(e,d.READY),e.isCaller&&e.isNegotiationNeeded&&m?se(e):he(e))},ne=function(e){if(!e||e.connection)return!0;try{e.connection=new RTCPeerConnection(E,C),e.connection.onicecandidate=function(t){W(e,t)},e.connection.onaddstream=function(t){K(e,t)},e.connection.onremovestream=function(t){Y(e,t)},e.connection.oniceconnectionstatechange=function(t){X(e)},e.connection.onnegotiationneeded=function(){z(g[e.id])},e.connection.onsignalingstatechange=function(){te(e)},e.connection.ondatachannel=function(t){i.Logger.debug(y+": On data channel"),e.dataChannels[t.channel.label]||(e.dataChannels[t.channel.label]=t.channel,i.Logger.debug("Save remote created data channel.")),ie(t.channel,e)}}catch(e){return i.Logger.debug("Failed to create PeerConnection, exception: "+e.message),!1}return!0},re=function(e){e.onicecandidate=void 0,e.onaddstream=void 0,e.onremovestream=void 0,e.oniceconnectionstatechange=void 0,e.onnegotiationneeded=void 0,e.onsignalingstatechange=void 0},ie=function(e,t){e.onmessage=function(e){Ae(t,e)},e.onopen=function(e){Te(t,e)},e.onclose=function(e){Re(t,e)},e.onerror=function(e){i.Logger.debug("Data Channel Error:",e)}},oe=function(e,t){t||(t=u.MESSAGE),ae(x(e),t)},ae=function(e,t){var n=g[e];if(n&&!n.dataChannels[t]){i.Logger.debug("Do create data channel.");try{var r=n.connection.createDataChannel(t,null);ie(r,n),n.dataChannels[u.MESSAGE]=r}catch(e){i.Logger.error("Failed to create SendDataChannel, exception: "+e.message)}}},se=function(e){i.Logger.debug("Do renegotiation."),P(e,d.NEGOTIATING),le(e)},ce=function(e){return g[e]||(g[e]={state:c.READY,id:e,pendingStreams:[],pendingUnpublishStreams:[],remoteIceCandidates:[],dataChannels:{},pendingMessages:[],negotiationState:d.READY,lastDisconnect:new Date("2099/12/31").getTime(),publishedStreams:[],isCaller:!0,remoteSideSupportsRemoveStream:!1,remoteSideSupportsPlanB:!1,remoteSideSupportsUnifiedPlan:!1}),g[e]},de=function(e){var t=g[e];i.Logger.debug(y+": Remote side needs negotiation."),t&&(t.isCaller&&"stable"===t.connection.signalingState&&t.negotiationState===d.READY?se(t):(t.isNegotiationNeeded=!0,i.Logger.error("Should not receive negotiation needed request because user is callee.")))},ue=function(e,t,n){if(m)if(e!==y){g[e]||ce(e);var o=g[e];o.state===c.READY||o.state===c.OFFERED?(i.Logger.debug("Send invitation to "+e),o.state=c.OFFERED,m.sendChatInvitation(e,k,function(){t&&t()},function(e){o.state=c.READY,n&&n(r.Error.getErrorByCode(e))})):(i.Logger.debug("Invalid state. Will not send invitation."),n&&n(r.Error.P2P_CLIENT_INVALID_STATE))}else n&&n(r.Error.P2P_CLIENT_ILLEGAL_ARGUMENT);else n&&n(r.Error.P2P_CONN_CLIENT_NOT_INITIALIZED)},pe=function(e,t,n){!m&&n&&n(r.Error.P2P_CONN_CLIENT_NOT_INITIALIZED),g[e]||ce(e);var o=g[e];o.isCaller=!1,o.state===c.PENDING?(o.state=c.MATCHED,m.sendChatAccepted(e,k,t,function(e){o.state=c.PENDING,n&&n(r.Error.getErrorByCode(e))})):(i.Logger.debug("Invalid state. Will not send acceptance."),n&&n(r.Error.P2P_CLIENT_INVALID_STATE))},le=function(e){return e.connection?"stable"!==e.connection.signalingState?void P(e,d.NEGOTIATING):(he(e),e.isNegotiationNeeded=!1,void e.connection.createOffer(function(t){t.sdp=Ie(t.sdp,e),e.connection.setLocalDescription(t,function(){i.Logger.debug("Set local descripiton successfully."),P(e,d.READY),m&&m.sendSignalMessage(e.id,t)},function(e){i.Logger.debug("Set local description failed. Message: "+JSON.stringify(e))})},function(e){i.Logger.debug("Create offer failed. Error info: "+JSON.stringify(e))},w)):void i.Logger.error("Peer connection have not been created.")},fe=function(e){if(e&&e.connection&&e.remoteIceCandidates&&0!==e.remoteIceCandidates.length){for(var t=0;t<e.remoteIceCandidates.length;t++)i.Logger.debug("remoteIce, length:"+remoteIceCandidates.length+", current:"+t),e.state!==c.CONNECTED&&e.state!==c.CONNECTING||e.connection.addIceCandidate(remoteIceCandidates[t],$,ee);e.remoteIceCandidates=[]}},he=function(e){if(i.Logger.debug("Draining pending streams."),e.connection){i.Logger.debug("Peer connection is ready for draining pending streams.");for(var t=0;t<e.pendingStreams.length;t++){var n=e.pendingStreams[t];e.pendingStreams.shift(),n.mediaStream&&(ge(n,e),n.onClose||(n.onClose=function(){xe(n)}),e.connection.addStream(n.mediaStream),i.Logger.debug("Added stream to peer connection."),we(n,e),i.Logger.debug("Sent stream type."))}e.pendingStreams=[];for(var r=0;r<e.pendingUnpublishStreams.length;r++)e.pendingUnpublishStreams[r].mediaStream&&(e.connection.removeStream(e.pendingUnpublishStreams[r].mediaStream),i.Logger.debug("Remove stream."));e.pendingUnpublishStreams=[]}},me=function(e){i.Logger.debug("Draining pendding messages.");var t=e.dataChannels[u.MESSAGE];if(t&&"closed"!==t.readyState){for(var n=0;n<e.pendingMessages.length;n++)t.send(e.pendingMessages[n]);e.pendingMessages=[]}},ge=function(e,t){var n=e.id();S[n]||(S[n]=[]),S[n].push(t.id)},ve=function(e){return e.connection?(he(e),e.isNegotiationNeeded=!1,void e.connection.createAnswer(function(t){t.sdp=Ie(t.sdp,e),e.connection.setLocalDescription(t,function(){i.Logger.debug("Set local description successfully."),m&&m.sendSignalMessage(e.id,t),i.Logger.debug("Sent answer.")},function(e){i.Logger.error("Error occurred while setting local description. Error message:"+e)})},function(e){i.Logger.error("Create answer failed. Message: "+e)})):void i.Logger.error("Peer connection have not been created.")},ye=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1},be=function(e,t,n,i){return e instanceof r.LocalStream&&e.mediaStream&&t?void Se(e,t,n,i):void(i&&i(r.Error.P2P_CLIENT_ILLEGAL_ARGUMENT))},Se=function(e,t,n,o){i.Logger.debug("Publish to: "+t);var a=x(t);if(a){g[a]||ce(a);var s=g[a],d=s.publishedStreams.length+s.pendingStreams.length>0,u=s.remoteSideSupportsUnifiedPlan&&T||s.remoteSideSupportsPlanB&&A;if(d&&!u)return i.Logger.warning("Cannot publish more than one streams if local and remote use different multiple media sources plan."),void(o&&o(r.Error.P2P_CLIENT_UNSUPPORTED_METHOD));switch(s.state){case c.OFFERED:case c.MATCHED:case c.CONNECTING:case c.CONNECTED:break;default:return i.Logger.warning("Cannot publish stream in this state: "+s.state),void(o&&o(r.Error.P2P_CLIENT_INVALID_STATE))}if(ye(s.publishedStreams,e)>-1)o&&o("The stream has been published.");else{switch(s.publishedStreams.push(e),h(e)?s.pendingStreams=s.pendingStreams.concat(e):e&&s.pendingStreams.push(e),s.state){case c.CONNECTING:case c.CONNECTED:s.pendingStreams.length>0&&he(s);break;default:return i.Logger.debug("Unexpected peer state: "+s.state),void(o&&o(r.Error.P2P_CLIENT_INVALID_STATE))}n&&n()}}else o&&o(r.Error.P2P_CLIENT_ILLEGAL_ARGUMENT)},Ce=function(e,t,n,o){if(i.Logger.debug("Unpublish stream."),!(e instanceof r.LocalStream))return i.Logger.warning("Invalid argument stream"),void(o&&o(r.Error.P2P_CLIENT_ILLEGAL_ARGUMENT));var a=x(t);if(a)if(!g[a]||ye(g[a].publishedStreams,e)<0)o&&o(r.Error.P2P_CLIENT_ILLEGAL_ARGUMENT);else{var s=g[a];if(navigator.mozGetUserMedia||!s.remoteSideSupportsRemoveStream)return i.Logger.error("Unpublish is not supported on Firefox."),void(o&&o(r.Error.P2P_CLIENT_UNSUPPORTED_METHOD));var d=ye(s.publishedStreams,e);s.publishedStreams.splice(d,1),s.pendingUnpublishStreams.push(e),s.state===c.CONNECTED&&he(s),n&&n()}else o&&(i.Logger.warning("Invalid argument targetId"),o(r.Error.P2P_CLIENT_ILLEGAL_ARGUMENT))},we=function(e,t){if(null!==e){var n="audio";e.isScreen()?(n="screen",e.hide=function(){i.Logger.debug("Unpublish screen sharing."),Ce(e,t.id)}):e.hasVideo()&&(n="video"),m&&m.sendStreamType(t.id,{streamId:e.mediaStream.id,type:n})}},Ee=function(e,t,n){if(m){if(e){var o=g[e];if(!o)return void(n&&(i.Logger.warning("Invalid target ID for stopping chat."),n(r.Error.P2P_CLIENT_ILLEGAL_ARGUMENT)));m.sendChatStopped(o.id),L(o,y),delete g[e]}else{var a=!0;for(var s in g){a=!1;var c=g[s];m.sendChatStopped(c.id),L(c,y),delete g[c.id]}if(a)return void(n&&(i.Logger.warning("No active connections can be stopped."),n(r.Error.P2P_CLIENT_INVALID_STATE)))}t&&t()}else n&&n(r.Error.P2P_CONN_CLIENT_NOT_INITIALIZED)},ke=function(e,t,n,o){var a=g[t];if(a&&a.state===c.CONNECTED){var s=a.dataChannels[u.MESSAGE];s&&"open"===s.readyState?s.send(e):(a.pendingMessages.push(e),oe(t)),n&&n()}else o&&(i.Logger.error("Invalid peer state."),o(r.Error.P2P_CLIENT_INVALID_STATE))},Ae=function(e,t){var n=new r.DataEvent({type:"data-received",senderId:e.id,data:t.data});s.dispatchEvent(n)},Te=function(e,t){i.Logger.debug("Data Channel is opened"),t.target.label===u.MESSAGE&&(i.Logger.debug("Data channel for messages is opened."),me(e))},Re=function(e){i.Logger.debug("Data Channel for "+e+" is closed.")},xe=function(e){var t=S[e.getID()];if(t)for(var n=0;n<t.length;n++)Ce(e,t[n])},Pe=function(e){return f.bandWidth&&f.bandWidth.maxAudioBW?r.Common.setPreferredBitrate(e,"audio",f.bandWidth.maxAudioBW):e},Le=function(e){return f.bandWidth&&f.bandWidth.maxVideoBW?r.Common.setPreferredBitrate(e,"video",f.bandWidth.maxVideoBW):e},Oe=function(e){return e=Pe(e),e=Le(e)},Ie=function(e,t){return e=Ne(e),e=De(e,t)},Ne=function(e){return f.audioCodec?e:r.Common.setPreferredCodec(e,"audio",f.audioCodec)},De=function(e,t){var n;return n=navigator.mozGetUserMedia?"vp8":t&&t.preferredVideoCodec?t.preferredVideoCodec:f.videoCodec?f.videoCodec:"h264",r.Common.setPreferredCodec(e,"video",n)};return s.connect=function(e,t,o){return l!==p.READY?(i.Logger.warning("Another peer has already connected"),void(o&&o(r.Error.P2P_CLIENT_INVALID_STATE))):(l=p.CONNECTING,m=new n(e),m.onConnected=I,m.onDisconnected=D,m.onConnectFailed=N,m.onChatStopped=j,m.onChatAccepted=B,m.onChatDenied=M,m.onChatInvitation=_,m.onChatSignal=U,m.onStreamType=V,m.onNegotiationNeeded=de,m.onAuthenticated=F,m.onForceDisconnect=G,void m.connect(e,t,o))},s.disconnect=function(e,t){return b?(Ee(),m&&m.finalize(),m=null,void(e&&e())):void(t&&t(r.Error.P2P_CLIENT_INVALID_STATE))},s.invite=ue,s.inviteWithStream=function(e,t,n,r){ue(e,function(){be(t,e)},r)},s.publish=be,s.unpublish=Ce,s.deny=function(e,t,n){if(g[e]&&g[e].state===c.PENDING){if(!m&&n)return void n(r.Error.P2P_CONN_CLIENT_NOT_INITIALIZED);m.sendChatDenied(e,t,function(e){n&&n(r.Error.getErrorByCode(e))}),delete g[e]}else n&&n(r.Error.P2P_CLIENT_INVALID_STATE)},s.accept=pe,s.acceptWithStream=function(e,t,n,r){pe(e,function(){be(t,e)},r)},s.stop=Ee,s.send=function(e,t,n,o){return e?e.length>65535?(i.Logger.warning("Message too long. Max size: 65535."),void(o&&o(r.Error.P2P_CLIENT_ILLEGAL_ARGUMENT))):void ke(e,x(t),n,o):(i.Logger.warning("Message cannot be undefined, null or empty."),void(o&&o(r.Error.P2P_CLIENT_ILLEGAL_ARGUMENT)))},s.getConnectionStats=function(t,n,i){var o=x(t),a=g[o];return a&&a.connection&&a.state===c.CONNECTED?void(n&&a.connection.getStats(null,function(t){n(e.navigator.appVersion.indexOf("Trident")>-1?t:r.Common.parseStats(t))},function(e){i&&i(e)})):void(i&&i("failed to get peerconnection statistics"))},s.getAudioLevels=function(e,t,n){var o=x(e),a=g[o];return a&&a.connection&&a.state===c.CONNECTED||n("Invalid peer connection status."),navigator.mozGetUserMedia?(i.Logger.error("GetAudioLevels is not supported on Firefox."),void(n&&n(r.Error.P2P_CLIENT_UNSUPPORTED_METHOD))):void(t&&a.connection.getStats(function(e){t(r.Common.parseAudioLevel(e))},function(e){n&&n(e)}))},s},e.Erizo=o,e.Woogeen=r,e.L=i}(window),function(e){Erizo.AudioPlayer=function(t){"use strict";var n,r,i=Erizo.View({});return i.id=t.id,i.stream=t.stream.mediaStream,i.elementID=t.elementID,i.stream_url=(e.URL||webkitURL).createObjectURL(i.stream),i.audio=document.createElement("audio"),i.audio.setAttribute("id","stream"+i.id),i.audio.setAttribute("style","width: 100%; height: 100%; position: absolute"),i.audio.setAttribute("autoplay","autoplay"),t.stream instanceof Woogeen.LocalStream&&(i.audio.volume=0),void 0!==i.elementID?(i.destroy=function(){i.audio.pause(),i.parentNode.removeChild(i.div)},n=function(){i.bar.display()},r=function(){i.bar.hide()},i.div=document.createElement("div"),i.div.setAttribute("id","player_"+i.id),i.div.setAttribute("style","width: 100%; height: 100%; position: relative; overflow: hidden;"),document.getElementById(i.elementID).appendChild(i.div),i.container=document.getElementById(i.elementID),i.parentNode=i.div.parentNode,i.div.appendChild(i.audio),i.bar=new Erizo.Bar({elementID:"player_"+i.id,id:i.id,stream:t.stream,media:i.audio,options:t.options}),i.div.onmouseover=n,i.div.onmouseout=r):(i.destroy=function(){i.audio.pause(),i.parentNode.removeChild(i.audio)},document.body.appendChild(i.audio),i.parentNode=document.body),i.audio.src=i.stream_url,i},Erizo.Bar=function(e){"use strict";var t,n,r=Erizo.View({});return r.elementID=e.elementID,r.id=e.id,r.div=document.createElement("div"),r.div.setAttribute("id","bar_"+r.id),r.bar=document.createElement("div"),r.bar.setAttribute("style","width: 100%; height: 15%; max-height: 30px; position: absolute; bottom: 0; right: 0; background-color: rgba(255,255,255,0.62)"),r.bar.setAttribute("id","subbar_"+r.id),n=function(e){"block"!==e?e="none":clearTimeout(t),r.div.setAttribute("style","width: 100%; height: 100%; position: relative; bottom: 0; right: 0; display:"+e)},r.display=function(){n("block")},r.hide=function(){t=setTimeout(n,1e3)},document.getElementById(r.elementID).appendChild(r.div),r.div.appendChild(r.bar),e.stream.screen||void 0!==e.options&&void 0!==e.options.speaker&&!0!==e.options.speaker||(r.speaker=new Erizo.Speaker({elementID:"subbar_"+r.id,id:r.id,stream:e.stream,media:e.media})),r.display(),r.hide(),r},function(){function t(){(new L.ElementQueries).init()}this.L=this.L||{},this.L.ElementQueries=function(){function e(e){e||(e=document.documentElement);var t=getComputedStyle(e,"fontSize");return parseFloat(t)||16}function t(t,n){var r=n.replace(/[0-9]*/,"");switch(n=parseFloat(n),r){case"px":return n;case"em":return n*e(t);case"rem":return n*e();case"vw":return n*document.documentElement.clientWidth/100;case"vh":return n*document.documentElement.clientHeight/100;case"vmin":case"vmax":var i=document.documentElement.clientWidth/100,o=document.documentElement.clientHeight/100;return n*(0,Math["vmin"===r?"min":"max"])(i,o);default:return n}}function n(e){this.element=e,this.options=[];var n,r,i,o,a,s,c,d,u=0,p=0;this.addOption=function(e){this.options.push(e)};var l=["min-width","min-height","max-width","max-height"];this.call=function(){for(u=this.element.offsetWidth,p=this.element.offsetHeight,s={},n=0,r=this.options.length;n<r;n++)i=this.options[n],o=t(this.element,i.value),a="width"==i.property?u:p,d=i.mode+"-"+i.property,c="","min"==i.mode&&a>=o&&(c+=i.value),"max"==i.mode&&a<=o&&(c+=i.value),s[d]||(s[d]=""),c&&-1===(" "+s[d]+" ").indexOf(" "+c+" ")&&(s[d]+=" "+c);for(var e in l)s[l[e]]?this.element.setAttribute(l[e],s[l[e]].substr(1)):this.element.removeAttribute(l[e])}}function r(e,t){e.elementQueriesSetupInformation?e.elementQueriesSetupInformation.addOption(t):(e.elementQueriesSetupInformation=new n(e),e.elementQueriesSetupInformation.addOption(t),new ResizeSensor(e,function(){e.elementQueriesSetupInformation.call()})),e.elementQueriesSetupInformation.call()}function i(e,t,n,i){var o;if(document.querySelectorAll&&(o=document.querySelectorAll.bind(document)),o||"undefined"==typeof $$||(o=$$),o||"undefined"==typeof jQuery||(o=jQuery),!o)throw"No document.querySelectorAll, jQuery or Mootools's $$ found.";for(var a=o(e),s=0,c=a.length;s<c;s++)r(a[s],{mode:t,property:n,value:i})}function o(e){var t;for(e=e.replace(/'/g,'"');null!==(t=s.exec(e));)5<t.length&&i(t[1]||t[5],t[2],t[3],t[4])}function a(e){var t="";if(e)if("string"==typeof e)-1===(e=e.toLowerCase()).indexOf("min-width")&&-1===e.indexOf("max-width")||o(e);else for(var n=0,r=e.length;n<r;n++)1===e[n].type?-1!==(t=e[n].selectorText||e[n].cssText).indexOf("min-height")||-1!==t.indexOf("max-height")?o(t):-1===t.indexOf("min-width")&&-1===t.indexOf("max-width")||o(t):4===e[n].type&&a(e[n].cssRules||e[n].rules)}var s=/,?([^,\n]*)\[[\s\t]*(min|max)-(width|height)[\s\t]*[~$\^]?=[\s\t]*"([^"]*)"[\s\t]*]([^\n\s\{]*)/gim;this.init=function(){for(var e=0,t=document.styleSheets.length;e<t;e++)a(document.styleSheets[e].cssText||document.styleSheets[e].cssRules||document.styleSheets[e].rules)}},e.addEventListener?e.addEventListener("load",t,!1):e.attachEvent("onload",t),this.L.ResizeSensor=function(t,n){function r(t,n){e.OverflowEvent||(t.addEventListener("overflow",function(e){n.call(this,e)}),t.addEventListener("underflow",function(e){n.call(this,e)}))}function i(){this.q=[],this.add=function(e){this.q.push(e)};var e,t;this.call=function(){for(e=0,t=this.q.length;e<t;e++)this.q[e].call()}}function o(t,n){return t.currentStyle?t.currentStyle[n]:e.getComputedStyle?e.getComputedStyle(t,null).getPropertyValue(n):t.style[n]}function a(e,t){function n(){var t=!1,n=e.resizeSensor.offsetWidth,r=e.resizeSensor.offsetHeight;return c!=n&&(u.width=n-1+"px",p.width=n+1+"px",t=!0,c=n),d!=r&&(u.height=r-1+"px",p.height=r+1+"px",t=!0,d=r),t}if(e.resizedAttached){if(e.resizedAttached)return void e.resizedAttached.add(t)}else e.resizedAttached=new i,e.resizedAttached.add(t);var a=function(){n()&&e.resizedAttached.call()};e.resizeSensor=document.createElement("div"),e.resizeSensor.className="resize-sensor";var s="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1;";e.resizeSensor.style.cssText=s,e.resizeSensor.innerHTML='<div class="resize-sensor-overflow" style="'+s+'"><div></div></div><div class="resize-sensor-underflow" style="'+s+'"><div></div></div>',e.appendChild(e.resizeSensor),"absolute"!==o(e,"position")&&(e.style.position="relative");var c=-1,d=-1,u=e.resizeSensor.firstElementChild.firstChild.style,p=e.resizeSensor.lastElementChild.firstChild.style;n(),r(e.resizeSensor,a),r(e.resizeSensor.firstElementChild,a),r(e.resizeSensor.lastElementChild,a)}if("array"==typeof t||"undefined"!=typeof jQuery&&t instanceof jQuery||"undefined"!=typeof Elements&&t instanceof Elements)for(var s=0,c=t.length;s<c;s++)a(t[s],n);else a(t,n)}}(),Erizo.Speaker=function(e){"use strict";var t,n,r,i=Erizo.View({}),o=50;return i.elementID=e.elementID,i.media=e.media,i.id=e.id,i.stream=e.stream,i.div=document.createElement("div"),i.div.setAttribute("style","width: 40%; height: 100%; max-width: 32px; position: absolute; right: 0;z-index:0;"),i.icon=document.createElement("img"),i.icon.setAttribute("id","volume_"+i.id),i.icon.setAttribute("src",Woogeen.Images.sound48),i.icon.setAttribute("style","width: 80%; height: 100%; position: absolute;"),i.div.appendChild(i.icon),i.stream instanceof Woogeen.RemoteStream?(i.picker=document.createElement("input"),i.picker.setAttribute("id","picker_"+i.id),i.picker.type="range",i.picker.min=0,i.picker.max=100,i.picker.step=10,i.picker.value=o,i.picker.orient="vertical",i.div.appendChild(i.picker),i.media.volume=i.picker.value/100,i.media.muted=!1,i.picker.oninput=function(){i.picker.value>0?(i.media.muted=!1,i.icon.setAttribute("src",Woogeen.Images.sound48)):(i.media.muted=!0,i.icon.setAttribute("src",Woogeen.Images.mute48)),i.media.volume=i.picker.value/100},t=function(e){i.picker.setAttribute("style","width: 32px; height: 100px; position: absolute; bottom: 90%; z-index: 1;"+i.div.offsetHeight+"px; right: 0px; -webkit-appearance: slider-vertical; display: "+e)},n=function(){i.icon.setAttribute("src",Woogeen.Images.mute48),o=i.picker.value,i.picker.value=0,i.media.volume=0,i.media.muted=!0},r=function(){i.icon.setAttribute("src",Woogeen.Images.sound48),i.picker.value=o,i.media.volume=i.picker.value/100,i.media.muted=!1},i.icon.onclick=function(){i.media.muted?r():n()},i.div.onmouseover=function(){t("block")},i.div.onmouseout=function(){t("none")},t("none")):i.stream instanceof Woogeen.LocalStream&&(n=function(){0!=i.stream.mediaStream.getAudioTracks().length&&(i.media.muted=!0,i.icon.setAttribute("src",Woogeen.Images.mute48),i.stream.mediaStream.getAudioTracks()[0].enabled=!1)},r=function(){0!=i.stream.mediaStream.getAudioTracks().length&&(i.media.muted=!1,i.icon.setAttribute("src",Woogeen.Images.sound48),i.stream.mediaStream.getAudioTracks()[0].enabled=!0)},i.icon.onclick=function(){i.media.muted?r():n()}),document.getElementById(i.elementID).appendChild(i.div),i},Erizo.View=function(e){"use strict";var t=Woogeen.EventDispatcher(e);return t.url=e.url||".",t},Erizo.VideoPlayer=function(t){"use strict";var n,r,i=Erizo.View({});i.id=t.id,i.stream=t.stream.mediaStream,i.elementID=t.elementID,n=function(){i.bar.display()},r=function(){i.bar.hide()},i.destroy=function(){i.video.pause(),delete i.resizer,i.parentNode.removeChild(i.div)},i.resize=function(e){var t=i.container.offsetWidth,n=i.container.offsetHeight;e?(i.video.style.width="calc(100% + "+(4/3*n-t)+"px)",i.video.style.height="100%",i.video.style.top="0px",i.video.style.left=-(4/3*n/2-t/2)+"px"):(i.video.style.height="100%",i.video.style.width="100%",i.video.style.left="0px",i.video.style.top="0px"),i.containerWidth=t,i.containerHeight=n},i.stream_url=(e.URL||webkitURL).createObjectURL(i.stream),i.div=document.createElement("div"),i.div.setAttribute("id","player_"+i.id),i.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"),i.video=document.createElement("video"),i.video.setAttribute("id","stream"+i.id),i.video.setAttribute("style","width: 100%; height: 100%; position: absolute"),i.video.setAttribute("autoplay","autoplay"),t.stream instanceof Woogeen.LocalStream&&(i.video.volume=0),void 0!==i.elementID?(document.getElementById(i.elementID).appendChild(i.div),i.container=document.getElementById(i.elementID)):(document.body.appendChild(i.div),i.container=document.body);var o=function(){function e(e){var t;for(var r in n)if("function"==typeof e[n[r]]){t=n[r];break}"function"==typeof e[t]&&e[t]()}function t(){"function"==typeof document.exitFullscreen?document.exitFullscreen():"function"==typeof document.webkitExitFullscreen?document.webkitExitFullscreen():"function"==typeof document.mozCancelFullScreen&&document.mozCancelFullScreen()}var n=["requestFullScreen","webkitRequestFullScreen","mozRequestFullScreen","msRequestFullScreen","oRequestFullScreen"];return function(n){n.offsetWidth==screen.width?t():e(n)}}();return i.parentNode=i.div.parentNode,i.div.appendChild(i.video),i.video.addEventListener("playing",function e(){i.video.videoWidth*i.video.videoHeight>4?L.Logger.debug("video dimensions:",i.video.videoWidth,i.video.videoHeight):setTimeout(e,50)}),i.containerWidth=0,i.containerHeight=0,i.resizer=new L.ResizeSensor(i.container,i.resize),i.resize(),i.div.ondblclick=function(){o(i.video)},i.bar=new Erizo.Bar({elementID:"player_"+i.id,id:i.id,stream:t.stream,media:i.video,options:t.options}),i.div.onmouseover=n,i.div.onmouseout=r,i.video.src=i.stream_url,i},Woogeen.Images={sound48:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAQAAAD9CzEMAAAABGdBTUEAALGOfPtRkwAACidpQ0NQaWNjAAB42p2Wd1RU1xaHz713eqHNMAJSht67wADSe5NeRWGYGWAoAw4zNLEhogIRRUSaIkhQxIDRUCRWRLEQFFSwByQIKDEYRVQsb0bWi66svPfy8vvjrG/ts/e5++y9z1oXAJKnL5eXBksBkMoT8IM8nOkRkVF07ACAAR5ggCkATFZGul+wewgQycvNhZ4hcgJfBAHweli8AnDT0DOATgf/n6RZ6XyB6JgAEZuzORksEReIOCVLkC62z4qYGpcsZhglZr4oQRHLiTlhkQ0++yyyo5jZqTy2iMU5p7NT2WLuFfG2TCFHxIiviAszuZwsEd8SsUaKMJUr4jfi2FQOMwMAFElsF3BYiSI2ETGJHxLkIuLlAOBICV9x3Fcs4GQLxJdySUvP4XMTEgV0HZYu3dTamkH35GSlcAQCwwAmK5nJZ9Nd0lLTmbwcABbv/Fky4trSRUW2NLW2tDQ0MzL9qlD/dfNvStzbRXoZ+LlnEK3/i+2v/NIaAGDMiWqz84strgqAzi0AyN37YtM4AICkqG8d17+6D008L4kCQbqNsXFWVpYRl8MyEhf0D/1Ph7+hr75nJD7uj/LQXTnxTGGKgC6uGystJU3Ip2ekM1kcuuGfh/gfB/51HgZBnHgOn8MTRYSJpozLSxC1m8fmCrhpPDqX95+a+A/D/qTFuRaJ0vgRUGOMgNR1KkB+7QcoChEg0fvFXf+jb774MCB+eeEqk4tz/+83/WfBpeIlg5vwOc4lKITOEvIzF/fEzxKgAQFIAiqQB8pAHegAQ2AGrIAtcARuwBv4gxAQCVYDFkgEqYAPskAe2AQKQTHYCfaAalAHGkEzaAXHQSc4Bc6DS+AauAFug/tgFEyAZ2AWvAYLEARhITJEgeQhFUgT0ofMIAZkD7lBvlAQFAnFQgkQDxJCedBmqBgqg6qheqgZ+h46CZ2HrkCD0F1oDJqGfofewQhMgqmwEqwFG8MM2An2gUPgVXACvAbOhQvgHXAl3AAfhTvg8/A1+DY8Cj+D5xCAEBEaoooYIgzEBfFHopB4hI+sR4qQCqQBaUW6kT7kJjKKzCBvURgUBUVHGaJsUZ6oUBQLtQa1HlWCqkYdRnWgelE3UWOoWdRHNBmtiNZH26C90BHoBHQWuhBdgW5Ct6Mvom+jJ9CvMRgMDaONscJ4YiIxSZi1mBLMPkwb5hxmEDOOmcNisfJYfawd1h/LxAqwhdgq7FHsWewQdgL7BkfEqeDMcO64KBwPl4+rwB3BncEN4SZxC3gpvCbeBu+PZ+Nz8KX4Rnw3/jp+Ar9AkCZoE+wIIYQkwiZCJaGVcJHwgPCSSCSqEa2JgUQucSOxkniMeJk4RnxLkiHpkVxI0SQhaQfpEOkc6S7pJZlM1iI7kqPIAvIOcjP5AvkR+Y0ERcJIwkuCLbFBokaiQ2JI4rkkXlJT0klytWSuZIXkCcnrkjNSeCktKRcpptR6qRqpk1IjUnPSFGlTaX/pVOkS6SPSV6SnZLAyWjJuMmyZApmDMhdkxikIRZ3iQmFRNlMaKRcpE1QMVZvqRU2iFlO/ow5QZ2VlZJfJhslmy9bInpYdpSE0LZoXLYVWSjtOG6a9W6K0xGkJZ8n2Ja1LhpbMyy2Vc5TjyBXJtcndlnsnT5d3k0+W3yXfKf9QAaWgpxCokKWwX+GiwsxS6lLbpaylRUuPL72nCCvqKQYprlU8qNivOKekrOShlK5UpXRBaUaZpuyonKRcrnxGeVqFomKvwlUpVzmr8pQuS3eip9Ar6b30WVVFVU9VoWq96oDqgpq2Wqhavlqb2kN1gjpDPV69XL1HfVZDRcNPI0+jReOeJl6ToZmouVezT3NeS1srXGurVqfWlLactpd2rnaL9gMdso6DzhqdBp1buhhdhm6y7j7dG3qwnoVeol6N3nV9WN9Sn6u/T3/QAG1gbcAzaDAYMSQZOhlmGrYYjhnRjHyN8o06jZ4baxhHGe8y7jP+aGJhkmLSaHLfVMbU2zTftNv0dzM9M5ZZjdktc7K5u/kG8y7zF8v0l3GW7V92x4Ji4Wex1aLH4oOllSXfstVy2krDKtaq1mqEQWUEMEoYl63R1s7WG6xPWb+1sbQR2By3+c3W0DbZ9ojt1HLt5ZzljcvH7dTsmHb1dqP2dPtY+wP2ow6qDkyHBofHjuqObMcmx0knXackp6NOz51NnPnO7c7zLjYu61zOuSKuHq5FrgNuMm6hbtVuj9zV3BPcW9xnPSw81nqc80R7+nju8hzxUvJieTV7zXpbea/z7vUh+QT7VPs89tXz5ft2+8F+3n67/R6s0FzBW9HpD/y9/Hf7PwzQDlgT8GMgJjAgsCbwSZBpUF5QXzAlOCb4SPDrEOeQ0pD7oTqhwtCeMMmw6LDmsPlw1/Cy8NEI44h1EdciFSK5kV1R2KiwqKaouZVuK/esnIi2iC6MHl6lvSp71ZXVCqtTVp+OkYxhxpyIRceGxx6Jfc/0ZzYw5+K84mrjZlkurL2sZ2xHdjl7mmPHKeNMxtvFl8VPJdgl7E6YTnRIrEic4bpwq7kvkjyT6pLmk/2TDyV/SglPaUvFpcamnuTJ8JJ5vWnKadlpg+n66YXpo2ts1uxZM8v34TdlQBmrMroEVNHPVL9QR7hFOJZpn1mT+SYrLOtEtnQ2L7s/Ry9ne85krnvut2tRa1lre/JU8zblja1zWle/Hloft75ng/qGgg0TGz02Ht5E2JS86ad8k/yy/Febwzd3FygVbCwY3+KxpaVQopBfOLLVdmvdNtQ27raB7ebbq7Z/LGIXXS02Ka4ofl/CKrn6jek3ld982hG/Y6DUsnT/TsxO3s7hXQ67DpdJl+WWje/2291RTi8vKn+1J2bPlYplFXV7CXuFe0crfSu7qjSqdla9r06svl3jXNNWq1i7vXZ+H3vf0H7H/a11SnXFde8OcA/cqfeo72jQaqg4iDmYefBJY1hj37eMb5ubFJqKmz4c4h0aPRx0uLfZqrn5iOKR0ha4RdgyfTT66I3vXL/rajVsrW+jtRUfA8eEx55+H/v98HGf4z0nGCdaf9D8obad0l7UAXXkdMx2JnaOdkV2DZ70PtnTbdvd/qPRj4dOqZ6qOS17uvQM4UzBmU9nc8/OnUs/N3M+4fx4T0zP/QsRF271BvYOXPS5ePmS+6ULfU59Zy/bXT51xebKyauMq53XLK919Fv0t/9k8VP7gOVAx3Wr6103rG90Dy4fPDPkMHT+puvNS7e8bl27veL24HDo8J2R6JHRO+w7U3dT7r64l3lv4f7GB+gHRQ+lHlY8UnzU8LPuz22jlqOnx1zH+h8HP74/zhp/9kvGL+8nCp6Qn1RMqkw2T5lNnZp2n77xdOXTiWfpzxZmCn+V/rX2uc7zH35z/K1/NmJ24gX/xaffS17Kvzz0atmrnrmAuUevU18vzBe9kX9z+C3jbd+78HeTC1nvse8rP+h+6P7o8/HBp9RPn/4FA5jz/EHct2gAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAAJiS0dEAP+Hj8y/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAACXZwQWcAAAAwAAAAMADO7oxXAAAHsUlEQVRYw+1XfVSUVRp/ZgYGcPgc+TRNPgtRhDZELEhdPX62kZuSCGoqIIsalKUejazctW3LXE9ohoAppeDXKOdQIpsgioKCqwYKAwoCKSDDt8LAzNx+dwYExMMiq//1/s6ZM/e+931+z+e9zyX64/njGfARkJBEWgjx/xmIF5GBYJiliVBChqT3/1MI+ogQQOQwkoaPvfXRHj+yJGPSHzoF11UPAvTx2+0MERmRtb9XxUGNqi4z1I/sQDFEK4QQLCGzkFGBXIgYY06pT+bkkveNRqVhGk3J0fFeZANK0VDEG5AZ2cXPbkq7tg5CTCFaCF0l0Pml9etq76qZmnW2n/onudJwrBU8qWsMSWrgkBTWKmcsLxZCbCDaiEwcbPVdyJcC18c1tHYyFWuuWLeQRoP+CdykC6PlSNf06LYaNetg6T/QRHIgK7Ja7l62PT6M/kyL9D5I+KVN3QGKguPW3mQLcuHgxUvI2tszP6ajpZO1MyVLOUzTaCw5+k+8naRRN5SsiKAACnfaeqVMibf3m75aTc6IzKCyiQfWhGwX+5UcVimVrA1oZ8dkNJteJo/0rZ0d7ayTFZ13WkZLKTLqQIOyDRS/ppr50IiBbBB0QaQN7MiNr989o1K3sftaPGBHjtPrNIkmvRFSdOMBxu0diXtoEYVYRV8obsO4oXbVUthgBtsfU/J6SEADhNQIfjdB4TjsXNLwaycEtwCtwH12mBO8gtD+dfHXVY2tEFldPnUNBdPqTcmNKqzQpOwiT6TBI7mkyxUTiaXzKGd7R4fRTs5uQVPSt7RWdkB080O0sEMymkveNIHm0Krv0ps0zeyB+sfvYcOK8X8vruZqFOXYTEMuSfo6idekdL1X5S7FyXtptWk1p6ozmks64dUm1tgLTSyZx8CT3GBFoNfWopomkMoLng+hxcKoE7nNWFFdvWAJvYhA6/XWn9ek/YXPVRoV04HnTAtreASNLElGMyH+eRpDMyg8MZPP1jWHboYNYVuSFZoGplD+I5rGI5H1exMYoiY9/7OvkdU/hOIxqGcHZRD8IlnTc3BTQMjuO0oFa9B8t5cC6Z35/668j1WaxN1w4gjIFPQkpARe8z2SXMfuDYg6doATuJAFSUEz66WN12vrQJyWTotpiefHRff46CcZvQZ5w3oTGJMTTTtwtJbVDIha9qOOwAxfjCJfm/DsYk6c81/D5RRs90H+bT7KzDScCXkmPWEWYuBCMxJl1ezugKhmiToCUzjAhrzEwen5nDivSLqSgoZHZstrsCYrx/wv9AKUED1CsF92h/02IO6w/d0EBqgTD2HAyYucOEduFQGCNWeL7mLNmUsWbyIJzPsR7JNVscoBUcX2dROIsTG7mwacvsyJz9ww/hsFWa+5UMJH6TnG85BpFv0I9soq2O0BUcH29iFwC84rqQBxyiURXOT43uVKPjqWIfB/rAUJsnJWNiDKWUKPi6zIY8FqeX05ZnefpBUUNG1TgUI7kqHOXR+NgTNN332oR9Qt4GY/3GJx3QRGqJwJu7aXq24yeWdkAr1Di1Z9Vdp+k5Woo+NRjHyNsHcd2NNk/49PFp9XnFOcqz9bn9tc0FHKSllJH5SyPToCc3xubz394pkyzF2q89lCSygoLvkW1hQ8CNiKY8gRiSzsqWQjVJ43BdhtcN7mGOO40+Fbt7h5x/YUXFXKWXEvyFksJ3gB/rcit81RlY1yiDyYZ/AuBVusOJdfihVnq8ZEYrcdBZmCHgKxtjKn0AIKoVW0hqLoQ/rI8IuVqecab7DrD3GDfcsJXOGe0a5TCzPKMHelfVk8hVLg2xuL6/mK/dnCYOIHZ58NW4TCtoFmE2gyTYcHZ9ObFEQRgk2zE1N+u8auduEai5HRLBpHjgKPn7+uVl7DTFLh8A08AocOl2BFfmdEHL51h436/Q93KdcM3nMG1Tgc7rOww7w/Libu+iV1PuO4zHbwDPkTucdHKeoKMZPV4h9L4RQ0ObKo4grep1a5rOtKA1H/9kQMv0kQHBO8lmK/HEN+cNpq6y8+O5+lzGU5LJdt4weOD/ns+PRqYy47r4pOF63l+h9JkmtysOKTVIT7FRr5+FNZdxoLtdDjRxAaFG96g1Yabg5N/ak5m2WzL3VHpp9wfkRCWlPMZavNFEaBoZvKa3Lx9kS1x2fkDwdZ/u++ghOJYclInF+zaJlgw8wfDt7JYv/iLpoIzNEPm7PD6RNCBbuHFeYVskx2Wr02BQU3BWoZD66B5I2LMfJhLPI6iN7z2P7NxaidSAIP7DQ+sCQQswulwRknKtQZ7DSLLbbbSPOgkPXg20dd8K0QdF96i5ZLwozeRtPihPg4gOZVEM89ElurzGKn2KH6yTvRIb2GNyZP0gB39ab47GWImwGiMdr21xy/Djh7p3657Zemn9nxtqVHUUFzYa3lk7a/1BWNEUhfV2hvCw3FcJ4RNmR7miRcuPT7A4qoNPFamo86eg55KBra/WAY9kcLaC7R3g94EhjC2+40Vxzm/bnZ+7QQ1jlgzRBvObrOj99wuq97PD6mKExv5NVbSGZflJcU7hE+vTsav5hYgGIc4jMeO8Bw2CR8urdMTmGKLLOFs8wgXvT0r7LccbxhNtBeq57BTbmn4X8mwgf1/A4Bm4o+oeC48QAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAwOS0wOS0xM1QxNjoxMjo1OCswMjowMBbbrGkAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMDktMDktMTNUMTY6MTI6NTgrMDI6MDBnhhTVAAAAAElFTkSuQmCC",mute48:"data:image/png;base64,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"},Woogeen.Stream.prototype.show=function(e){"use strict";if(!this.mediaStream||!0===this.showing)return!0===this.showing;"string"!=typeof e&&(e="stream_"+this.id());var t=arguments[1]||{};return this.elementId=e,this.hasVideo()?(this.player=new Erizo.VideoPlayer({id:this.id(),stream:this,elementID:e,options:t}),this.showing=!0):this.hasAudio()&&(this.player=new Erizo.AudioPlayer({id:this.id(),stream:this,elementID:e,options:t}),this.showing=!0),!0===this.showing},Woogeen.Stream.prototype.hide=function(){"use strict";!0===this.showing&&this.player&&"function"==typeof this.player.destroy&&(this.player.destroy(),this.showing=!1)},Woogeen.UI=Woogeen.UI||Object.create({}),Woogeen.UI.attachMediaStream=function(){adapter.browserShim.attachMediaStream.apply(this,arguments)},e.Erizo=Erizo,e.Woogeen=Woogeen,e.L=L}(window),function(){function e(){this.events={}}function t(e){this.userid=e.userid,this.sessionid=e.sessionid}e.prototype={on:function(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)},emit:function(e,t){var n,r,i=this.events[e],o=Array.prototype.slice.call(arguments,1);if(i)for(n=0,r=i.length;n<r;n++)i[n].apply(null,o)},jsonp:function(e){if(e=e||{},e.callback=e.callback||"callback",!e.url||!e.callbackName)throw new Error("params is illegal!");e.beforeSend&&e.beforeSend();var t=(e.callbackName+Math.random()).replace(".","");e.data[e.callback]=t;var n=function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}(e.data);window[t]=function(n){r.removeChild(i),clearTimeout(i.timer),window[t]=null,e.success&&e.success(n)};var r=document.getElementsByTagName("head")[0],i=document.createElement("script");r.appendChild(i),i.src=e.url+"?"+n,e.time&&(i.timer=setTimeout(function(){window[t]=null,r.removeChild(i),e.error&&e.error({message:"over time"})},e.time))}},(t.prototype=new e).join=function(){if(1===n.connect)console.log("不能重复登录");else{var e=this;this.jsonp({url:"https://ccapi.csslcloud.net/api/room/join",callbackName:"callback",time:"30000",data:{userid:e.userid,sessionid:e.sessionid},success:function(t){if("FAIL"==t.result)throw e.emit("login_failed",t.errorMsg),new Error(t.errorMsg);var r=t.data;e.emit("login_success",r),e.viewerid=r.user.id,e.name=r.user.name,e.roomid=r.user.roomid,e.videoMode=r.video_mode,e.userRole=r.user.role,e.extUrl=r.rtspurl,n.init(e);var i=r.live.atlas_token;n.conference.setIceServers([{urls:"stun:turn-cc2.csslcloud.net:80"},{urls:["turn:turn-cc2.csslcloud.net:80?transport=udp","turn:turn-cc2.csslcloud.net:443?transport=udp","turn:turn-cc2.csslcloud.net:80?transport=tcp","turn:turn-cc2.csslcloud.net:443?transport=tcp"],username:"class",credential:"class_2017"}]),n.conference.join(i,function(t){var r=t.streams;n.connect=1,e.emit("conference_join",r),console.log("conference_join",r)},function(t){e.emit("conference_join_failed",t),console.log("conference_join_failed",t)})},error:function(t){e.emit("login_failed",t.message),console.log("login_failed",t.message)}})}},t.prototype.createLocalStream=function(e,t){n.createLocalStream(this,e,t)},t.prototype.leave=function(){n.leave(this)},t.prototype.publishShareStream=function(e,t){var r=this;this.jsonp({url:"https://ccapi.csslcloud.net/api/live/stat",callbackName:"callback",time:"10000",data:{roomid:r.roomid},success:function(r){"OK"===r.result?!0===r.started?n.publishShareStream(e,t):(console.log("直播未开始"),"function"==typeof t&&t(!1,"直播未开始")):("function"==typeof t&&t(!1,r.errorMsg),console.log(r.errorMsg))}})},t.prototype.publish=function(e,t){var r=this;this.jsonp({url:"https://ccapi.csslcloud.net/api/live/stat",callbackName:"callback",time:"10000",data:{roomid:r.roomid},success:function(i){"OK"===i.result?!0===i.started?n.publishLocalStream(r,e,t):(console.log("直播未开始"),"function"==typeof t&&t(!1,"直播未开始")):("function"==typeof t&&t(!1,i.errorMsg),console.log(i.errorMsg))}})},t.prototype.unPublish=function(e){n.unPublish(this,e)},t.prototype.trySubscribeStream=function(e,t,r){n.trySubscribeStream(this,e,t,r)},t.prototype.unSubscribeStream=function(e,t){n.unSubscribeStream(this,e,t)},t.prototype.pauseVideo=function(e){n.pauseVideo(e)},t.prototype.playVideo=function(e){n.playVideo(e)},t.prototype.pauseAudio=function(e){n.pauseAudio(e)},t.prototype.playAudio=function(e){n.playAudio(e)},t.prototype.addExternalOutput=function(e,t){n.addExternalOutput(this,e,t)},t.prototype.removeExternal=function(e,t){n.removeExternal(this,e,t)},t.prototype.updateExternalOutput=function(e,t){n.updateExternalOutput(e,t)},t.prototype.setRegion=function(e,t){n.setRegion(e,t)},t.prototype.getRegion=function(e,t){n.getRegion(e,t)},t.prototype.mix=function(e,t){n.mix(e,t)},t.prototype.unMix=function(e,t){n.unMix(e,t)},t.prototype.close=function(){n.close()},t.prototype.closeVideo=function(){n.closeVideo()},t.prototype.getConnectionStats=function(e,t){n.getConnectionStats(e,t)},t.prototype.publishStreamAdd=function(e){r.publishStreamAdd(this,e)},t.prototype.unPublishStreamRemoved=function(e,t){r.unPublishStreamRemoved(this,e,t)},t.prototype.streamSubscribe=function(e){r.streamSubscribe(this,e)},t.prototype.unStreamSubscribe=function(e){r.unStreamSubscribe(this,e)},t.prototype.getLiveStat=function(e){r.getLiveStat(this,e)},t.prototype.startLive=function(e){r.startLive(this,e)},t.prototype.stopLive=function(e){r.stopLive(this,e)};var n={conference:Woogeen.ConferenceClient.create({}),localStream:"",addExternal:0,pub:0,connect:0,mixStream:"",init:function(e){var t=this;this.conference.on("stream-added",function(n){var r=n.stream,i=!1;if(r instanceof Woogeen.RemoteMixedStream)t.mixStream=r;else{if(!r.isScreen()){for(var o in t.conference.localStreams)if(t.conference.localStreams.hasOwnProperty(o)&&t.conference.localStreams[o].id()===r.id()){i=!0;break}if(i)return}e.emit("stream_added",r),e.publishStreamAdd(r),console.log("stream_added",r)}}),this.conference.on("stream-removed",function(n){var r=n.stream;if(void 0!==r){var i=r.attr("userid"),o=r.id();e.emit("stream_removed",o),console.log("stream_removed",o),e.unPublishStreamRemoved(i,o)}r.attr("userid"),e.viewerid,r.attr("userid")===e.viewerid&&(t.pub=0)}),this.conference.on("server-disconnected",function(n){t.connect=0,t.pub=0,e.emit("server_disconnected"),console.log("server_disconnected",n)}),this.conference.on("stream-failed",function(t){e.emit("stream_failed"),console.log("stream_failed",t)})},leave:function(){this.conference.leave()},setRegion:function(e,t){this.conference.setRegion(e,function(){L.Logger.info("setRegion succeeded"),"function"==typeof t&&t(!0,"setRegion succeeded")},function(e){L.Logger.error("setRegion failed:",e),"function"==typeof t&&t(!1,"setRegion failed:"+e)})},getRegion:function(e,t){this.conference.getRegion(e,function(e){L.Logger.info("Region for streamId: ",e.region),"function"==typeof t&&t(!0,e.region)},function(e){L.Logger.error("getRegion failed:",e),"function"==typeof t&&t(!1,e)})},createLocalStream:function(e,t,n){if(this.localStream)console.log("不能重复创建本地流"),"function"==typeof n&&n(!1,"不能重复创建本地流");else{var r=this;r.closeVideo();var i=window.localStorage,o=i.getItem("video_device_id"),a=i.getItem("audio_device_id"),s=i.getItem("video_device_resolution"),c=null;if(t)c=t;else{var d={device:"camera",resolution:s||"hd720p",frameRate:15};o&&(d.deviceId=o),"1"!=e.videoMode&&"talker"==e.userRole&&(d=!1),c={video:d,audio:!a||{deviceId:a}}}Woogeen.LocalStream.create(c,function(t,i){t?"function"==typeof n&&n(!1,t):(i.attr("userid",e.viewerid),r.localStream=i,e.localStream=i,"function"==typeof n&&n(!0,i))})}},publishLocalStream:function(e,t,n){var i=this,o=this.localStream;o&&0===this.pub?this.conference.publish(o,{videoCodec:"vp8",maxVideoBW:t},function(t){i.pub=1,"function"==typeof n&&n(!0,t),r.publishStreamAdd(e,t)},function(e){"function"==typeof n&&n(!1,e)}):(console.log("推流条件不满足"),n(!1,"推流条件不满足"))},unPublish:function(e,t){var n=this,i=this.localStream;if(i&&1===this.pub){var o=i.attr("userid"),a=i.id();this.conference.unpublish(i,function(){n.pub=0,"function"==typeof t&&t(!0,a),r.unPublishStreamRemoved(e,o,a)},function(e){"function"==typeof t&&t(!1,e)})}else console.log("停止推流条件不满足"),t(!1,"停止推流条件不满足")},addExternalOutput:function(e,t,n){if(0===this.addExternal){var r=this,i="";i=t||(e.extUrl?e.extUrl+e.roomid:"rtmp://push-cc1.csslcloud.net/origin/"+e.roomid),L.Logger.info("External OutPut: "+i),this.conference.addExternalOutput(i,function(){L.Logger.info("started external streaming"),r.addExternal=1,"function"==typeof n&&n(!0,"started external streaming")},function(e){L.Logger.error("Start external streaming failed:",e,i),"function"==typeof n&&n(!1,"Start external streaming failed:"+e+i)})}else console.log("不能重复执行此操作"),"function"==typeof n&&n(!1,"不能重复执行此操作")},removeExternal:function(e,t,n){if(1===this.addExternal){var r=this,i="";i=t||(e.extUrl?e.extUrl+e.roomid:"rtmp://push-cc1.csslcloud.net/origin/"+e.roomid),this.conference.removeExternalOutput(i,function(){L.Logger.info("Stop external streaming success."),r.addExternal=0,"function"==typeof n&&n(!0,"Stop external streaming success.")},function(e){L.Logger.error("Stop external streaming failed:",e),"function"==typeof n&&n(!1,e)})}else console.log("请先执行 addExternalOutput,才能执行removeExternalOutput操作"),"function"==typeof n&&n(!1,"请先执行 addExternalOutput,才能执行removeExternalOutput操作")},updateExternalOutput:function(e,t){1===this.addExternal?this.conference.updateExternalOutput(e,function(){L.Logger.info("Update external streaming success"),"function"==typeof t&&t(!0,"Update external streaming success")},function(e){L.Logger.error("Update external streaming failed:",e),"function"==typeof t&&t(!1,"Update external streaming failed:"+e)}):(console.log("没有执行addExternalOutput,不能更新地址"),"function"==typeof t&&t(!1,"没有执行addExternalOutput,不能更新地址"))},pauseVideo:function(e){this.localStream?(this.localStream.disableVideo(),"function"==typeof e&&e(!0)):"function"==typeof e&&e(!1)},playVideo:function(e){this.localStream?(this.localStream.enableVideo(),"function"==typeof e&&e(!0)):"function"==typeof e&&e(!1)},pauseAudio:function(e){this.localStream?(this.localStream.disableAudio(),"function"==typeof e&&e(!0)):"function"==typeof e&&e(!1)},playAudio:function(e){this.localStream?(this.localStream.enableAudio(),"function"==typeof e&&e(!0)):"function"==typeof e&&e(!1)},trySubscribeStream:function(e,t,n,i){t instanceof Woogeen.RemoteMixedStream?this.mixStream=t:n?this.conference.subscribe(t,n,function(){"function"==typeof i&&i(!0,t),r.streamSubscribe(e,t)},function(e){console.log("stream_subscribed_failed",e),"function"==typeof i&&i(!1,e)}):this.conference.subscribe(t,function(){"function"==typeof i&&i(!0,t),r.streamSubscribe(e,t)},function(e){console.log("stream_subscribed_failed",e),"function"==typeof i&&i(!1,e)})},unSubscribeStream:function(e,t,n){this.conference.unsubscribe(t,function(i){L.Logger.info("stream unsubscribed:",t.id()),"function"==typeof n&&n(!0,t.id()),r.unStreamSubscribe(e,t)},function(e){L.Logger.error("unsubscribe failed:",e),"function"==typeof n&&n(!1,e)})},mix:function(e,t){var n="";n=e||this.localStream;var r=this;this.conference.mix(n,[r.mixStream],function(){L.Logger.info("mix success"),"function"==typeof t&&t(!0,"mix success")},function(e){L.Logger.error("mix failed:",e),"function"==typeof t&&t(!1,"mix failed:"+e)})},unMix:function(e,t){var n="";n=e||this.localStream;var r=this;this.conference.unmix(n,[r.mixStream],function(){L.Logger.info("unMix success"),"function"==typeof t&&t(!0,"unMix success")},function(e){L.Logger.error("unMix failed:",e),"function"==typeof t&&t(!1,"unMix failed:"+e)})},closeVideo:function(){this.localStream&&(this.localStream.close(),this.localStream.channel&&"function"==typeof this.localStream.channel.close&&this.localStream.channel.close()),this.localStream="",this.pub=0},close:function(){for(var e in this.conference.remoteStreams)if(this.conference.remoteStreams.hasOwnProperty(e)){var t=this.conference.remoteStreams[e];t.close(),t.channel&&"function"==typeof t.channel.close&&t.channel.close(),delete this.conference.remoteStreams[e]}},publishShareStream:function(e,t){var n=this;Woogeen.LocalStream.create({video:{device:"screen",resolution:"hd1080p",frameRate:15,extensionId:"lafaooeojkcadiliheobbkkpkbnmdhgh"}},function(r,i){r?(console.log("create share screen error ",r),"function"==typeof t&&t(!1,r)):n.conference.publish(i,{videoCodec:"vp8",maxVideoBW:e,transport:"tcp"},function(e){""!==n.mixStream&&n.mix(e,function(e,t){e?console.log("共享桌面混流成功",t):console.log("共享桌面混流失败",t)}),"function"==typeof t&&t(!0,e),console.log("share_stream_published",e)},function(){"function"==typeof t&&t(!1,r),console.log("share_stream_publish_failed",r)})})},getConnectionStats:function(e,t){this.conference.getConnectionStats(e,function(e){"function"==typeof t&&t(!0,e)},function(e){L.Logger.error("Get statistic information failed：",e),"function"==typeof t&&t(!1,e)})}},r={publishStreamAdd:function(e,t){e.jsonp({url:"https://ccapi.csslcloud.net/api/atlas/stream/added",callbackName:"callback",time:"10000",data:{roomid:e.roomid,userid:t.attr("userid"),streamid:t.id(),time:(new Date).getTime()},success:function(e){"OK"===e.result?console.log("ccapi/stream/added","ok"):console.log("ccapi/stream/added",e.errorMsg)}})},unPublishStreamRemoved:function(e,t,n){e.jsonp({url:"https://ccapi.csslcloud.net/api/atlas/stream/remove",callbackName:"callback",time:"10000",data:{roomid:e.roomid,userid:t,streamid:n,time:(new Date).getTime()},success:function(e){"OK"===e.result?console.log("ccapi/stream/remove","ok"):console.log("ccapi/stream/remove",e.errorMsg)}})},streamSubscribe:function(e,t){e.jsonp({url:"https://ccapi.csslcloud.net/api/atlas/stream/subscribe",callbackName:"callback",time:"10000",data:{roomid:e.roomid,userid:e.viewerid,streamid:t.id(),time:(new Date).getTime()},success:function(e){"OK"===e.result?console.log("ccapi/stream/subscribe","ok"):console.log("ccapi/stream/subscribe",e.errorMsg)}})},unStreamSubscribe:function(e,t){e.jsonp({url:"https://ccapi.csslcloud.net/api/atlas/stream/unsubscribe",callbackName:"callback",time:"10000",data:{roomid:e.roomid,userid:e.viewerid,streamid:t.id(),time:(new Date).getTime()},success:function(e){"OK"===e.result?console.log("ccapi/stream/unsubscribe","ok"):console.log("ccapi/stream/unsubscribe",e.errorMsg)}})},getLiveStat:function(e,t){e.jsonp({url:"https://ccapi.csslcloud.net/api/live/stat",callbackName:"callback",time:"10000",data:{roomid:e.roomid},success:function(e){"OK"===e.result?!0===e.started?("function"==typeof t&&t(!0,"直播开始状态"),console.log("直播开始状态",e)):("function"==typeof t&&t(!1,"直播关闭状态"),console.log("直播关闭状态",e)):("function"==typeof t&&t(!1,e.errorMsg),console.log("查询直播出错",e.errorMsg))}})},startLive:function(e,t){e.jsonp({url:"https://ccapi.csslcloud.net/api/live/start",callbackName:"callback",time:"10000",data:{roomid:e.roomid,userid:e.userid},beforeSend:function(){e.emit("live_before_send")},success:function(e){"OK"===e.result?("function"==typeof t&&t(!0,"开始直播调用成功"),console.log("成功发送开始直播事件")):("function"==typeof t&&t(!1,"开始直播调用失败"),console.log("发送开始直播事件失败"))}})},stopLive:function(e,t){e.jsonp({url:"https://ccapi.csslcloud.net/api/live/stop",callbackName:"callback",time:"10000",data:{roomid:e.roomid,userid:e.userid,loginid:e.viewerid},success:function(e){"OK"===e.result?("function"==typeof t&&t(!0,"结束直播调用成功"),console.log("成功发送结束直播事件")):("function"==typeof t&&t(!1,"结束直播调用失败"),console.log("发送结束直播事件失败"))}})}};window.Rtc=t,window.ATLAS=n}(window);